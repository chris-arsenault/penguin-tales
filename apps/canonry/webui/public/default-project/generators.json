[
  {
    "id": "hero_emergence",
    "name": "Hero Rises",
    "applicability": [
      {
        "type": "or",
        "rules": [
          {
            "type": "entity_count_max",
            "kind": "npc",
            "max": 20
          },
          {
            "type": "pressure_threshold",
            "pressureId": "conflict",
            "min": 5,
            "max": 80,
            "extremeChance": 0.3
          }
        ]
      },
      {
        "type": "entity_count_max",
        "kind": "npc",
        "subtype": "hero",
        "max": 10,
        "overshootFactor": 1.5
      }
    ],
    "selection": {
      "strategy": "by_kind",
      "kind": "location",
      "subtypes": [
        "colony"
      ],
      "filters": [
        {
          "type": "graph_path",
          "assert": {
            "check": "exists",
            "path": [],
            "where": [
              {
                "type": "subtype_equals",
                "subtype": "colony"
              }
            ]
          }
        }
      ],
      "pickStrategy": "random"
    },
    "creation": [
      {
        "entityRef": "$hero",
        "kind": "npc",
        "subtype": "hero",
        "status": "alive",
        "prominence": "marginal",
        "culture": {
          "inherit": "$target"
        },
        "description": {
          "template": "A brave penguin who emerged during troubled times in {colonyName}",
          "replacements": {
            "colonyName": "$target.name"
          }
        },
        "tags": {
          "brave": true,
          "emergent": true
        },
        "placement": {
          "type": "near_entity",
          "entity": "$target"
        },
        "lineage": {
          "relationshipKind": "inspired_by",
          "ancestorFilter": [
            { "kind": "npc", "subtype": "hero", "status": "alive" },
            { "kind": "npc", "status": "alive" }
          ],
          "distanceRange": { "min": 40, "max": 70 }
        }
      }
    ],
    "relationships": [
      {
        "kind": "resident_of",
        "src": "$hero",
        "dst": "$target",
        "strength": 0.8
      },
      {
        "kind": "practitioner_of",
        "src": "$hero",
        "dst": "$ability",
        "strength": 0.6,
        "condition": {
          "type": "entity_exists",
          "entity": "$ability"
        }
      }
    ],
    "stateUpdates": [
      {
        "type": "modify_pressure",
        "pressureId": "conflict",
        "delta": -2
      }
    ],
    "variables": {
      "$ability": {
        "select": {
          "from": "graph",
          "strategy": "by_kind",
          "kind": "abilities",
          "pickStrategy": "random"
        }
      }
    },
    "metadata": {
      "produces": {
        "entityKinds": [
          {
            "kind": "npc",
            "subtype": "hero",
            "count": {
              "min": 1,
              "max": 1
            },
            "prominence": [
              {
                "level": "marginal",
                "probability": 1
              }
            ]
          }
        ],
        "relationships": [
          {
            "kind": "practitioner_of",
            "category": "cultural",
            "probability": 0.8,
            "comment": "If abilities exist"
          },
          {
            "kind": "resident_of",
            "category": "spatial",
            "probability": 1,
            "comment": "Hero lives in colony"
          }
        ]
      },
      "effects": {
        "graphDensity": 0.2,
        "clusterFormation": 0.3,
        "diversityImpact": 0.5,
        "comment": "Creates individual heroes with potential for ability practice"
      },
      "tags": [
        "crisis-driven",
        "individual"
      ]
    }
  },
  {
    "id": "succession",
    "name": "Leadership Succession",
    "applicability": [
      {
        "type": "entity_count_min",
        "kind": "npc",
        "subtype": "mayor",
        "min": 1
      }
    ],
    "selection": {
      "strategy": "by_kind",
      "kind": "npc",
      "subtypes": [
        "mayor"
      ],
      "filters": [
        {
          "type": "graph_path",
          "assert": {
            "check": "exists",
            "path": [
              {
                "via": "leader_of",
                "direction": "out",
                "targetKind": "location"
              }
            ]
          }
        }
      ],
      "pickStrategy": "random"
    },
    "creation": [
      {
        "entityRef": "$successor",
        "kind": "npc",
        "subtype": "mayor",
        "status": "alive",
        "prominence": "marginal",
        "culture": {
          "inherit": "$colony"
        },
        "description": {
          "template": "Successor to {predecessorName} in {colonyName}",
          "replacements": {
            "predecessorName": "$target.name",
            "colonyName": "$colony.name"
          }
        },
        "tags": {
          "successor": true
        },
        "placement": {
          "type": "near_entity",
          "entity": "$colony"
        }
      }
    ],
    "relationships": [
      {
        "kind": "leader_of",
        "src": "$successor",
        "dst": "$colony",
        "strength": 0.9
      },
      {
        "kind": "resident_of",
        "src": "$successor",
        "dst": "$colony",
        "strength": 0.85
      },
      {
        "kind": "leader_of",
        "src": "$successor",
        "dst": "$faction",
        "strength": 0.8,
        "condition": {
          "type": "entity_exists",
          "entity": "$faction"
        }
      },
      {
        "kind": "member_of",
        "src": "$successor",
        "dst": "$faction",
        "strength": 0.75,
        "condition": {
          "type": "entity_exists",
          "entity": "$faction"
        }
      }
    ],
    "stateUpdates": [
      {
        "type": "archive_relationship",
        "entity": "$target",
        "relationshipKind": "leader_of",
        "with": "$colony"
      },
      {
        "type": "archive_relationship",
        "entity": "$target",
        "relationshipKind": "leader_of",
        "with": "$faction"
      },
      {
        "type": "modify_pressure",
        "pressureId": "stability",
        "delta": -1
      }
    ],
    "variables": {
      "$colony": {
        "select": {
          "from": {
            "relatedTo": "$target",
            "relationship": "leader_of",
            "direction": "src"
          },
          "strategy": "by_kind",
          "kind": "location",
          "pickStrategy": "first"
        }
      },
      "$faction": {
        "select": {
          "from": {
            "relatedTo": "$target",
            "relationship": "leader_of",
            "direction": "src"
          },
          "strategy": "by_kind",
          "kind": "faction",
          "pickStrategy": "first"
        }
      }
    },
    "metadata": {
      "produces": {
        "entityKinds": [
          {
            "kind": "npc",
            "subtype": "mayor",
            "count": {
              "min": 1,
              "max": 1
            },
            "prominence": [
              {
                "level": "marginal",
                "probability": 1
              }
            ]
          }
        ],
        "relationships": [
          {
            "kind": "leader_of",
            "category": "political",
            "probability": 1.5,
            "comment": "Leads colony and possibly faction"
          },
          {
            "kind": "resident_of",
            "category": "spatial",
            "probability": 1,
            "comment": "Lives in governed colony"
          },
          {
            "kind": "member_of",
            "category": "political",
            "probability": 0.5,
            "comment": "Joins faction if predecessor led one"
          }
        ]
      },
      "effects": {
        "graphDensity": 0.3,
        "clusterFormation": 0.4,
        "diversityImpact": 0.2,
        "comment": "Replaces dead/old leaders with new ones, maintaining political structure"
      },
      "tags": [
        "succession",
        "leadership-change"
      ]
    }
  },
  {
    "id": "orca_raider_arrival",
    "name": "Orca Raiders Arrive",
    "applicability": [
      {
        "type": "or",
        "rules": [
          {
            "type": "era_match",
            "eras": [
              "invasion"
            ]
          },
          {
            "type": "pressure_threshold",
            "pressureId": "external_threat",
            "min": 70,
            "max": 100
          }
        ]
      },
      {
        "type": "entity_count_max",
        "kind": "npc",
        "subtype": "orca",
        "max": 5,
        "overshootFactor": 1
      }
    ],
    "selection": {
      "strategy": "by_kind",
      "kind": "location",
      "subtypes": [
        "colony"
      ],
      "pickStrategy": "random"
    },
    "creation": [
      {
        "entityRef": "$orca1",
        "kind": "npc",
        "subtype": "orca",
        "status": "alive",
        "prominence": "marginal",
        "culture": {
          "fixed": "orca"
        },
        "description": {
          "template": "A fearsome orca raider threatening {colonyName} from the depths",
          "replacements": {
            "colonyName": "$target.name"
          }
        },
        "tags": {
          "orca": true,
          "raider": true,
          "external-threat": true,
          "predator": true,
          "underwater": true
        },
        "placement": {
          "type": "near_entity",
          "entity": "$target"
        }
      }
    ],
    "relationships": [
      {
        "kind": "enemy_of",
        "src": "$orca1",
        "dst": "$defender",
        "strength": 0.8,
        "condition": {
          "type": "entity_exists",
          "entity": "$defender"
        }
      },
      {
        "kind": "enemy_of",
        "src": "$orca1",
        "dst": "$targetFaction",
        "strength": 0.6,
        "condition": {
          "type": "random_chance",
          "chance": 0.5
        }
      },
      {
        "kind": "practitioner_of",
        "src": "$orca1",
        "dst": "$combatAbility",
        "strength": 0.7,
        "condition": {
          "type": "entity_exists",
          "entity": "$combatAbility"
        }
      },
      {
        "kind": "inspired_by",
        "src": "$orca1",
        "dst": "$existingOrca",
        "strength": 0.7,
        "distance": {
          "min": 0.2,
          "max": 0.4
        },
        "condition": {
          "type": "random_chance",
          "chance": 0.5
        }
      }
    ],
    "stateUpdates": [
      {
        "type": "modify_pressure",
        "pressureId": "external_threat",
        "delta": 10
      },
      {
        "type": "modify_pressure",
        "pressureId": "conflict",
        "delta": 5
      }
    ],
    "variables": {
      "$defender": {
        "select": {
          "from": "graph",
          "strategy": "by_kind",
          "kind": "npc",
          "subtypes": [
            "hero",
            "mayor"
          ],
          "statusFilter": "alive",
          "pickStrategy": "random"
        }
      },
      "$targetFaction": {
        "select": {
          "from": "graph",
          "strategy": "by_kind",
          "kind": "faction",
          "pickStrategy": "random"
        }
      },
      "$combatAbility": {
        "select": {
          "from": "graph",
          "strategy": "by_kind",
          "kind": "abilities",
          "pickStrategy": "random"
        }
      },
      "$existingOrca": {
        "select": {
          "from": "graph",
          "strategy": "by_kind",
          "kind": "npc",
          "subtypes": [
            "orca"
          ],
          "pickStrategy": "random"
        }
      }
    },
    "metadata": {
      "produces": {
        "entityKinds": [
          {
            "kind": "npc",
            "subtype": "orca",
            "count": {
              "min": 1,
              "max": 1
            },
            "prominence": [
              {
                "level": "marginal",
                "probability": 0.6
              },
              {
                "level": "recognized",
                "probability": 0.3
              },
              {
                "level": "renowned",
                "probability": 0.1
              }
            ]
          }
        ],
        "relationships": [
          {
            "kind": "enemy_of",
            "category": "conflict",
            "probability": 0.9,
            "comment": "Orcas vs colonies and heroes"
          },
          {
            "kind": "practitioner_of",
            "category": "cultural",
            "probability": 0.7,
            "comment": "Orcas use abilities"
          }
        ]
      },
      "effects": {
        "graphDensity": 0.4,
        "clusterFormation": 0.2,
        "diversityImpact": 0.8,
        "comment": "Injects external threat cluster into the world"
      },
      "tags": [
        "external-threat",
        "invasion",
        "cluster"
      ]
    }
  },
  {
    "id": "faction_splinter",
    "name": "Faction Schism",
    "applicability": [
      {
        "type": "entity_count_min",
        "kind": "faction",
        "min": 1
      }
    ],
    "selection": {
      "strategy": "by_kind",
      "kind": "faction",
      "filters": [
        {
          "type": "graph_path",
          "assert": {
            "check": "count_min",
            "count": 1,
            "path": [
              {
                "via": "member_of",
                "direction": "in",
                "targetKind": "npc"
              }
            ]
          }
        }
      ],
      "pickStrategy": "random"
    },
    "creation": [
      {
        "entityRef": "$splinter",
        "kind": "faction",
        "subtype": {
          "inherit": "$target",
          "chance": 0.6,
          "fallback": "random"
        },
        "status": "waning",
        "prominence": "marginal",
        "culture": {
          "inherit": "$target"
        },
        "description": {
          "template": "A splinter group that broke away from {parentName}",
          "replacements": {
            "parentName": "$target.name"
          }
        },
        "tags": {
          "splinter": true
        },
        "placement": {
          "type": "at_location",
          "location": "$location"
        }
      }
    ],
    "relationships": [
      {
        "kind": "split_from",
        "src": "$splinter",
        "dst": "$target",
        "distance": { "min": 15, "max": 80 }
      },
      {
        "kind": "at_war_with",
        "src": "$splinter",
        "dst": "$target",
        "strength": 0.7
      },
      {
        "kind": "occupies",
        "src": "$splinter",
        "dst": "$location",
        "strength": 0.6
      },
      {
        "kind": "leader_of",
        "src": "$defector",
        "dst": "$splinter",
        "strength": 0.9,
        "condition": {
          "type": "entity_exists",
          "entity": "$defector"
        }
      },
      {
        "kind": "member_of",
        "src": "$defector",
        "dst": "$splinter",
        "strength": 0.85,
        "condition": {
          "type": "entity_exists",
          "entity": "$defector"
        }
      },
      {
        "kind": "resident_of",
        "src": "$defector",
        "dst": "$location",
        "strength": 0.7,
        "condition": {
          "type": "entity_exists",
          "entity": "$defector"
        }
      }
    ],
    "stateUpdates": [
      {
        "type": "archive_relationship",
        "entity": "$defector",
        "relationshipKind": "member_of",
        "with": "$target"
      },
      {
        "type": "modify_pressure",
        "pressureId": "conflict",
        "delta": 3
      },
      {
        "type": "modify_pressure",
        "pressureId": "cultural_tension",
        "delta": 2
      }
    ],
    "variables": {
      "$members": {
        "select": {
          "from": {
            "relatedTo": "$target",
            "relationship": "member_of",
            "direction": "dst"
          },
          "pickStrategy": "all"
        }
      },
      "$defector": {
        "select": {
          "from": {
            "relatedTo": "$target",
            "relationship": "member_of",
            "direction": "dst"
          },
          "filters": [
            {
              "type": "lacks_relationship",
              "kind": "leader_of"
            }
          ],
          "pickStrategy": "random",
          "fallback": "$firstMember"
        }
      },
      "$firstMember": {
        "select": {
          "from": {
            "relatedTo": "$target",
            "relationship": "member_of",
            "direction": "dst"
          },
          "pickStrategy": "first"
        }
      },
      "$location": {
        "select": {
          "from": {
            "relatedTo": "$target",
            "relationship": "controls",
            "direction": "src"
          },
          "pickStrategy": "random",
          "fallback": "$occupiedLocation"
        }
      },
      "$occupiedLocation": {
        "select": {
          "from": {
            "relatedTo": "$target",
            "relationship": "occupies",
            "direction": "src"
          },
          "pickStrategy": "random",
          "fallback": "$anyColony"
        }
      },
      "$anyColony": {
        "select": {
          "from": "graph",
          "strategy": "by_kind",
          "kind": "location",
          "subtypes": [
            "colony"
          ],
          "pickStrategy": "random"
        }
      }
    },
    "metadata": {
      "produces": {
        "entityKinds": [
          {
            "kind": "faction",
            "subtype": "various",
            "count": {
              "min": 1,
              "max": 1
            },
            "prominence": [
              {
                "level": "marginal",
                "probability": 1
              }
            ]
          }
        ],
        "relationships": [
          {
            "kind": "split_from",
            "category": "immutable_fact",
            "probability": 1,
            "comment": "Splinter lineage with ideological distance"
          },
          {
            "kind": "leader_of",
            "category": "institutional",
            "probability": 1,
            "comment": "Defector leads splinter"
          },
          {
            "kind": "member_of",
            "category": "institutional",
            "probability": 1,
            "comment": "Defector joins splinter"
          },
          {
            "kind": "at_war_with",
            "category": "political",
            "probability": 1,
            "comment": "Splinter wars with parent"
          },
          {
            "kind": "occupies",
            "category": "spatial",
            "probability": 1,
            "comment": "Splinter occupies location"
          }
        ]
      },
      "effects": {
        "graphDensity": 0.4,
        "clusterFormation": 0.6,
        "diversityImpact": 0.7,
        "comment": "Creates new faction clusters with conflict relationships"
      },
      "parameters": {
        "leaderHeroChance": {
          "value": 0.5,
          "min": 0,
          "max": 1,
          "description": "Probability splinter leader is hero vs outlaw"
        }
      },
      "tags": [
        "conflict",
        "faction-diversity"
      ]
    }
  },
  {
    "id": "territorial_expansion",
    "name": "Territorial Expansion",
    "applicability": [
      {
        "type": "entity_count_min",
        "kind": "faction",
        "min": 1
      },
      {
        "type": "entity_count_min",
        "kind": "location",
        "min": 2
      }
    ],
    "selection": {
      "strategy": "by_kind",
      "kind": "faction",
      "filters": [
        {
          "type": "graph_path",
          "assert": {
            "check": "exists",
            "path": [
              {
                "via": "controls",
                "direction": "out",
                "targetKind": "location",
                "as": "$controlled"
              },
              {
                "via": "adjacent_to",
                "direction": "out",
                "targetKind": "location"
              }
            ],
            "where": [
              {
                "type": "not_in",
                "set": "$controlled"
              }
            ]
          }
        }
      ],
      "pickStrategy": "random"
    },
    "creation": [],
    "relationships": [
      {
        "kind": "controls",
        "src": "$target",
        "dst": "$expansionTarget",
        "strength": 0.75,
        "catalyzedBy": "$catalyst"
      }
    ],
    "stateUpdates": [],
    "variables": {
      "$expansionTarget": {
        "select": {
          "from": "graph",
          "strategy": "by_kind",
          "kind": "location",
          "filters": [
            {
              "type": "graph_path",
              "assert": {
                "check": "exists",
                "path": [
                  {
                    "via": "adjacent_to",
                    "direction": "in",
                    "targetKind": "location"
                  }
                ],
                "where": [
                  {
                    "type": "has_relationship",
                    "kind": "controls",
                    "with": "$target"
                  }
                ]
              }
            },
            {
              "type": "lacks_relationship",
              "kind": "controls",
              "with": "$target"
            }
          ],
          "pickStrategy": "random"
        }
      },
      "$catalyst": {
        "select": {
          "from": {
            "relatedTo": "$target",
            "relationship": "leader_of",
            "direction": "dst"
          },
          "pickStrategy": "random",
          "fallback": "$target"
        }
      }
    },
    "metadata": {
      "produces": {
        "entityKinds": [],
        "relationships": [
          {
            "kind": "controls",
            "category": "political",
            "probability": 1,
            "comment": "Faction expands territorial control"
          }
        ]
      },
      "effects": {
        "graphDensity": 0.3,
        "clusterFormation": 0.6,
        "diversityImpact": 0.4,
        "comment": "Factions expand territory, creating political power structures"
      },
      "parameters": {
        "expansionAggressiveness": {
          "value": 0.5,
          "min": 0.2,
          "max": 1,
          "description": "How readily factions expand into adjacent territories"
        },
        "leaderProminenceBonus": {
          "value": 0.3,
          "min": 0,
          "max": 0.6,
          "description": "Prominence bonus for faction leaders on successful expansion"
        }
      },
      "tags": [
        "world-level",
        "political",
        "territorial"
      ]
    }
  },
  {
    "id": "trade_route_establishment",
    "name": "Trade Route Establishment",
    "applicability": [
      {
        "type": "entity_count_min",
        "kind": "faction",
        "min": 2
      }
    ],
    "selection": {
      "strategy": "by_kind",
      "kind": "faction",
      "filters": [
        {
          "type": "graph_path",
          "assert": {
            "check": "exists",
            "path": [],
            "where": [
              {
                "type": "not_self"
              },
              {
                "type": "kind_equals",
                "kind": "faction"
              },
              {
                "type": "lacks_relationship",
                "kind": "trades_with",
                "with": "$self"
              },
              {
                "type": "lacks_relationship",
                "kind": "at_war_with",
                "with": "$self"
              }
            ]
          }
        }
      ],
      "pickStrategy": "random"
    },
    "creation": [],
    "relationships": [
      {
        "kind": "trades_with",
        "src": "$target",
        "dst": "$partner",
        "strength": 0.6,
        "bidirectional": true,
        "catalyzedBy": "$catalyst"
      }
    ],
    "stateUpdates": [],
    "variables": {
      "$partner": {
        "select": {
          "from": "graph",
          "strategy": "by_kind",
          "kind": "faction",
          "filters": [
            {
              "type": "exclude",
              "entities": [
                "$target"
              ]
            },
            {
              "type": "lacks_relationship",
              "kind": "trades_with",
              "with": "$target"
            },
            {
              "type": "not_at_war",
              "with": "$target"
            }
          ],
          "preferFilters": [
            {
              "type": "has_relationship",
              "kind": "allied_with",
              "with": "$target"
            }
          ],
          "pickStrategy": "random"
        }
      },
      "$catalyst": {
        "select": {
          "from": {
            "relatedTo": "$target",
            "relationship": "member_of",
            "direction": "dst"
          },
          "subtypes": [
            "merchant"
          ],
          "pickStrategy": "random",
          "fallback": "$targetLeader"
        }
      },
      "$targetLeader": {
        "select": {
          "from": {
            "relatedTo": "$target",
            "relationship": "leader_of",
            "direction": "dst"
          },
          "pickStrategy": "first",
          "fallback": "$target"
        }
      }
    },
    "metadata": {
      "produces": {
        "entityKinds": [],
        "relationships": [
          {
            "kind": "trades_with",
            "category": "economic",
            "probability": 1,
            "comment": "Faction establishes trade route"
          }
        ]
      },
      "effects": {
        "graphDensity": 0.5,
        "clusterFormation": 0.7,
        "diversityImpact": 0.4,
        "comment": "Creates economic networks between factions"
      },
      "parameters": {
        "tradeFormationRate": {
          "value": 0.6,
          "min": 0.2,
          "max": 1,
          "description": "How readily factions establish trade relationships"
        },
        "merchantInfluence": {
          "value": 0.2,
          "min": 0,
          "max": 0.5,
          "description": "Influence gain for merchants facilitating trade"
        }
      },
      "tags": [
        "world-level",
        "economic",
        "trade"
      ]
    }
  },
  {
    "id": "guild_establishment",
    "name": "Guild Formation",
    "applicability": [
      {
        "type": "entity_count_min",
        "kind": "npc",
        "subtype": "merchant",
        "min": 2
      },
      {
        "type": "entity_count_min",
        "kind": "location",
        "subtype": "colony",
        "min": 1
      }
    ],
    "selection": {
      "strategy": "by_kind",
      "kind": "location",
      "subtypes": [
        "colony"
      ],
      "filters": [
        {
          "type": "graph_path",
          "assert": {
            "check": "not_exists",
            "path": [
              {
                "via": "controls",
                "direction": "in",
                "targetKind": "faction"
              }
            ],
            "where": [
              {
                "type": "subtype_equals",
                "subtype": "company"
              }
            ]
          }
        }
      ],
      "pickStrategy": "random"
    },
    "creation": [
      {
        "entityRef": "$guild",
        "kind": "faction",
        "subtype": "company",
        "status": "state_sanctioned",
        "prominence": "recognized",
        "culture": {
          "inherit": "$target"
        },
        "description": {
          "template": "A merchant guild controlling trade in {colonyName}",
          "replacements": {
            "colonyName": "$target.name"
          }
        },
        "tags": {
          "trade": true,
          "guild": true,
          "organized": true
        },
        "placement": {
          "type": "near_entity",
          "entity": "$target"
        }
      }
    ],
    "relationships": [
      {
        "kind": "controls",
        "src": "$guild",
        "dst": "$target",
        "strength": 0.85
      },
      {
        "kind": "member_of",
        "src": "$merchant1",
        "dst": "$guild",
        "strength": 0.8,
        "condition": {
          "type": "entity_exists",
          "entity": "$merchant1"
        }
      },
      {
        "kind": "resident_of",
        "src": "$merchant1",
        "dst": "$target",
        "strength": 0.75,
        "condition": {
          "type": "entity_exists",
          "entity": "$merchant1"
        }
      },
      {
        "kind": "member_of",
        "src": "$merchant2",
        "dst": "$guild",
        "strength": 0.8,
        "condition": {
          "type": "entity_exists",
          "entity": "$merchant2"
        }
      },
      {
        "kind": "resident_of",
        "src": "$merchant2",
        "dst": "$target",
        "strength": 0.75,
        "condition": {
          "type": "entity_exists",
          "entity": "$merchant2"
        }
      }
    ],
    "stateUpdates": [],
    "variables": {
      "$merchants": {
        "select": {
          "from": "graph",
          "strategy": "by_kind",
          "kind": "npc",
          "subtypes": [
            "merchant"
          ],
          "filters": [
            {
              "type": "lacks_relationship",
              "kind": "member_of"
            }
          ],
          "pickStrategy": "all"
        }
      },
      "$merchant1": {
        "select": {
          "from": "graph",
          "strategy": "by_kind",
          "kind": "npc",
          "subtypes": [
            "merchant"
          ],
          "filters": [
            {
              "type": "lacks_relationship",
              "kind": "member_of"
            }
          ],
          "pickStrategy": "random"
        }
      },
      "$merchant2": {
        "select": {
          "from": "graph",
          "strategy": "by_kind",
          "kind": "npc",
          "subtypes": [
            "merchant"
          ],
          "filters": [
            {
              "type": "lacks_relationship",
              "kind": "member_of"
            },
            {
              "type": "exclude",
              "entities": [
                "$merchant1"
              ]
            }
          ],
          "pickStrategy": "random"
        }
      }
    },
    "metadata": {
      "produces": {
        "entityKinds": [
          {
            "kind": "faction",
            "subtype": "company",
            "count": {
              "min": 1,
              "max": 1
            },
            "prominence": [
              {
                "level": "recognized",
                "probability": 1
              }
            ]
          }
        ],
        "relationships": [
          {
            "kind": "controls",
            "category": "political",
            "probability": 1,
            "comment": "Guild controls colony trade"
          },
          {
            "kind": "member_of",
            "category": "political",
            "probability": 2,
            "comment": "Merchants join guild"
          },
          {
            "kind": "resident_of",
            "category": "spatial",
            "probability": 2,
            "comment": "Merchants reside in colony"
          }
        ]
      },
      "effects": {
        "graphDensity": 0.6,
        "clusterFormation": 0.8,
        "diversityImpact": 0.4,
        "comment": "Forms tight economic clusters within colonies"
      },
      "tags": [
        "economic",
        "colony-centric",
        "cluster-forming"
      ]
    }
  },
  {
    "id": "cult_formation",
    "name": "Cult Awakening",
    "applicability": [
      {
        "type": "or",
        "rules": [
          {
            "type": "entity_count_min",
            "kind": "location",
            "subtype": "anomaly",
            "min": 1
          },
          {
            "type": "entity_count_min",
            "kind": "abilities",
            "subtype": "magic",
            "min": 1
          }
        ]
      },
      {
        "type": "entity_count_max",
        "kind": "faction",
        "subtype": "cult",
        "max": 10,
        "overshootFactor": 1
      }
    ],
    "selection": {
      "strategy": "by_kind",
      "kind": "location",
      "subtypes": [
        "anomaly",
        "colony",
        "geographic_feature"
      ],
      "pickStrategy": "random"
    },
    "creation": [
      {
        "entityRef": "$cult",
        "kind": "faction",
        "subtype": "cult",
        "status": "illegal",
        "prominence": "marginal",
        "culture": {
          "inherit": "$target"
        },
        "description": {
          "template": "A mystical cult drawn to the power near {locationName}",
          "replacements": {
            "locationName": "$target.name"
          }
        },
        "tags": {
          "mystical": true,
          "secretive": true,
          "cult": true
        },
        "placement": {
          "type": "near_entity",
          "entity": "$target"
        }
      },
      {
        "entityRef": "$prophet",
        "kind": "npc",
        "subtype": "hero",
        "status": "alive",
        "prominence": "marginal",
        "culture": {
          "inherit": "$target"
        },
        "description": {
          "template": "The enigmatic prophet of a mystical cult near {locationName}",
          "replacements": {
            "locationName": "$target.name"
          }
        },
        "tags": {
          "prophet": true,
          "mystical": true
        },
        "placement": {
          "type": "near_entity",
          "entity": "$target"
        }
      }
    ],
    "relationships": [
      {
        "kind": "occupies",
        "src": "$cult",
        "dst": "$target",
        "strength": 0.8
      },
      {
        "kind": "leader_of",
        "src": "$prophet",
        "dst": "$cult",
        "strength": 0.9
      },
      {
        "kind": "resident_of",
        "src": "$prophet",
        "dst": "$target",
        "strength": 0.85
      },
      {
        "kind": "member_of",
        "src": "$cultist",
        "dst": "$cult",
        "strength": 0.75,
        "condition": {
          "type": "entity_exists",
          "entity": "$cultist"
        }
      },
      {
        "kind": "resident_of",
        "src": "$cultist",
        "dst": "$target",
        "strength": 0.7,
        "condition": {
          "type": "entity_exists",
          "entity": "$cultist"
        }
      },
      {
        "kind": "seeks",
        "src": "$cult",
        "dst": "$magic",
        "strength": 0.8,
        "condition": {
          "type": "entity_exists",
          "entity": "$magic"
        }
      },
      {
        "kind": "practitioner_of",
        "src": "$prophet",
        "dst": "$magic",
        "strength": 0.85,
        "condition": {
          "type": "entity_exists",
          "entity": "$magic"
        }
      }
    ],
    "stateUpdates": [],
    "variables": {
      "$magic": {
        "select": {
          "from": "graph",
          "strategy": "by_kind",
          "kind": "abilities",
          "subtypes": [
            "magic"
          ],
          "pickStrategy": "first"
        }
      },
      "$cultist": {
        "select": {
          "from": "graph",
          "strategy": "by_kind",
          "kind": "npc",
          "subtypes": [
            "merchant",
            "outlaw",
            "hero"
          ],
          "filters": [
            {
              "type": "lacks_relationship",
              "kind": "member_of"
            }
          ],
          "pickStrategy": "random"
        }
      }
    },
    "metadata": {
      "produces": {
        "entityKinds": [
          {
            "kind": "faction",
            "subtype": "cult",
            "count": {
              "min": 1,
              "max": 1
            },
            "prominence": [
              {
                "level": "marginal",
                "probability": 1
              }
            ]
          },
          {
            "kind": "npc",
            "subtype": "hero",
            "count": {
              "min": 1,
              "max": 1
            },
            "prominence": [
              {
                "level": "marginal",
                "probability": 1
              }
            ]
          }
        ],
        "relationships": [
          {
            "kind": "occupies",
            "category": "spatial",
            "probability": 1,
            "comment": "Cult occupies anomaly/location"
          },
          {
            "kind": "leader_of",
            "category": "political",
            "probability": 1,
            "comment": "Prophet leads cult"
          },
          {
            "kind": "resident_of",
            "category": "spatial",
            "probability": 2,
            "comment": "Prophet + cultist reside"
          },
          {
            "kind": "member_of",
            "category": "political",
            "probability": 1,
            "comment": "Cultist joins"
          },
          {
            "kind": "seeks",
            "category": "cultural",
            "probability": 0.8,
            "comment": "Cult seeks magic if exists"
          },
          {
            "kind": "practitioner_of",
            "category": "cultural",
            "probability": 0.8,
            "comment": "Prophet practices magic if exists"
          }
        ]
      },
      "effects": {
        "graphDensity": 0.7,
        "clusterFormation": 0.9,
        "diversityImpact": 0.5,
        "comment": "Creates tight mystical clusters near anomalies"
      },
      "parameters": {
        "numCultists": {
          "value": 1,
          "min": 1,
          "max": 3,
          "description": "Number of initial cultist followers"
        }
      },
      "tags": [
        "mystical",
        "anomaly-driven",
        "cluster-forming"
      ]
    }
  },
  {
    "id": "colony_founding",
    "name": "Colony Foundation",
    "applicability": [
      {
        "type": "entity_count_max",
        "kind": "location",
        "subtype": "colony",
        "max": 5,
        "overshootFactor": 1
      },
      {
        "type": "entity_count_min",
        "kind": "npc",
        "min": 20
      }
    ],
    "selection": {
      "strategy": "by_kind",
      "kind": "location",
      "subtypes": [
        "iceberg"
      ],
      "pickStrategy": "random"
    },
    "creation": [
      {
        "entityRef": "$colony",
        "kind": "location",
        "subtype": "colony",
        "status": "thriving",
        "prominence": "marginal",
        "culture": {
          "inherit": "$existingColony",
          "fallback": "aurora-stack"
        },
        "description": {
          "template": "New colony established on {icebergName} in the reaches",
          "replacements": {
            "icebergName": "$target.name"
          }
        },
        "tags": {
          "new": true,
          "colony": true
        },
        "placement": {
          "type": "near_entity",
          "entity": "$target",
          "minDistance": 20
        }
      }
    ],
    "relationships": [
      {
        "kind": "contained_by",
        "src": "$colony",
        "dst": "$target",
        "strength": 1
      }
    ],
    "stateUpdates": [],
    "variables": {
      "$existingColony": {
        "select": {
          "from": {
            "relatedTo": "$target",
            "relationship": "contained_by",
            "direction": "dst"
          },
          "strategy": "by_kind",
          "kind": "location",
          "subtypes": [
            "colony"
          ],
          "pickStrategy": "first"
        }
      }
    },
    "metadata": {
      "produces": {
        "entityKinds": [
          {
            "kind": "location",
            "subtype": "colony",
            "count": {
              "min": 1,
              "max": 1
            },
            "prominence": [
              {
                "level": "marginal",
                "probability": 1
              }
            ]
          }
        ],
        "relationships": [
          {
            "kind": "contained_by",
            "category": "spatial",
            "probability": 1,
            "comment": "Colony on iceberg"
          }
        ]
      },
      "effects": {
        "graphDensity": 0.1,
        "clusterFormation": 0.3,
        "diversityImpact": 0.3,
        "comment": "Adds new colony nodes with realistic spatial placement"
      },
      "parameters": {
        "minDistanceFromColonies": {
          "value": 20,
          "min": 10,
          "max": 40,
          "description": "Minimum distance from existing colonies"
        }
      },
      "tags": [
        "expansion",
        "colony-formation",
        "region-aware"
      ]
    }
  },
  {
    "id": "anomaly_manifestation",
    "name": "Anomaly Appears",
    "applicability": [
      {
        "type": "or",
        "rules": [
          {
            "type": "pressure_threshold",
            "pressureId": "magical_instability",
            "min": 30,
            "max": 100
          },
          {
            "type": "random_chance",
            "chance": 0.2
          }
        ]
      }
    ],
    "selection": {
      "strategy": "by_kind",
      "kind": "location",
      "pickStrategy": "random"
    },
    "creation": [
      {
        "entityRef": "$anomaly",
        "kind": "location",
        "subtype": "anomaly",
        "status": "unspoiled",
        "prominence": "recognized",
        "culture": {
          "inherit": "$nearestColony",
          "fallback": "world"
        },
        "description": {
          "template": "A mysterious phenomenon deep in the ice, {nearColony}",
          "replacements": {
            "nearColony": "$target.name"
          }
        },
        "tags": {
          "anomaly": true,
          "mystical": true,
          "caverns": true
        },
        "placement": {
          "type": "near_entity",
          "entity": "$target"
        }
      }
    ],
    "relationships": [
      {
        "kind": "adjacent_to",
        "src": "$anomaly",
        "dst": "$target",
        "bidirectional": true,
        "strength": 0.7
      },
      {
        "kind": "discovered_by",
        "src": "$anomaly",
        "dst": "$magicUser",
        "strength": 0.6,
        "condition": {
          "type": "random_chance",
          "chance": 0.7
        }
      }
    ],
    "stateUpdates": [],
    "variables": {
      "$nearestColony": {
        "select": {
          "from": "graph",
          "strategy": "by_kind",
          "kind": "location",
          "subtypes": [
            "colony"
          ],
          "pickStrategy": "random"
        }
      },
      "$magicUser": {
        "select": {
          "from": "graph",
          "strategy": "by_kind",
          "kind": "npc",
          "filters": [
            {
              "type": "has_relationship",
              "kind": "practitioner_of"
            }
          ],
          "pickStrategy": "random"
        }
      }
    },
    "metadata": {
      "produces": {
        "entityKinds": [
          {
            "kind": "location",
            "subtype": "anomaly",
            "count": {
              "min": 1,
              "max": 1
            },
            "prominence": [
              {
                "level": "recognized",
                "probability": 1
              }
            ]
          }
        ],
        "relationships": [
          {
            "kind": "adjacent_to",
            "category": "spatial",
            "probability": 1,
            "comment": "Adjacent to existing location"
          },
          {
            "kind": "discovered_by",
            "category": "spatial",
            "probability": 0.7,
            "comment": "Magic user discovers it"
          }
        ]
      },
      "effects": {
        "graphDensity": 0.3,
        "clusterFormation": 0.4,
        "diversityImpact": 0.8,
        "comment": "Creates mystical locations in the wilderness between settlements"
      },
      "parameters": {
        "activationChance": {
          "value": 0.2,
          "min": 0.05,
          "max": 0.5,
          "description": "Probability of manifestation when magical_instability is low"
        },
        "minDistanceFromColonies": {
          "value": 8,
          "min": 5,
          "max": 20,
          "description": "Minimum distance from colony centers"
        },
        "maxDistanceFromColonies": {
          "value": 25,
          "min": 15,
          "max": 40,
          "description": "Maximum distance from any colony (for discoverability)"
        }
      },
      "tags": [
        "mystical",
        "pressure-driven",
        "region-aware"
      ]
    }
  },
  {
    "id": "resource_location_discovery",
    "name": "Resource Location Discovery",
    "applicability": [
      {
        "type": "pressure_threshold",
        "pressureId": "resource_scarcity",
        "min": 1,
        "max": 100
      },
      {
        "type": "entity_count_min",
        "kind": "npc",
        "min": 1
      },
      {
        "type": "entity_count_min",
        "kind": "location",
        "min": 1
      }
    ],
    "selection": {
      "strategy": "by_preference_order",
      "kind": "npc",
      "subtypePreferences": [
        "hero",
        "outlaw",
        "merchant"
      ],
      "statusFilter": "alive",
      "pickStrategy": "random"
    },
    "creation": [
      {
        "entityRef": "$resource",
        "kind": "location",
        "subtype": "geographic_feature",
        "status": "unspoiled",
        "prominence": "marginal",
        "culture": {
          "inherit": "$target"
        },
        "description": {
          "template": "A resource-rich location discovered to address scarcity",
          "replacements": {}
        },
        "tags": {
          "resource": true,
          "discovered": true
        },
        "placement": {
          "type": "near_entity",
          "entity": "$target"
        }
      }
    ],
    "relationships": [
      {
        "kind": "explorer_of",
        "src": "$target",
        "dst": "$resource",
        "strength": 0.8
      },
      {
        "kind": "discovered_by",
        "src": "$resource",
        "dst": "$target",
        "strength": 0.8
      },
      {
        "kind": "adjacent_to",
        "src": "$resource",
        "dst": "$nearbyLocation",
        "bidirectional": true,
        "strength": 0.6,
        "condition": {
          "type": "entity_exists",
          "entity": "$nearbyLocation"
        }
      }
    ],
    "stateUpdates": [
      {
        "type": "update_discovery_state"
      },
      {
        "type": "modify_pressure",
        "pressureId": "resource_scarcity",
        "delta": -5
      }
    ],
    "variables": {
      "$nearbyLocation": {
        "select": {
          "from": "graph",
          "strategy": "by_kind",
          "kind": "location",
          "pickStrategy": "random"
        }
      }
    },
    "metadata": {
      "produces": {
        "entityKinds": [
          {
            "kind": "location",
            "subtype": "geographic_feature",
            "count": {
              "min": 1,
              "max": 1
            },
            "prominence": [
              {
                "level": "marginal",
                "probability": 1
              }
            ]
          }
        ],
        "relationships": [
          {
            "kind": "explorer_of",
            "category": "spatial",
            "probability": 1,
            "comment": "Explorer finds resource"
          },
          {
            "kind": "discovered_by",
            "category": "spatial",
            "probability": 1,
            "comment": "Resource discovered"
          },
          {
            "kind": "adjacent_to",
            "category": "spatial",
            "probability": 0.8,
            "comment": "Adjacent to nearby location"
          }
        ]
      },
      "effects": {
        "graphDensity": 0.4,
        "clusterFormation": 0.3,
        "diversityImpact": 0.6,
        "comment": "Procedurally generates resource locations based on scarcity"
      },
      "tags": [
        "emergent",
        "resource",
        "scarcity-driven"
      ]
    }
  },
  {
    "id": "emergent_location_discovery",
    "name": "Location Discovery",
    "applicability": [
      {
        "type": "or",
        "rules": [
          {
            "type": "pressure_any_above",
            "pressureIds": [
              "conflict",
              "magical_instability",
              "resource_scarcity"
            ],
            "threshold": 10
          },
          {
            "type": "random_chance",
            "chance": 0.05
          }
        ]
      }
    ],
    "selection": {
      "strategy": "by_preference_order",
      "kind": "npc",
      "subtypePreferences": [
        "hero",
        "outlaw",
        "merchant",
        "mayor"
      ],
      "statusFilter": "alive",
      "pickStrategy": "random"
    },
    "creation": [
      {
        "entityRef": "$location",
        "kind": "location",
        "subtype": "geographic_feature",
        "status": "unspoiled",
        "prominence": "recognized",
        "culture": {
          "inherit": "$target"
        },
        "description": {
          "template": "A newly discovered location providing tactical or resource advantage",
          "replacements": {}
        },
        "tags": {
          "discovered": true,
          "emergent": true
        },
        "placement": {
          "type": "near_entity",
          "entity": "$target"
        }
      }
    ],
    "relationships": [
      {
        "kind": "explorer_of",
        "src": "$target",
        "dst": "$location",
        "strength": 0.8
      },
      {
        "kind": "discovered_by",
        "src": "$location",
        "dst": "$target",
        "strength": 0.8
      },
      {
        "kind": "adjacent_to",
        "src": "$location",
        "dst": "$nearbyLocation",
        "bidirectional": true,
        "strength": 0.6,
        "condition": {
          "type": "entity_exists",
          "entity": "$nearbyLocation"
        }
      }
    ],
    "stateUpdates": [],
    "variables": {
      "$nearbyLocation": {
        "select": {
          "from": "graph",
          "strategy": "by_kind",
          "kind": "location",
          "pickStrategy": "random"
        }
      }
    },
    "metadata": {
      "produces": {
        "entityKinds": [
          {
            "kind": "location",
            "subtype": "geographic_feature",
            "count": {
              "min": 1,
              "max": 1
            },
            "prominence": [
              {
                "level": "recognized",
                "probability": 1
              }
            ]
          }
        ],
        "relationships": [
          {
            "kind": "explorer_of",
            "category": "spatial",
            "probability": 1,
            "comment": "Explorer discovers location"
          },
          {
            "kind": "discovered_by",
            "category": "spatial",
            "probability": 1,
            "comment": "Location discovered"
          },
          {
            "kind": "adjacent_to",
            "category": "spatial",
            "probability": 0.8,
            "comment": "Adjacent to nearby location"
          }
        ]
      },
      "effects": {
        "graphDensity": 0.4,
        "clusterFormation": 0.4,
        "diversityImpact": 0.7,
        "comment": "Procedurally generates locations based on world state (conflict, magic, scarcity)"
      },
      "tags": [
        "emergent",
        "discovery",
        "adaptive"
      ]
    }
  },
  {
    "id": "geographic_exploration",
    "name": "Geographic Exploration",
    "applicability": [
      {
        "type": "era_match",
        "eras": [
          "expansion",
          "reconstruction",
          "innovation"
        ]
      },
      {
        "type": "entity_count_max",
        "kind": "location",
        "max": 35,
        "overshootFactor": 1
      },
      {
        "type": "cooldown_elapsed",
        "cooldownTicks": 8
      },
      {
        "type": "discoveries_per_epoch",
        "maxPerEpoch": 2
      },
      {
        "type": "random_chance",
        "chance": 0.08
      }
    ],
    "selection": {
      "strategy": "by_preference_order",
      "kind": "npc",
      "subtypePreferences": [
        "hero",
        "merchant"
      ],
      "statusFilter": "alive",
      "pickStrategy": "random"
    },
    "creation": [
      {
        "entityRef": "$discovery",
        "kind": "location",
        "subtype": "geographic_feature",
        "status": "unspoiled",
        "prominence": "marginal",
        "culture": {
          "inherit": "$target"
        },
        "description": {
          "template": "A newly discovered geographic feature during the age of exploration",
          "replacements": {}
        },
        "tags": {
          "explored": true,
          "geographic": true
        },
        "placement": {
          "type": "near_entity",
          "entity": "$target"
        }
      }
    ],
    "relationships": [
      {
        "kind": "explorer_of",
        "src": "$target",
        "dst": "$discovery",
        "strength": 0.8
      },
      {
        "kind": "discovered_by",
        "src": "$discovery",
        "dst": "$target",
        "strength": 0.8
      },
      {
        "kind": "adjacent_to",
        "src": "$discovery",
        "dst": "$nearbyLocation",
        "bidirectional": true,
        "strength": 0.6,
        "condition": {
          "type": "entity_exists",
          "entity": "$nearbyLocation"
        }
      }
    ],
    "stateUpdates": [
      {
        "type": "update_discovery_state"
      }
    ],
    "variables": {
      "$nearbyLocation": {
        "select": {
          "from": "graph",
          "strategy": "by_kind",
          "kind": "location",
          "pickStrategy": "random"
        }
      }
    },
    "metadata": {
      "produces": {
        "entityKinds": [
          {
            "kind": "location",
            "subtype": "various",
            "count": {
              "min": 1,
              "max": 1
            },
            "prominence": [
              {
                "level": "marginal",
                "probability": 1
              }
            ]
          }
        ],
        "relationships": [
          {
            "kind": "explorer_of",
            "category": "spatial",
            "probability": 1,
            "comment": "NPC explores location"
          },
          {
            "kind": "discovered_by",
            "category": "spatial",
            "probability": 1,
            "comment": "Location discovered by NPC"
          },
          {
            "kind": "adjacent_to",
            "category": "spatial",
            "probability": 0.8,
            "comment": "Adjacent to nearby location"
          }
        ]
      },
      "effects": {
        "graphDensity": 0.4,
        "clusterFormation": 0.3,
        "diversityImpact": 0.7,
        "comment": "Procedurally generates neutral locations based on era themes"
      },
      "parameters": {
        "baseChance": {
          "value": 0.08,
          "min": 0.01,
          "max": 0.3,
          "description": "Base probability of discovery when other conditions met"
        }
      },
      "tags": [
        "emergent",
        "exploration",
        "era-driven"
      ]
    }
  },
  {
    "id": "krill_bloom_migration",
    "name": "Krill Bloom Discovery",
    "applicability": [
      {
        "type": "or",
        "rules": [
          {
            "type": "pressure_threshold",
            "pressureId": "resource_scarcity",
            "min": 60,
            "max": 100
          },
          {
            "type": "random_chance",
            "chance": 0.05
          }
        ]
      },
      {
        "type": "entity_count_min",
        "kind": "location",
        "subtype": "colony",
        "min": 2
      },
      {
        "type": "entity_count_min",
        "kind": "faction",
        "min": 1
      }
    ],
    "selection": {
      "strategy": "by_kind",
      "kind": "location",
      "subtypes": [
        "colony"
      ],
      "pickStrategy": "random"
    },
    "creation": [
      {
        "entityRef": "$bloom",
        "kind": "location",
        "subtype": "geographic_feature",
        "status": "thriving",
        "prominence": "recognized",
        "culture": {
          "inherit": "$target"
        },
        "description": "Massive bioluminescent krill swarms dance in these waters, drawing merchants and hunters from across the berg.",
        "tags": {
          "krill": true,
          "bloom": true,
          "resource": true
        },
        "placement": {
          "type": "near_entity",
          "entity": "$target"
        }
      },
      {
        "entityRef": "$merchant",
        "kind": "npc",
        "subtype": "merchant",
        "status": "alive",
        "prominence": "marginal",
        "culture": {
          "inherit": "$target"
        },
        "description": "An enterprising merchant who discovered the krill blooms and now leads expeditions to harvest them.",
        "tags": {
          "explorer": true,
          "merchant": true,
          "krill": true
        },
        "placement": {
          "type": "near_entity",
          "entity": "$target"
        }
      }
    ],
    "relationships": [
      {
        "kind": "adjacent_to",
        "src": "$bloom",
        "dst": "$target",
        "strength": 0.8
      },
      {
        "kind": "adjacent_to",
        "src": "$bloom",
        "dst": "$secondColony",
        "strength": 0.7,
        "condition": {
          "type": "entity_exists",
          "entity": "$secondColony"
        }
      },
      {
        "kind": "resident_of",
        "src": "$merchant",
        "dst": "$target",
        "strength": 0.8
      },
      {
        "kind": "member_of",
        "src": "$merchant",
        "dst": "$faction",
        "strength": 0.75,
        "condition": {
          "type": "entity_exists",
          "entity": "$faction"
        }
      },
      {
        "kind": "explorer_of",
        "src": "$merchant",
        "dst": "$bloom",
        "strength": 0.85
      },
      {
        "kind": "discoverer_of",
        "src": "$merchant",
        "dst": "$technology",
        "strength": 0.6,
        "condition": {
          "type": "random_chance",
          "chance": 0.1
        }
      }
    ],
    "stateUpdates": [
      {
        "type": "modify_pressure",
        "pressureId": "resource_scarcity",
        "delta": -10
      }
    ],
    "variables": {
      "$secondColony": {
        "select": {
          "from": "graph",
          "strategy": "by_kind",
          "kind": "location",
          "subtypes": [
            "colony"
          ],
          "filters": [
            {
              "type": "exclude",
              "entities": [
                "$target"
              ]
            }
          ],
          "pickStrategy": "random"
        }
      },
      "$faction": {
        "select": {
          "from": "graph",
          "strategy": "by_kind",
          "kind": "faction",
          "pickStrategy": "random"
        }
      },
      "$technology": {
        "select": {
          "from": "graph",
          "strategy": "by_kind",
          "kind": "abilities",
          "subtypes": [
            "technology"
          ],
          "pickStrategy": "random"
        }
      }
    },
    "metadata": {
      "produces": {
        "entityKinds": [
          {
            "kind": "location",
            "subtype": "geographic_feature",
            "count": {
              "min": 1,
              "max": 1
            },
            "prominence": [
              {
                "level": "recognized",
                "probability": 1
              }
            ]
          },
          {
            "kind": "npc",
            "subtype": "merchant",
            "count": {
              "min": 1,
              "max": 1
            },
            "prominence": [
              {
                "level": "marginal",
                "probability": 1
              }
            ]
          }
        ],
        "relationships": [
          {
            "kind": "adjacent_to",
            "category": "spatial",
            "probability": 1.5,
            "comment": "Bloom connected to colonies"
          },
          {
            "kind": "resident_of",
            "category": "spatial",
            "probability": 1,
            "comment": "Merchant resides"
          },
          {
            "kind": "member_of",
            "category": "political",
            "probability": 0.8,
            "comment": "Merchant joins faction"
          },
          {
            "kind": "explorer_of",
            "category": "spatial",
            "probability": 1,
            "comment": "Merchant explores bloom"
          },
          {
            "kind": "discoverer_of",
            "category": "cultural",
            "probability": 0.1,
            "comment": "Rare tech discovery"
          }
        ]
      },
      "effects": {
        "graphDensity": 0.7,
        "clusterFormation": 0.5,
        "diversityImpact": 0.6,
        "comment": "Creates resource frontier using Voronoi-like placement"
      },
      "parameters": {
        "activationChance": {
          "value": 0.05,
          "min": 0.01,
          "max": 0.2,
          "description": "Probability when scarcity is low"
        },
        "techDiscoveryChance": {
          "value": 0.1,
          "min": 0,
          "max": 0.5,
          "description": "Probability of discovering fishing technology"
        }
      },
      "tags": [
        "resource",
        "voronoi-placement",
        "frontier"
      ]
    }
  },
  {
    "id": "war_outbreak",
    "name": "War Outbreak",
    "applicability": [
      {
        "type": "tag_exists",
        "kind": "faction",
        "tag": "war_brewing",
        "minCount": 2
      }
    ],
    "selection": {
      "strategy": "by_kind",
      "kind": "faction",
      "filters": [
        {
          "type": "has_tag",
          "tag": "war_brewing"
        }
      ],
      "pickStrategy": "random"
    },
    "creation": [
      {
        "entityRef": "$war",
        "kind": "occurrence",
        "subtype": "war",
        "status": "active",
        "prominence": "renowned",
        "culture": {
          "inherit": "$target"
        },
        "description": {
          "template": "A devastating war has erupted involving {factionName} and their rivals",
          "replacements": {
            "factionName": "$target.name"
          }
        },
        "tags": {
          "conflict": true,
          "military": true,
          "devastating": true
        },
        "placement": {
          "type": "near_entity",
          "entity": "$target"
        }
      }
    ],
    "relationships": [
      {
        "kind": "active_during",
        "src": "$war",
        "dst": "$currentEra",
        "strength": 1
      },
      {
        "kind": "participant_in",
        "src": "$target",
        "dst": "$war",
        "strength": 0.9
      },
      {
        "kind": "participant_in",
        "src": "$enemy",
        "dst": "$war",
        "strength": 0.9,
        "condition": {
          "type": "entity_exists",
          "entity": "$enemy"
        }
      }
    ],
    "stateUpdates": [
      {
        "type": "remove_tag",
        "entity": "$target",
        "tag": "war_brewing"
      },
      {
        "type": "set_tag",
        "entity": "$target",
        "tag": "at_war",
        "value": true
      },
      {
        "type": "modify_pressure",
        "pressureId": "conflict",
        "delta": 15
      },
      {
        "type": "modify_pressure",
        "pressureId": "stability",
        "delta": -10
      }
    ],
    "variables": {
      "$currentEra": {
        "select": {
          "from": "graph",
          "strategy": "by_kind",
          "kind": "era",
          "filters": [
            {
              "type": "status_equals",
              "status": "current"
            }
          ],
          "pickStrategy": "first"
        }
      },
      "$enemy": {
        "select": {
          "from": "relationships",
          "entity": "$target",
          "relationshipKind": "at_war_with",
          "direction": "both",
          "pickStrategy": "random"
        }
      }
    },
    "metadata": {
      "description": "Creates war occurrence when factions are tagged as war_brewing by the threshold system",
      "tags": [
        "threshold-triggered",
        "occurrence",
        "war"
      ]
    }
  },
  {
    "id": "succession_crisis",
    "name": "Succession Crisis",
    "applicability": [
      {
        "type": "tag_exists",
        "kind": "faction",
        "tag": "power_vacuum",
        "minCount": 1
      }
    ],
    "selection": {
      "strategy": "by_kind",
      "kind": "faction",
      "filters": [
        {
          "type": "has_tag",
          "tag": "power_vacuum"
        }
      ],
      "pickStrategy": "random"
    },
    "creation": [
      {
        "entityRef": "$crisis",
        "kind": "occurrence",
        "subtype": "succession_crisis",
        "status": "active",
        "prominence": "recognized",
        "culture": {
          "inherit": "$target"
        },
        "description": {
          "template": "A bitter succession crisis has erupted in {factionName} following the death of their leader",
          "replacements": {
            "factionName": "$target.name"
          }
        },
        "tags": {
          "political": true,
          "internal_strife": true,
          "leadership": true
        },
        "placement": {
          "type": "near_entity",
          "entity": "$target"
        }
      }
    ],
    "relationships": [
      {
        "kind": "active_during",
        "src": "$crisis",
        "dst": "$currentEra",
        "strength": 1
      },
      {
        "kind": "affects",
        "src": "$crisis",
        "dst": "$target",
        "strength": 0.9
      }
    ],
    "stateUpdates": [
      {
        "type": "remove_tag",
        "entity": "$target",
        "tag": "power_vacuum"
      },
      {
        "type": "set_tag",
        "entity": "$target",
        "tag": "succession_crisis",
        "value": true
      },
      {
        "type": "update_entity_status",
        "entity": "$target",
        "newStatus": "waning"
      },
      {
        "type": "modify_pressure",
        "pressureId": "stability",
        "delta": -20
      },
      {
        "type": "modify_pressure",
        "pressureId": "conflict",
        "delta": 10
      }
    ],
    "variables": {
      "$currentEra": {
        "select": {
          "from": "graph",
          "strategy": "by_kind",
          "kind": "era",
          "filters": [
            {
              "type": "status_equals",
              "status": "current"
            }
          ],
          "pickStrategy": "first"
        }
      }
    },
    "metadata": {
      "description": "Creates succession crisis occurrence when factions are tagged as power_vacuum by the threshold system",
      "tags": [
        "threshold-triggered",
        "occurrence",
        "political"
      ]
    }
  },
  {
    "id": "legend_crystallization",
    "name": "Legend Crystallization",
    "applicability": [
      {
        "type": "tag_exists",
        "kind": "npc",
        "tag": "legend_ripe",
        "minCount": 1
      },
      {
        "type": "entity_count_max",
        "kind": "npc",
        "status": "fictional",
        "max": 10,
        "overshootFactor": 1.2
      }
    ],
    "selection": {
      "strategy": "by_kind",
      "kind": "npc",
      "filters": [
        {
          "type": "has_tag",
          "tag": "legend_ripe"
        },
        {
          "type": "prominence_min",
          "prominence": "renowned"
        }
      ],
      "pickStrategy": "weighted_by_prominence"
    },
    "creation": [
      {
        "entityRef": "$memorial",
        "kind": "rules",
        "subtype": "memorial",
        "status": "enacted",
        "prominence": "recognized",
        "culture": {
          "inherit": "$target"
        },
        "description": {
          "template": "A sacred tradition honoring the memory of {heroName}, whose deeds have passed into legend",
          "replacements": {
            "heroName": "$target.name"
          }
        },
        "tags": {
          "memorial": true,
          "tradition": true,
          "cultural": true
        },
        "placement": {
          "type": "near_entity",
          "entity": "$location"
        }
      }
    ],
    "relationships": [
      {
        "kind": "commemorates",
        "src": "$memorial",
        "dst": "$target",
        "strength": 1
      },
      {
        "kind": "originated_in",
        "src": "$memorial",
        "dst": "$location",
        "strength": 0.8,
        "condition": {
          "type": "entity_exists",
          "entity": "$location"
        }
      },
      {
        "kind": "commemorates",
        "src": "$location",
        "dst": "$target",
        "strength": 0.7,
        "condition": {
          "type": "entity_exists",
          "entity": "$location"
        }
      }
    ],
    "stateUpdates": [
      {
        "type": "remove_tag",
        "entity": "$target",
        "tag": "legend_ripe"
      },
      {
        "type": "set_tag",
        "entity": "$target",
        "tag": "legendary",
        "value": true
      },
      {
        "type": "update_entity_status",
        "entity": "$target",
        "newStatus": "fictional"
      }
    ],
    "variables": {
      "$location": {
        "select": {
          "from": "relationships",
          "entity": "$target",
          "relationshipKind": "resident_of",
          "direction": "src",
          "pickStrategy": "first"
        }
      }
    },
    "metadata": {
      "description": "Transforms dead heroes into legends when tagged as legend_ripe by the threshold system. Creates memorial traditions and updates NPC status to fictional.",
      "tags": [
        "threshold-triggered",
        "cultural",
        "legend"
      ]
    }
  },
  {
    "id": "crisis_legislation",
    "name": "Crisis Law",
    "applicability": [
      {
        "type": "or",
        "rules": [
          {
            "type": "pressure_threshold",
            "pressureId": "conflict",
            "min": 10,
            "max": 100,
            "extremeChance": 0.5
          },
          {
            "type": "pressure_threshold",
            "pressureId": "resource_scarcity",
            "min": 10,
            "max": 100,
            "extremeChance": 0.5
          }
        ]
      },
      {
        "type": "entity_count_min",
        "kind": "location",
        "subtype": "colony",
        "min": 1
      }
    ],
    "selection": {
      "strategy": "by_kind",
      "kind": "location",
      "subtypes": [
        "colony"
      ],
      "pickStrategy": "random"
    },
    "creation": [
      {
        "entityRef": "$rule",
        "kind": "rules",
        "subtype": {
          "random": [
            "edict",
            "taboo",
            "social"
          ]
        },
        "status": "enacted",
        "prominence": "recognized",
        "culture": {
          "inherit": "$target"
        },
        "description": {
          "template": "Emergency measure enacted in {colonyName}",
          "replacements": {
            "colonyName": "$target.name"
          }
        },
        "tags": {
          "crisis": true,
          "emergency": true
        },
        "placement": {
          "type": "near_entity",
          "entity": "$target"
        }
      }
    ],
    "relationships": [
      {
        "kind": "applies_in",
        "src": "$rule",
        "dst": "$target",
        "strength": 0.8
      },
      {
        "kind": "supersedes",
        "src": "$rule",
        "dst": "$existingRule",
        "strength": 0.7,
        "distance": {
          "min": 0.1,
          "max": 0.2
        },
        "condition": {
          "type": "random_chance",
          "chance": 0.4
        }
      },
      {
        "kind": "related_to",
        "src": "$rule",
        "dst": "$existingRule",
        "strength": 0.5,
        "distance": {
          "min": 0.3,
          "max": 0.5
        },
        "condition": {
          "type": "entity_exists",
          "entity": "$existingRule"
        }
      }
    ],
    "stateUpdates": [
      {
        "type": "modify_pressure",
        "pressureId": "cultural_tension",
        "delta": 2
      }
    ],
    "variables": {
      "$existingRule": {
        "select": {
          "from": {
            "relatedTo": "$target",
            "relationship": "applies_in",
            "direction": "dst"
          },
          "filters": [
            {
              "type": "lacks_relationship",
              "kind": "repealed"
            }
          ],
          "pickStrategy": "random"
        }
      }
    },
    "metadata": {
      "produces": {
        "entityKinds": [
          {
            "kind": "rules",
            "subtype": "various",
            "count": {
              "min": 1,
              "max": 1
            },
            "prominence": [
              {
                "level": "recognized",
                "probability": 1
              }
            ]
          }
        ],
        "relationships": [
          {
            "kind": "applies_in",
            "category": "immutable_fact",
            "probability": 1,
            "comment": "Law applies in colony"
          },
          {
            "kind": "supersedes",
            "category": "immutable_fact",
            "probability": 0.4,
            "comment": "Supersedes existing law"
          },
          {
            "kind": "related_to",
            "category": "immutable_fact",
            "probability": 0.6,
            "comment": "Related to existing rule"
          }
        ]
      },
      "effects": {
        "graphDensity": 0.2,
        "clusterFormation": 0.3,
        "diversityImpact": 0.5,
        "comment": "Creates emergency laws in response to crises"
      },
      "tags": [
        "crisis-driven",
        "legislation"
      ]
    }
  },
  {
    "id": "great_festival",
    "name": "Great Festival",
    "applicability": [
      {
        "type": "entity_count_min",
        "kind": "faction",
        "min": 2
      },
      {
        "type": "entity_count_min",
        "kind": "location",
        "subtype": "colony",
        "min": 1
      }
    ],
    "selection": {
      "strategy": "by_kind",
      "kind": "location",
      "subtypes": [
        "colony"
      ],
      "pickStrategy": "random"
    },
    "creation": [
      {
        "entityRef": "$festival",
        "kind": "rules",
        "subtype": "social",
        "status": "enacted",
        "prominence": "recognized",
        "culture": {
          "inherit": "$target"
        },
        "description": {
          "template": "A great festival celebrating prosperity and unity, held in {colonyName}",
          "replacements": {
            "colonyName": "$target.name"
          }
        },
        "tags": {
          "festival": true,
          "cultural": true
        },
        "placement": {
          "type": "near_entity",
          "entity": "$target"
        }
      }
    ],
    "relationships": [
      {
        "kind": "originated_in",
        "src": "$festival",
        "dst": "$target",
        "strength": 0.9
      },
      {
        "kind": "celebrated_by",
        "src": "$festival",
        "dst": "$faction1",
        "strength": 0.7,
        "condition": {
          "type": "entity_exists",
          "entity": "$faction1"
        }
      },
      {
        "kind": "celebrated_by",
        "src": "$festival",
        "dst": "$faction2",
        "strength": 0.7,
        "condition": {
          "type": "entity_exists",
          "entity": "$faction2"
        }
      },
      {
        "kind": "celebrated_by",
        "src": "$festival",
        "dst": "$faction3",
        "strength": 0.7,
        "condition": {
          "type": "entity_exists",
          "entity": "$faction3"
        }
      },
      {
        "kind": "celebrated_by",
        "src": "$festival",
        "dst": "$faction4",
        "strength": 0.7,
        "condition": {
          "type": "entity_exists",
          "entity": "$faction4"
        }
      },
      {
        "kind": "allied_with",
        "src": "$faction1",
        "dst": "$faction2",
        "strength": 0.5,
        "condition": {
          "type": "entity_exists",
          "entity": "$faction2"
        }
      },
      {
        "kind": "allied_with",
        "src": "$faction1",
        "dst": "$faction3",
        "strength": 0.5,
        "condition": {
          "type": "entity_exists",
          "entity": "$faction3"
        }
      },
      {
        "kind": "allied_with",
        "src": "$faction2",
        "dst": "$faction3",
        "strength": 0.5,
        "condition": {
          "type": "entity_exists",
          "entity": "$faction3"
        }
      }
    ],
    "stateUpdates": [
      {
        "type": "modify_pressure",
        "pressureId": "conflict",
        "delta": -10
      }
    ],
    "variables": {
      "$allFactions": {
        "select": {
          "from": "graph",
          "strategy": "by_kind",
          "kind": "faction",
          "pickStrategy": "all"
        }
      },
      "$faction1": {
        "select": {
          "from": "graph",
          "strategy": "by_kind",
          "kind": "faction",
          "pickStrategy": "random"
        }
      },
      "$faction2": {
        "select": {
          "from": "graph",
          "strategy": "by_kind",
          "kind": "faction",
          "filters": [
            {
              "type": "exclude",
              "entities": [
                "$faction1"
              ]
            }
          ],
          "pickStrategy": "random"
        }
      },
      "$faction3": {
        "select": {
          "from": "graph",
          "strategy": "by_kind",
          "kind": "faction",
          "filters": [
            {
              "type": "exclude",
              "entities": [
                "$faction1",
                "$faction2"
              ]
            }
          ],
          "pickStrategy": "random"
        }
      },
      "$faction4": {
        "select": {
          "from": "graph",
          "strategy": "by_kind",
          "kind": "faction",
          "filters": [
            {
              "type": "exclude",
              "entities": [
                "$faction1",
                "$faction2",
                "$faction3"
              ]
            }
          ],
          "pickStrategy": "random"
        }
      }
    },
    "metadata": {
      "produces": {
        "entityKinds": [
          {
            "kind": "rules",
            "subtype": "social",
            "count": {
              "min": 1,
              "max": 1
            },
            "prominence": [
              {
                "level": "recognized",
                "probability": 0.7
              },
              {
                "level": "renowned",
                "probability": 0.3
              }
            ]
          }
        ],
        "relationships": [
          {
            "kind": "originated_in",
            "category": "spatial",
            "probability": 1,
            "comment": "Festival originated in colony"
          },
          {
            "kind": "celebrated_by",
            "category": "cultural",
            "probability": 3,
            "comment": "2-4 factions celebrate"
          },
          {
            "kind": "allied_with",
            "category": "political",
            "probability": 6,
            "comment": "Temporary festival alliances"
          }
        ]
      },
      "effects": {
        "graphDensity": 0.8,
        "clusterFormation": 0.7,
        "diversityImpact": 0.6,
        "comment": "Creates festivals that unite factions and reduce conflict"
      },
      "parameters": {
        "stableActivationChance": {
          "value": 0.05,
          "min": 0.01,
          "max": 0.2,
          "description": "Probability when conflict is low (peaceful festivals)"
        }
      },
      "tags": [
        "festival",
        "unity",
        "cultural"
      ]
    }
  },
  {
    "id": "tech_breakthrough",
    "name": "Technological Breakthrough",
    "applicability": [
      {
        "type": "entity_count_min",
        "kind": "faction",
        "min": 1
      }
    ],
    "selection": {
      "strategy": "by_kind",
      "kind": "faction",
      "filters": [
        {
          "type": "has_relationship",
          "kind": "controls",
          "direction": "src"
        }
      ],
      "pickStrategy": "random"
    },
    "creation": [
      {
        "entityRef": "$tech",
        "kind": "abilities",
        "subtype": "technology",
        "status": "active",
        "prominence": "recognized",
        "culture": {
          "inherit": "$target"
        },
        "description": {
          "template": "A technological breakthrough developed by {factionName} at {locationName}",
          "replacements": {
            "factionName": "$target.name",
            "locationName": "$location.name"
          }
        },
        "tags": {
          "technology": true,
          "innovation": true
        },
        "placement": {
          "type": "near_entity",
          "entity": "$target"
        }
      }
    ],
    "relationships": [
      {
        "kind": "practitioner_of",
        "src": "$target",
        "dst": "$tech",
        "strength": 0.9,
        "catalyzedBy": "$leader"
      },
      {
        "kind": "originated_in",
        "src": "$tech",
        "dst": "$location",
        "strength": 0.7
      },
      {
        "kind": "practitioner_of",
        "src": "$leader",
        "dst": "$tech",
        "strength": 1,
        "condition": {
          "type": "entity_exists",
          "entity": "$leader"
        }
      },
      {
        "kind": "derived_from",
        "src": "$tech",
        "dst": "$existingTech",
        "strength": 0.6,
        "distance": {
          "min": 0.1,
          "max": 0.3
        },
        "condition": {
          "type": "entity_exists",
          "entity": "$existingTech"
        }
      }
    ],
    "stateUpdates": [],
    "variables": {
      "$location": {
        "select": {
          "from": {
            "relatedTo": "$target",
            "relationship": "controls",
            "direction": "src"
          },
          "pickStrategy": "random"
        }
      },
      "$leader": {
        "select": {
          "from": {
            "relatedTo": "$target",
            "relationship": "leader_of",
            "direction": "dst"
          },
          "pickStrategy": "first"
        }
      },
      "$existingTech": {
        "select": {
          "from": {
            "relatedTo": "$target",
            "relationship": "practitioner_of",
            "direction": "src"
          },
          "filters": [
            {
              "type": "graph_path",
              "assert": {
                "check": "exists",
                "path": [],
                "where": [
                  {
                    "type": "kind_equals",
                    "kind": "abilities"
                  },
                  {
                    "type": "subtype_equals",
                    "subtype": "technology"
                  }
                ]
              }
            }
          ],
          "pickStrategy": "random"
        }
      }
    },
    "metadata": {
      "produces": {
        "entityKinds": [
          {
            "kind": "abilities",
            "subtype": "technology",
            "count": {
              "min": 1,
              "max": 1
            },
            "prominence": [
              {
                "level": "recognized",
                "probability": 1
              }
            ]
          }
        ],
        "relationships": [
          {
            "kind": "practitioner_of",
            "category": "institutional",
            "probability": 1,
            "comment": "Faction adopts new tech"
          },
          {
            "kind": "originated_in",
            "category": "immutable_fact",
            "probability": 1,
            "comment": "Tech originated at location"
          },
          {
            "kind": "derived_from",
            "category": "immutable_fact",
            "probability": 0.8,
            "comment": "Tech lineage from existing tech"
          }
        ]
      },
      "effects": {
        "graphDensity": 0.4,
        "clusterFormation": 0.5,
        "diversityImpact": 0.8,
        "comment": "Expands technological capabilities"
      },
      "parameters": {
        "innovationRate": {
          "value": 0.5,
          "min": 0.2,
          "max": 0.9,
          "description": "How frequently technological breakthroughs occur"
        }
      },
      "tags": [
        "world-level",
        "technological",
        "innovation"
      ]
    }
  },
  {
    "id": "magical_site_discovery",
    "name": "Magical Site Discovery",
    "applicability": [
      {
        "type": "entity_count_min",
        "kind": "abilities",
        "subtype": "magic",
        "min": 1
      }
    ],
    "selection": {
      "strategy": "by_relationship",
      "kind": "abilities",
      "subtypes": [
        "magic"
      ],
      "relationshipKind": "practitioner_of",
      "mustHave": true,
      "direction": "dst",
      "pickStrategy": "random"
    },
    "creation": [
      {
        "entityRef": "$site",
        "kind": "location",
        "subtype": "anomaly",
        "status": "thriving",
        "prominence": "recognized",
        "culture": {
          "inherit": "$practitioner"
        },
        "description": {
          "template": "A mystical site where {magicName} manifests with unusual intensity",
          "replacements": {
            "magicName": "$target.name"
          }
        },
        "tags": {
          "anomaly": true,
          "magical": true
        },
        "placement": {
          "type": "near_entity",
          "entity": "$practitioner"
        }
      }
    ],
    "relationships": [
      {
        "kind": "manifests_at",
        "src": "$target",
        "dst": "$site",
        "strength": 0.8,
        "catalyzedBy": "$practitioner"
      },
      {
        "kind": "discovered_by",
        "src": "$site",
        "dst": "$practitioner",
        "strength": 1
      }
    ],
    "stateUpdates": [],
    "variables": {
      "$practitioner": {
        "select": {
          "from": {
            "relatedTo": "$target",
            "relationship": "practitioner_of",
            "direction": "dst"
          },
          "pickStrategy": "random"
        }
      }
    },
    "metadata": {
      "produces": {
        "entityKinds": [
          {
            "kind": "location",
            "subtype": "anomaly",
            "count": {
              "min": 1,
              "max": 1
            },
            "prominence": [
              {
                "level": "recognized",
                "probability": 1
              }
            ]
          }
        ],
        "relationships": [
          {
            "kind": "manifests_at",
            "category": "magical",
            "probability": 1,
            "comment": "Magic manifests at discovered location"
          },
          {
            "kind": "discovered_by",
            "category": "attribution",
            "probability": 1,
            "comment": "Practitioner discovers site"
          }
        ]
      },
      "effects": {
        "graphDensity": 0.4,
        "clusterFormation": 0.5,
        "diversityImpact": 0.7,
        "comment": "Expands magical landscape with new anomaly locations"
      },
      "parameters": {
        "discoveryRate": {
          "value": 0.4,
          "min": 0.1,
          "max": 0.8,
          "description": "How frequently practitioners discover new magical sites"
        }
      },
      "tags": [
        "world-level",
        "magical",
        "discovery"
      ]
    }
  },
  {
    "id": "orca_combat_technique",
    "name": "Orca Combat Technique",
    "applicability": [
      {
        "type": "entity_count_min",
        "kind": "npc",
        "subtype": "orca",
        "min": 1
      }
    ],
    "selection": {
      "strategy": "by_kind",
      "kind": "npc",
      "subtypes": [
        "orca"
      ],
      "filters": [
        {
          "type": "graph_path",
          "assert": {
            "check": "count_max",
            "count": 1,
            "path": [
              {
                "via": "practitioner_of",
                "direction": "out",
                "targetKind": "abilities"
              }
            ]
          }
        }
      ],
      "pickStrategy": "random"
    },
    "creation": [
      {
        "entityRef": "$technique",
        "kind": "abilities",
        "subtype": "combat",
        "status": "active",
        "prominence": {
          "random": [
            "recognized",
            "renowned"
          ]
        },
        "culture": "orca",
        "description": {
          "template": "A devastating combat technique used by orca raiders, witnessed when {orcaName} attacked",
          "replacements": {
            "orcaName": "$target.name"
          }
        },
        "tags": {
          "combat": true,
          "orca": true,
          "offensive": true,
          "external": true
        },
        "placement": {
          "type": "near_entity",
          "entity": "$target"
        }
      }
    ],
    "relationships": [
      {
        "kind": "practitioner_of",
        "src": "$target",
        "dst": "$technique",
        "strength": 0.9
      },
      {
        "kind": "practitioner_of",
        "src": "$otherOrca",
        "dst": "$technique",
        "strength": 0.8,
        "condition": {
          "type": "random_chance",
          "chance": 0.6
        }
      },
      {
        "kind": "related_to",
        "src": "$technique",
        "dst": "$existingCombat",
        "strength": 0.5,
        "distance": {
          "min": 0.2,
          "max": 0.4
        },
        "condition": {
          "type": "entity_exists",
          "entity": "$existingCombat"
        }
      }
    ],
    "stateUpdates": [],
    "variables": {
      "$otherOrca": {
        "select": {
          "from": "graph",
          "strategy": "by_kind",
          "kind": "npc",
          "subtypes": [
            "orca"
          ],
          "filters": [
            {
              "type": "exclude",
              "entities": [
                "$target"
              ]
            }
          ],
          "pickStrategy": "random"
        }
      },
      "$existingCombat": {
        "select": {
          "from": "graph",
          "strategy": "by_kind",
          "kind": "abilities",
          "subtypes": [
            "combat"
          ],
          "statusFilter": "active",
          "pickStrategy": "random"
        }
      }
    },
    "metadata": {
      "produces": {
        "entityKinds": [
          {
            "kind": "abilities",
            "subtype": "combat",
            "count": {
              "min": 1,
              "max": 1
            },
            "prominence": [
              {
                "level": "recognized",
                "probability": 0.6
              },
              {
                "level": "renowned",
                "probability": 0.4
              }
            ]
          }
        ],
        "relationships": [
          {
            "kind": "practitioner_of",
            "category": "institutional",
            "probability": 1,
            "comment": "Orcas practice technique"
          },
          {
            "kind": "related_to",
            "category": "immutable_fact",
            "probability": 0.5,
            "comment": "Related to existing combat technique"
          }
        ]
      },
      "effects": {
        "graphDensity": 0.2,
        "clusterFormation": 0.3,
        "diversityImpact": 0.7,
        "comment": "Creates fearsome orca combat techniques"
      },
      "tags": [
        "combat",
        "external-threat",
        "ability-creation"
      ]
    }
  },
  {
    "id": "tech_innovation",
    "name": "Technology Development",
    "applicability": [
      {
        "type": "entity_count_min",
        "kind": "faction",
        "subtype": "company",
        "min": 1
      }
    ],
    "selection": {
      "strategy": "by_kind",
      "kind": "faction",
      "subtypes": [
        "company"
      ],
      "filters": [
        {
          "type": "graph_path",
          "assert": {
            "check": "count_max",
            "count": 3,
            "path": [
              {
                "via": "wields",
                "direction": "out",
                "targetKind": "abilities"
              }
            ]
          }
        }
      ],
      "pickStrategy": "random"
    },
    "creation": [
      {
        "entityRef": "$technology",
        "kind": "abilities",
        "subtype": "technology",
        "status": "discovered",
        "prominence": "marginal",
        "culture": {
          "inherit": "$target"
        },
        "description": {
          "template": "Innovation developed by {factionName}",
          "replacements": {
            "factionName": "$target.name"
          }
        },
        "tags": {
          "technology": true,
          "innovation": true
        },
        "placement": {
          "type": "near_entity",
          "entity": "$target"
        },
        "lineage": {
          "relationshipKind": "derived_from",
          "ancestorFilter": [
            { "kind": "abilities", "subtype": "technology", "status": "discovered" },
            { "kind": "abilities", "status": "discovered" }
          ],
          "distanceRange": { "min": 10, "max": 30 }
        }
      }
    ],
    "relationships": [
      {
        "kind": "wields",
        "src": "$target",
        "dst": "$technology",
        "strength": 0.8
      },
      {
        "kind": "practitioner_of",
        "src": "$member1",
        "dst": "$technology",
        "strength": 0.7,
        "condition": {
          "type": "entity_exists",
          "entity": "$member1"
        }
      },
      {
        "kind": "practitioner_of",
        "src": "$member2",
        "dst": "$technology",
        "strength": 0.7,
        "condition": {
          "type": "entity_exists",
          "entity": "$member2"
        }
      },
      {
        "kind": "practitioner_of",
        "src": "$member3",
        "dst": "$technology",
        "strength": 0.7,
        "condition": {
          "type": "entity_exists",
          "entity": "$member3"
        }
      }
    ],
    "stateUpdates": [],
    "variables": {
      "$member1": {
        "select": {
          "from": {
            "relatedTo": "$target",
            "relationship": "member_of",
            "direction": "dst"
          },
          "pickStrategy": "random"
        }
      },
      "$member2": {
        "select": {
          "from": {
            "relatedTo": "$target",
            "relationship": "member_of",
            "direction": "dst"
          },
          "filters": [
            {
              "type": "exclude",
              "entities": [
                "$member1"
              ]
            }
          ],
          "pickStrategy": "random"
        }
      },
      "$member3": {
        "select": {
          "from": {
            "relatedTo": "$target",
            "relationship": "member_of",
            "direction": "dst"
          },
          "filters": [
            {
              "type": "exclude",
              "entities": [
                "$member1",
                "$member2"
              ]
            }
          ],
          "pickStrategy": "random"
        }
      }
    },
    "metadata": {
      "produces": {
        "entityKinds": [
          {
            "kind": "abilities",
            "subtype": "technology",
            "count": {
              "min": 1,
              "max": 1
            },
            "prominence": [
              {
                "level": "marginal",
                "probability": 1
              }
            ]
          }
        ],
        "relationships": [
          {
            "kind": "wields",
            "category": "cultural",
            "probability": 1,
            "comment": "Faction wields technology"
          },
          {
            "kind": "practitioner_of",
            "category": "cultural",
            "probability": 2,
            "comment": "1-3 faction members practice"
          }
        ]
      },
      "effects": {
        "graphDensity": 0.4,
        "clusterFormation": 0.5,
        "diversityImpact": 0.7,
        "comment": "Creates technology abilities developed by merchant factions"
      },
      "parameters": {
        "maxPractitioners": {
          "value": 3,
          "min": 1,
          "max": 10,
          "description": "Maximum number of faction members who practice new technology"
        },
        "maxTechPerFaction": {
          "value": 4,
          "min": 1,
          "max": 10,
          "description": "Maximum technologies per faction"
        }
      },
      "tags": [
        "technology",
        "ability-creation"
      ]
    }
  },
  {
    "id": "magic_discovery",
    "name": "Magical Discovery",
    "applicability": [
      {
        "type": "pressure_threshold",
        "pressureId": "magical_instability",
        "min": 10,
        "max": 70,
        "extremeChance": 0.4
      },
      {
        "type": "entity_count_max",
        "kind": "abilities",
        "subtype": "magic",
        "max": 15
      },
      {
        "type": "entity_count_min",
        "kind": "npc",
        "subtype": "hero",
        "min": 1
      }
    ],
    "selection": {
      "strategy": "by_kind",
      "kind": "npc",
      "subtypes": [
        "hero"
      ],
      "filters": [
        {
          "type": "graph_path",
          "assert": {
            "check": "count_max",
            "count": 1,
            "path": [
              {
                "via": "discoverer_of",
                "direction": "out",
                "targetKind": "abilities"
              }
            ]
          }
        }
      ],
      "pickStrategy": "random"
    },
    "creation": [
      {
        "entityRef": "$magic",
        "kind": "abilities",
        "subtype": "magic",
        "status": "emergent",
        "prominence": "recognized",
        "culture": {
          "inherit": "$target"
        },
        "description": {
          "template": "Mystical ability discovered by {heroName}",
          "replacements": {
            "heroName": "$target.name"
          }
        },
        "tags": {
          "magic": true,
          "mystical": true
        },
        "placement": {
          "type": "near_entity",
          "entity": "$target"
        },
        "lineage": {
          "relationshipKind": "derived_from",
          "ancestorFilter": [
            { "kind": "abilities", "subtype": "magic", "status": "discovered" },
            { "kind": "abilities", "status": "discovered" }
          ],
          "distanceRange": { "min": 20, "max": 50 }
        }
      }
    ],
    "relationships": [
      {
        "kind": "discoverer_of",
        "src": "$target",
        "dst": "$magic",
        "strength": 1
      },
      {
        "kind": "manifests_at",
        "src": "$magic",
        "dst": "$anomaly",
        "strength": 0.8,
        "condition": {
          "type": "entity_exists",
          "entity": "$anomaly"
        }
      },
      {
        "kind": "related_to",
        "src": "$magic",
        "dst": "$existingMagic",
        "strength": 0.5,
        "distance": {
          "min": 50,
          "max": 90
        },
        "condition": {
          "type": "entity_exists",
          "entity": "$existingMagic"
        }
      }
    ],
    "stateUpdates": [],
    "variables": {
      "$anomaly": {
        "select": {
          "from": "graph",
          "strategy": "by_kind",
          "kind": "location",
          "subtypes": [
            "anomaly"
          ],
          "pickStrategy": "random"
        }
      },
      "$existingMagic": {
        "select": {
          "from": "graph",
          "strategy": "by_kind",
          "kind": "abilities",
          "subtypes": [
            "magic"
          ],
          "filters": [
            {
              "type": "lacks_relationship",
              "kind": "lost"
            }
          ],
          "pickStrategy": "random"
        }
      }
    },
    "metadata": {
      "produces": {
        "entityKinds": [
          {
            "kind": "abilities",
            "subtype": "magic",
            "count": {
              "min": 1,
              "max": 1
            },
            "prominence": [
              {
                "level": "recognized",
                "probability": 1
              }
            ]
          }
        ],
        "relationships": [
          {
            "kind": "discoverer_of",
            "category": "immutable_fact",
            "probability": 1,
            "comment": "Hero discovers magic"
          },
          {
            "kind": "manifests_at",
            "category": "immutable_fact",
            "probability": 1,
            "comment": "Magic manifests at anomaly"
          },
          {
            "kind": "related_to",
            "category": "immutable_fact",
            "probability": 0.7,
            "comment": "Related to existing magic"
          }
        ]
      },
      "effects": {
        "graphDensity": 0.3,
        "clusterFormation": 0.4,
        "diversityImpact": 0.9,
        "comment": "Creates mystical abilities linked to anomalies and heroes"
      },
      "parameters": {
        "maxDiscoveriesPerHero": {
          "value": 2,
          "min": 1,
          "max": 5,
          "description": "Maximum abilities a single hero can discover"
        }
      },
      "tags": [
        "mystical",
        "ability-creation"
      ]
    }
  },
  {
    "id": "ideology_emergence",
    "name": "Ideological Movement",
    "applicability": [
      {
        "type": "or",
        "rules": [
          {
            "type": "pressure_threshold",
            "pressureId": "cultural_tension",
            "min": 30,
            "max": 100,
            "extremeChance": 0.5
          },
          {
            "type": "pressure_threshold",
            "pressureId": "stability",
            "min": 0,
            "max": 40,
            "extremeChance": 0.3
          }
        ]
      },
      {
        "type": "entity_count_min",
        "kind": "npc",
        "min": 10
      }
    ],
    "selection": {
      "strategy": "by_preference_order",
      "kind": "npc",
      "subtypePreferences": [
        "hero"
      ],
      "statusFilter": "alive",
      "pickStrategy": "random"
    },
    "creation": [
      {
        "entityRef": "$ideology",
        "kind": "rules",
        "subtype": {
          "random": [
            "edict",
            "taboo",
            "social"
          ]
        },
        "status": "proposed",
        "prominence": "marginal",
        "culture": {
          "inherit": "$target"
        },
        "description": {
          "template": "An ideology championed by {championName}. This belief is spreading through whispered conversations and passionate debates.",
          "replacements": {
            "championName": "$target.name"
          }
        },
        "tags": {
          "ideology": true,
          "cultural": true
        },
        "placement": {
          "type": "near_entity",
          "entity": "$target"
        }
      }
    ],
    "relationships": [
      {
        "kind": "champion_of",
        "src": "$target",
        "dst": "$ideology",
        "strength": 1
      },
      {
        "kind": "originated_in",
        "src": "$ideology",
        "dst": "$championLocation",
        "strength": 0.8,
        "condition": {
          "type": "entity_exists",
          "entity": "$championLocation"
        }
      },
      {
        "kind": "believer_of",
        "src": "$factionMember1",
        "dst": "$ideology",
        "strength": 0.6,
        "condition": {
          "type": "entity_exists",
          "entity": "$factionMember1"
        }
      },
      {
        "kind": "believer_of",
        "src": "$factionMember2",
        "dst": "$ideology",
        "strength": 0.6,
        "condition": {
          "type": "entity_exists",
          "entity": "$factionMember2"
        }
      },
      {
        "kind": "believer_of",
        "src": "$factionMember3",
        "dst": "$ideology",
        "strength": 0.6,
        "condition": {
          "type": "entity_exists",
          "entity": "$factionMember3"
        }
      },
      {
        "kind": "related_to",
        "src": "$ideology",
        "dst": "$existingIdeology",
        "strength": 0.5,
        "distance": {
          "min": 0.4,
          "max": 0.7
        },
        "condition": {
          "type": "entity_exists",
          "entity": "$existingIdeology"
        }
      }
    ],
    "stateUpdates": [
      {
        "type": "modify_pressure",
        "pressureId": "cultural_tension",
        "delta": 3
      }
    ],
    "variables": {
      "$championLocation": {
        "select": {
          "from": {
            "relatedTo": "$target",
            "relationship": "resident_of",
            "direction": "src"
          },
          "pickStrategy": "first"
        }
      },
      "$championFaction": {
        "select": {
          "from": {
            "relatedTo": "$target",
            "relationship": "member_of",
            "direction": "src"
          },
          "pickStrategy": "first"
        }
      },
      "$factionMember1": {
        "select": {
          "from": {
            "relatedTo": "$championFaction",
            "relationship": "member_of",
            "direction": "dst"
          },
          "filters": [
            {
              "type": "exclude",
              "entities": [
                "$target"
              ]
            }
          ],
          "pickStrategy": "random"
        }
      },
      "$factionMember2": {
        "select": {
          "from": {
            "relatedTo": "$championFaction",
            "relationship": "member_of",
            "direction": "dst"
          },
          "filters": [
            {
              "type": "exclude",
              "entities": [
                "$target",
                "$factionMember1"
              ]
            }
          ],
          "pickStrategy": "random"
        }
      },
      "$factionMember3": {
        "select": {
          "from": {
            "relatedTo": "$championFaction",
            "relationship": "member_of",
            "direction": "dst"
          },
          "filters": [
            {
              "type": "exclude",
              "entities": [
                "$target",
                "$factionMember1",
                "$factionMember2"
              ]
            }
          ],
          "pickStrategy": "random"
        }
      },
      "$existingIdeology": {
        "select": {
          "from": "graph",
          "strategy": "by_kind",
          "kind": "rules",
          "filters": [
            {
              "type": "lacks_relationship",
              "kind": "repealed"
            },
            {
              "type": "graph_path",
              "assert": {
                "check": "exists",
                "path": [],
                "where": [
                  {
                    "type": "subtype_equals",
                    "subtype": "social"
                  }
                ]
              }
            }
          ],
          "pickStrategy": "random"
        }
      }
    },
    "metadata": {
      "produces": {
        "entityKinds": [
          {
            "kind": "rules",
            "subtype": "various",
            "count": {
              "min": 1,
              "max": 1
            },
            "prominence": [
              {
                "level": "marginal",
                "probability": 1
              }
            ]
          }
        ],
        "relationships": [
          {
            "kind": "champion_of",
            "category": "social",
            "probability": 1,
            "comment": "Champion promotes ideology"
          },
          {
            "kind": "originated_in",
            "category": "immutable_fact",
            "probability": 0.8,
            "comment": "Ideology originated in location"
          },
          {
            "kind": "believer_of",
            "category": "social",
            "probability": 7,
            "comment": "3-8 initial believers"
          },
          {
            "kind": "related_to",
            "category": "immutable_fact",
            "probability": 0.5,
            "comment": "Related to existing ideology"
          }
        ]
      },
      "effects": {
        "graphDensity": 0.6,
        "clusterFormation": 0.7,
        "diversityImpact": 0.8,
        "comment": "Creates ideological movements that spread through social networks"
      },
      "parameters": {
        "unstableActivationChance": {
          "value": 0.3,
          "min": 0.1,
          "max": 0.7,
          "description": "Probability when stability is low"
        }
      },
      "tags": [
        "ideology",
        "cultural-shift",
        "belief-driven"
      ]
    }
  },
  {
    "id": "strategic_location_discovery",
    "name": "Strategic Site Discovery",
    "applicability": [
      {
        "type": "pressure_threshold",
        "pressureId": "conflict",
        "min": 15,
        "max": 90,
        "extremeChance": 0.3
      }
    ],
    "selection": {
      "strategy": "by_preference_order",
      "kind": "npc",
      "subtypePreferences": [
        "hero",
        "outlaw",
        "mayor"
      ],
      "statusFilter": "alive",
      "pickStrategy": "random"
    },
    "creation": [
      {
        "entityRef": "$site",
        "kind": "location",
        "subtype": "geographic_feature",
        "status": "unspoiled",
        "prominence": "recognized",
        "culture": {
          "inherit": "$target"
        },
        "description": {
          "template": "A strategic position discovered by {discovererName} providing tactical advantage",
          "replacements": {
            "discovererName": "$target.name"
          }
        },
        "tags": {
          "strategic": true,
          "tactical": true,
          "discovered": true
        },
        "placement": {
          "type": "near_entity",
          "entity": "$target"
        }
      }
    ],
    "relationships": [
      {
        "kind": "explorer_of",
        "src": "$target",
        "dst": "$site",
        "strength": 0.9
      },
      {
        "kind": "discovered_by",
        "src": "$site",
        "dst": "$target",
        "strength": 0.9
      },
      {
        "kind": "adjacent_to",
        "src": "$site",
        "dst": "$nearbyLocation",
        "bidirectional": true,
        "strength": 0.6,
        "condition": {
          "type": "entity_exists",
          "entity": "$nearbyLocation"
        }
      }
    ],
    "stateUpdates": [],
    "variables": {
      "$nearbyLocation": {
        "select": {
          "from": "graph",
          "strategy": "by_kind",
          "kind": "location",
          "pickStrategy": "random"
        }
      }
    },
    "metadata": {
      "produces": {
        "entityKinds": [
          {
            "kind": "location",
            "subtype": "geographic_feature",
            "count": {
              "min": 1,
              "max": 1
            },
            "prominence": [
              {
                "level": "recognized",
                "probability": 1
              }
            ]
          }
        ],
        "relationships": [
          {
            "kind": "explorer_of",
            "category": "spatial",
            "probability": 1,
            "comment": "Scout finds strategic position"
          },
          {
            "kind": "discovered_by",
            "category": "spatial",
            "probability": 1,
            "comment": "Strategic location discovered"
          },
          {
            "kind": "adjacent_to",
            "category": "spatial",
            "probability": 0.8,
            "comment": "Adjacent to nearby location"
          }
        ]
      },
      "effects": {
        "graphDensity": 0.4,
        "clusterFormation": 0.4,
        "diversityImpact": 0.7,
        "comment": "Creates strategic locations discovered during conflict"
      },
      "tags": [
        "emergent",
        "strategic",
        "conflict-driven"
      ]
    }
  },
  {
    "id": "thermal_colony_decline",
    "name": "Colony Thermal Decline",
    "description": "Colonies in extreme temperature zones begin to wane",
    "template": {
      "applicability": [
        {
          "type": "tag_exists",
          "tagName": "thermal_stress"
        }
      ],
      "selection": [
        {
          "variable": "stressed_colony",
          "kind": "location",
          "subtype": "colony",
          "status": "thriving",
          "filters": [
            {
              "type": "has_tag",
              "tag": "thermal_stress"
            }
          ],
          "count": 1,
          "bias": "random"
        }
      ],
      "creation": [],
      "relationships": [],
      "stateUpdates": [
        {
          "target": "$stressed_colony",
          "status": "waning",
          "addTags": [
            "climate_displaced"
          ],
          "removeTags": [
            "thermal_stress"
          ]
        }
      ]
    },
    "effects": {
      "graphDensity": 0,
      "clusterFormation": 0,
      "diversityImpact": 0.3,
      "comment": "Colonies in extreme temperatures decline"
    },
    "tags": [
      "thermal",
      "colony",
      "status-change"
    ]
  },
  {
    "id": "thermal_colony_recovery",
    "name": "Colony Thermal Recovery",
    "description": "Waning colonies in temperate zones recover",
    "template": {
      "applicability": [
        {
          "type": "tag_exists",
          "tagName": "recovery_ready"
        }
      ],
      "selection": [
        {
          "variable": "recovering_colony",
          "kind": "location",
          "subtype": "colony",
          "status": "waning",
          "filters": [
            {
              "type": "has_tag",
              "tag": "recovery_ready"
            }
          ],
          "count": 1,
          "bias": "random"
        }
      ],
      "creation": [],
      "relationships": [],
      "stateUpdates": [
        {
          "target": "$recovering_colony",
          "status": "thriving",
          "addTags": [
            "climate_adapted"
          ],
          "removeTags": [
            "recovery_ready",
            "climate_displaced"
          ]
        }
      ]
    },
    "effects": {
      "graphDensity": 0,
      "clusterFormation": 0,
      "diversityImpact": 0.2,
      "comment": "Colonies recover in temperate zones"
    },
    "tags": [
      "thermal",
      "colony",
      "recovery"
    ]
  },
  {
    "id": "thermal_migration",
    "name": "Thermal Migration",
    "description": "NPCs flee extreme temperatures for temperate refuges",
    "template": {
      "applicability": [
        {
          "type": "tag_exists",
          "tagName": "extreme_hot"
        }
      ],
      "selection": [
        {
          "variable": "extreme_location",
          "kind": "location",
          "filters": [
            {
              "type": "has_any_tag",
              "tags": [
                "extreme_hot",
                "extreme_cold"
              ]
            }
          ],
          "count": 1,
          "bias": "random"
        },
        {
          "variable": "migrant",
          "kind": "npc",
          "status": "alive",
          "filters": [
            {
              "type": "has_relationship",
              "relationshipKind": "resident_of",
              "target": "$extreme_location",
              "direction": "src"
            }
          ],
          "count": 1,
          "bias": "random"
        },
        {
          "variable": "refuge",
          "kind": "location",
          "filters": [
            {
              "type": "has_tag",
              "tag": "temperate"
            },
            {
              "type": "not_entity",
              "entity": "$extreme_location"
            }
          ],
          "count": 1,
          "bias": "random"
        }
      ],
      "creation": [],
      "relationships": [
        {
          "kind": "resident_of",
          "src": "$migrant",
          "dst": "$refuge",
          "category": "spatial",
          "probability": 0.5,
          "comment": "NPC migrates to temperate refuge"
        }
      ],
      "stateUpdates": [
        {
          "target": "$migrant",
          "addTags": [
            "climate_refugee"
          ]
        }
      ]
    },
    "effects": {
      "graphDensity": 0.2,
      "clusterFormation": 0.3,
      "diversityImpact": 0.4,
      "comment": "Population displacement due to temperature"
    },
    "tags": [
      "thermal",
      "migration",
      "npc"
    ]
  },
  {
    "id": "ice_memory_thaw",
    "name": "Ice Memory Thaw",
    "description": "Warming reveals frozen abilities at thaw candidate locations",
    "template": {
      "applicability": [
        {
          "type": "tag_exists",
          "tagName": "thaw_candidate"
        }
      ],
      "selection": [
        {
          "variable": "thaw_location",
          "kind": "location",
          "filters": [
            {
              "type": "has_tag",
              "tag": "thaw_candidate"
            }
          ],
          "count": 1,
          "bias": "random"
        },
        {
          "variable": "frozen_ability",
          "kind": "abilities",
          "status": "active",
          "filters": [
            {
              "type": "no_relationship",
              "relationshipKind": "manifests_at",
              "target": "$thaw_location",
              "direction": "src"
            }
          ],
          "count": 1,
          "bias": "random"
        }
      ],
      "creation": [],
      "relationships": [
        {
          "kind": "manifests_at",
          "src": "$frozen_ability",
          "dst": "$thaw_location",
          "category": "spatial",
          "probability": 0.1,
          "comment": "Frozen ability revealed by warming"
        }
      ],
      "stateUpdates": [
        {
          "target": "$thaw_location",
          "addTags": [
            "recently_thawed"
          ],
          "removeTags": [
            "thaw_candidate"
          ]
        }
      ]
    },
    "effects": {
      "graphDensity": 0.3,
      "clusterFormation": 0.2,
      "diversityImpact": 0.5,
      "comment": "Ice memory thaw reveals frozen abilities"
    },
    "tags": [
      "thermal",
      "discovery",
      "abilities"
    ]
  },
  {
    "id": "economic_colony_decline",
    "name": "Colony Economic Decline",
    "description": "Colonies with resource scarcity begin to wane",
    "template": {
      "applicability": [
        {
          "type": "tag_exists",
          "tagName": "economic_stress"
        }
      ],
      "selection": [
        {
          "variable": "stressed_colony",
          "kind": "location",
          "subtype": "colony",
          "status": "thriving",
          "filters": [
            {
              "type": "has_tag",
              "tag": "economic_stress"
            }
          ],
          "count": 1,
          "bias": "random"
        }
      ],
      "creation": [],
      "relationships": [],
      "stateUpdates": [
        {
          "target": "$stressed_colony",
          "status": "waning",
          "addTags": [
            "resource_depleted"
          ],
          "removeTags": [
            "economic_stress"
          ]
        }
      ]
    },
    "effects": {
      "graphDensity": 0,
      "clusterFormation": 0,
      "diversityImpact": 0.3,
      "comment": "Resource-scarce colonies decline"
    },
    "tags": [
      "economic",
      "colony",
      "status-change"
    ]
  },
  {
    "id": "economic_colony_recovery",
    "name": "Colony Economic Recovery",
    "description": "Waning colonies with abundant resources recover",
    "template": {
      "applicability": [
        {
          "type": "tag_exists",
          "tagName": "prosperity_ready"
        }
      ],
      "selection": [
        {
          "variable": "recovering_colony",
          "kind": "location",
          "subtype": "colony",
          "status": "waning",
          "filters": [
            {
              "type": "has_tag",
              "tag": "prosperity_ready"
            }
          ],
          "count": 1,
          "bias": "random"
        }
      ],
      "creation": [],
      "relationships": [],
      "stateUpdates": [
        {
          "target": "$recovering_colony",
          "status": "thriving",
          "addTags": [
            "economically_recovered"
          ],
          "removeTags": [
            "prosperity_ready",
            "resource_depleted"
          ]
        }
      ]
    },
    "effects": {
      "graphDensity": 0,
      "clusterFormation": 0,
      "diversityImpact": 0.2,
      "comment": "Colonies recover with abundant resources"
    },
    "tags": [
      "economic",
      "colony",
      "recovery"
    ]
  }
]
