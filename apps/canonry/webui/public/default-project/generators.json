[
  {
    "id": "hero_emergence",
    "name": "Hero Emergence",
    "applicability": [
      {
        "type": "entity_count",
        "kind": "npc",
        "max": 10
      },
      {
        "type": "pressure",
        "pressureId": "security",
        "min": -100,
        "max": -20
      }
    ],
    "selection": {
      "strategy": "by_kind",
      "kind": "location",
      "subtypes": [
        "colony"
      ],
      "pickStrategy": "random"
    },
    "creation": [
      {
        "entityRef": "$hero",
        "kind": "npc",
        "subtype": "hero",
        "status": "alive",
        "prominence": "marginal",
        "culture": {
          "inherit": "$target"
        },
        "description": {
          "template": "A brave penguin who emerged during troubled times in {colonyName}",
          "replacements": {
            "colonyName": "$target.name"
          }
        },
        "tags": {
          "emergent": true
        },
        "placement": {
          "anchor": {
            "type": "entity",
            "ref": "$mentor",
            "stickToRegion": true
          },
          "steps": [
            "anchor_region",
            "seed_region",
            "sparse",
            "random"
          ]
        }
      }
    ],
    "relationships": [
      {
        "kind": "resident_of",
        "src": "$hero",
        "dst": "$target",
        "strength": 0.8
      },
      {
        "kind": "practitioner_of",
        "src": "$hero",
        "dst": "$ability",
        "strength": 0.6,
        "condition": {
          "type": "entity_exists",
          "entity": "$ability"
        }
      },
      {
        "kind": "taught_by",
        "src": "$hero",
        "dst": "$mentor",
        "strength": 0.8
      }
    ],
    "stateUpdates": [
      {
        "type": "modify_pressure",
        "pressureId": "security",
        "delta": 20
      },
      {
        "type": "modify_pressure",
        "pressureId": "magical_stability",
        "delta": -5
      }
    ],
    "variables": {
      "$ability": {
        "select": {
          "from": "graph",
          "kind": "abilities",
          "pickStrategy": "random",
          "subtypes": [
            "magic"
          ]
        }
      },
      "$mentor": {
        "select": {
          "from": "graph",
          "kind": "npc",
          "pickStrategy": "random"
        }
      }
    },
    "enabled": true
  },
  {
    "id": "succession",
    "name": "Leadership Succession",
    "applicability": [],
    "selection": {
      "strategy": "by_kind",
      "kind": "npc",
      "subtypes": [
        "mayor"
      ],
      "filters": [
        {
          "type": "graph_path",
          "assert": {
            "check": "exists",
            "path": [
              {
                "via": "leader_of",
                "direction": "out",
                "targetKind": "location",
                "targetSubtype": "colony"
              }
            ]
          }
        }
      ],
      "pickStrategy": "random"
    },
    "creation": [
      {
        "entityRef": "$successor",
        "kind": "npc",
        "subtype": "mayor",
        "status": "alive",
        "prominence": "marginal",
        "culture": {
          "inherit": "$colony"
        },
        "description": {
          "template": "Successor to {predecessorName} in {colonyName}",
          "replacements": {
            "predecessorName": "$target.name",
            "colonyName": "$colony.name"
          }
        },
        "tags": {
          "political": true
        },
        "placement": {
          "anchor": {
            "type": "sparse",
            "preferPeriphery": false
          }
        }
      }
    ],
    "relationships": [
      {
        "kind": "believer_of",
        "src": "$successor",
        "dst": "$target",
        "strength": 1
      },
      {
        "kind": "leader_of",
        "src": "$successor",
        "dst": "$colony",
        "strength": 0.9
      },
      {
        "kind": "resident_of",
        "src": "$successor",
        "dst": "$colony",
        "strength": 0.85
      },
      {
        "kind": "leader_of",
        "src": "$successor",
        "dst": "$faction",
        "strength": 0.8,
        "condition": {
          "type": "entity_exists",
          "entity": "$faction"
        }
      },
      {
        "kind": "member_of",
        "src": "$successor",
        "dst": "$faction",
        "strength": 0.75,
        "condition": {
          "type": "entity_exists",
          "entity": "$faction"
        }
      }
    ],
    "stateUpdates": [
      {
        "type": "archive_relationship",
        "entity": "$target",
        "relationshipKind": "leader_of",
        "with": "$colony"
      },
      {
        "type": "archive_relationship",
        "entity": "$target",
        "relationshipKind": "leader_of",
        "with": "$faction"
      }
    ],
    "variables": {
      "$colony": {
        "select": {
          "from": {
            "relatedTo": "$target",
            "relationship": "leader_of",
            "direction": "src"
          },
          "kind": "location",
          "pickStrategy": "first"
        }
      },
      "$faction": {
        "select": {
          "from": {
            "relatedTo": "$target",
            "relationship": "leader_of",
            "direction": "both"
          },
          "kind": "faction",
          "pickStrategy": "first"
        }
      }
    },
    "enabled": true
  },
  {
    "id": "orca_raider_arrival",
    "name": "Orca Raiders Arrive",
    "applicability": [
      {
        "type": "pressure",
        "pressureId": "security",
        "min": -100,
        "max": 0
      }
    ],
    "selection": {
      "strategy": "by_kind",
      "kind": "faction",
      "subtypes": [
        "cult"
      ],
      "pickStrategy": "random",
      "filters": [
        {
          "type": "graph_path",
          "assert": {
            "check": "count_max",
            "path": [
              {
                "via": "discovered_by",
                "direction": "any",
                "targetKind": "npc",
                "targetSubtype": "orca"
              }
            ],
            "count": 2
          }
        }
      ]
    },
    "creation": [
      {
        "entityRef": "$orca1",
        "kind": "npc",
        "subtype": "orca",
        "status": "alive",
        "prominence": "marginal",
        "culture": {
          "fixed": "orca"
        },
        "description": {
          "template": "A fearsome orca raider threatening {colonyName} from the depths",
          "replacements": {
            "colonyName": "$target.name"
          }
        },
        "tags": {
          "orca": true,
          "raider": true,
          "external": true
        },
        "placement": {
          "anchor": {
            "type": "entity",
            "ref": "$parentOrca",
            "stickToRegion": true
          },
          "regionPolicy": {
            "allowEmergent": true
          },
          "steps": [
            "anchor_region",
            "seed_region",
            "sparse",
            "random"
          ]
        }
      },
      {
        "entityRef": "$mainAbility",
        "kind": "abilities",
        "prominence": "recognized",
        "status": "active",
        "subtype": "combat",
        "culture": {
          "fixed": "orca"
        },
        "placement": {
          "anchor": {
            "type": "entity",
            "ref": "$combatAbility",
            "stickToRegion": true
          },
          "regionPolicy": {
            "allowEmergent": true,
            "preferSparse": true
          },
          "steps": [
            "sparse",
            "random"
          ]
        },
        "tags": {
          "wild": true,
          "raider": true,
          "hostile": true
        }
      }
    ],
    "relationships": [
      {
        "kind": "taught_by",
        "src": "$orca1",
        "dst": "$parentOrca",
        "strength": 1
      },
      {
        "kind": "enemy_of",
        "src": "$orca1",
        "dst": "$defender",
        "strength": 0.8,
        "bidirectional": true
      },
      {
        "kind": "enemy_of",
        "src": "$orca1",
        "dst": "$targetFaction",
        "strength": 0.6,
        "condition": {
          "type": "random_chance",
          "chance": 0.5
        },
        "bidirectional": true
      },
      {
        "kind": "practitioner_of",
        "src": "$orca1",
        "dst": "$combatAbility",
        "strength": 0.7,
        "condition": {
          "type": "entity_exists",
          "entity": "$combatAbility"
        }
      },
      {
        "kind": "practitioner_of",
        "src": "$orca1",
        "dst": "$mainAbility",
        "strength": 0.8
      }
    ],
    "stateUpdates": [
      {
        "type": "modify_pressure",
        "pressureId": "security",
        "delta": -10
      }
    ],
    "variables": {
      "$defender": {
        "select": {
          "from": "graph",
          "kind": "npc",
          "subtypes": [
            "hero",
            "mayor"
          ],
          "statusFilter": "alive",
          "pickStrategy": "random"
        },
        "required": true
      },
      "$combatAbility": {
        "select": {
          "from": "graph",
          "kind": "abilities",
          "pickStrategy": "random",
          "subtypes": [
            "combat"
          ]
        }
      },
      "$parentOrca": {
        "select": {
          "from": "graph",
          "kind": "npc",
          "pickStrategy": "random",
          "subtypes": [
            "orca"
          ],
          "statusFilter": "alive"
        }
      }
    },
    "enabled": true
  },
  {
    "id": "faction_splinter",
    "name": "Faction Splinter",
    "applicability": [
      {
        "type": "entity_count",
        "kind": "faction",
        "min": 1
      }
    ],
    "selection": {
      "strategy": "by_kind",
      "kind": "faction",
      "filters": [
        {
          "type": "graph_path",
          "assert": {
            "check": "count_min",
            "count": 1,
            "path": [
              {
                "via": "member_of",
                "direction": "in",
                "targetKind": "npc",
                "targetSubtype": "any"
              }
            ]
          }
        }
      ],
      "pickStrategy": "random"
    },
    "creation": [
      {
        "entityRef": "$splinter",
        "kind": "faction",
        "subtype": {
          "inherit": "$target",
          "chance": 0.6
        },
        "status": "waning",
        "prominence": "marginal",
        "culture": {
          "inherit": "$target"
        },
        "description": {
          "template": "A splinter group that broke away from {parentName}",
          "replacements": {
            "parentName": "$target.name"
          }
        },
        "tags": {
          "splinter": true
        },
        "placement": {
          "anchor": {
            "type": "culture",
            "id": "$target"
          },
          "regionPolicy": {
            "allowEmergent": true
          },
          "steps": [
            "seed_region",
            "sparse",
            "random"
          ]
        }
      }
    ],
    "relationships": [
      {
        "kind": "splinter_of",
        "src": "$splinter",
        "dst": "$target",
        "strength": 1
      },
      {
        "kind": "at_war_with",
        "src": "$splinter",
        "dst": "$target",
        "strength": 0.7
      },
      {
        "kind": "occupies",
        "src": "$splinter",
        "dst": "$location",
        "strength": 0.6
      },
      {
        "kind": "leader_of",
        "src": "$defector",
        "dst": "$splinter",
        "strength": 0.9,
        "condition": {
          "type": "entity_exists",
          "entity": "$defector"
        }
      },
      {
        "kind": "member_of",
        "src": "$defector",
        "dst": "$splinter",
        "strength": 0.85,
        "condition": {
          "type": "entity_exists",
          "entity": "$defector"
        }
      },
      {
        "kind": "resident_of",
        "src": "$defector",
        "dst": "$location",
        "strength": 0.7,
        "condition": {
          "type": "entity_exists",
          "entity": "$defector"
        }
      }
    ],
    "stateUpdates": [
      {
        "type": "archive_relationship",
        "entity": "$defector",
        "relationshipKind": "member_of",
        "with": "$target"
      },
      {
        "type": "modify_pressure",
        "pressureId": "harmony",
        "delta": -3
      },
      {
        "type": "modify_pressure",
        "pressureId": "harmony",
        "delta": -2
      }
    ],
    "variables": {
      "$members": {
        "select": {
          "from": {
            "relatedTo": "$target",
            "relationship": "member_of",
            "direction": "dst"
          },
          "pickStrategy": "all"
        }
      },
      "$defector": {
        "select": {
          "from": {
            "relatedTo": "$target",
            "relationship": "member_of",
            "direction": "dst"
          },
          "filters": [
            {
              "type": "lacks_relationship",
              "kind": "leader_of"
            }
          ],
          "pickStrategy": "random"
        }
      },
      "$location": {
        "select": {
          "from": {
            "relatedTo": "$target",
            "relationship": "controls",
            "direction": "src"
          },
          "pickStrategy": "random"
        }
      }
    },
    "enabled": false
  },
  {
    "id": "guild_establishment",
    "name": "Guild Formation",
    "applicability": [],
    "selection": {
      "strategy": "by_kind",
      "kind": "location",
      "subtypes": [
        "colony"
      ],
      "pickStrategy": "random"
    },
    "creation": [
      {
        "entityRef": "$guild",
        "kind": "faction",
        "subtype": "company",
        "status": "state_sanctioned",
        "prominence": "recognized",
        "culture": {
          "inherit": "$target"
        },
        "description": {
          "template": "A merchant guild controlling trade in {colonyName}",
          "replacements": {
            "colonyName": "$target.name"
          }
        },
        "tags": {
          "trade": true,
          "organized": true
        },
        "placement": {
          "anchor": {
            "type": "culture",
            "id": "$target"
          },
          "regionPolicy": {
            "allowEmergent": true,
            "preferSparse": true
          },
          "steps": [
            "seed_region",
            "sparse",
            "random"
          ]
        }
      }
    ],
    "relationships": [
      {
        "kind": "originated_in",
        "src": "$guild",
        "dst": "$target",
        "strength": 1
      },
      {
        "kind": "member_of",
        "src": "$merchant1",
        "dst": "$guild",
        "strength": 0.8,
        "condition": {
          "type": "entity_exists",
          "entity": "$merchant1"
        }
      },
      {
        "kind": "resident_of",
        "src": "$merchant1",
        "dst": "$target",
        "strength": 0.75,
        "condition": {
          "type": "entity_exists",
          "entity": "$merchant1"
        }
      },
      {
        "kind": "member_of",
        "src": "$merchant2",
        "dst": "$guild",
        "strength": 0.8,
        "condition": {
          "type": "entity_exists",
          "entity": "$merchant2"
        }
      },
      {
        "kind": "resident_of",
        "src": "$merchant2",
        "dst": "$target",
        "strength": 0.75,
        "condition": {
          "type": "entity_exists",
          "entity": "$merchant2"
        }
      }
    ],
    "stateUpdates": [
      {
        "type": "archive_relationship",
        "entity": "$merchant1",
        "relationshipKind": "resident_of",
        "direction": "both"
      },
      {
        "type": "archive_relationship",
        "entity": "$merchant2",
        "relationshipKind": "resident_of",
        "direction": "both"
      }
    ],
    "variables": {
      "$merchant1": {
        "select": {
          "from": "graph",
          "kind": "npc",
          "subtypes": [
            "merchant"
          ],
          "filters": [
            {
              "type": "matches_culture",
              "with": "$target"
            }
          ],
          "pickStrategy": "random"
        },
        "required": true
      },
      "$merchant2": {
        "select": {
          "from": "graph",
          "kind": "npc",
          "subtypes": [
            "merchant"
          ],
          "filters": [
            {
              "type": "exclude",
              "entities": [
                "$merchant1"
              ]
            },
            {
              "type": "matches_culture",
              "with": "$target"
            }
          ],
          "pickStrategy": "random"
        },
        "required": true
      }
    },
    "enabled": true
  },
  {
    "id": "cult_formation",
    "name": "Cult Awakening",
    "applicability": [],
    "selection": {
      "strategy": "by_kind",
      "kind": "location",
      "subtypes": [
        "anomaly",
        "point_of_interest"
      ],
      "pickStrategy": "random",
      "filters": [
        {
          "type": "graph_path",
          "assert": {
            "check": "count_max",
            "path": [
              {
                "via": "originated_in",
                "direction": "any",
                "targetKind": "faction",
                "targetSubtype": "any"
              }
            ],
            "count": 3
          }
        }
      ]
    },
    "creation": [
      {
        "entityRef": "$cult",
        "kind": "faction",
        "subtype": "cult",
        "status": "illegal",
        "prominence": "marginal",
        "culture": {
          "inherit": "$magic"
        },
        "description": {
          "template": "A mystical cult drawn to the power near {locationName}",
          "replacements": {
            "locationName": "$target.name"
          }
        },
        "tags": {
          "mystical": true,
          "secretive": true
        },
        "placement": {
          "anchor": {
            "type": "culture",
            "id": "$magic"
          },
          "regionPolicy": {
            "allowEmergent": true
          },
          "steps": [
            "seed_region",
            "sparse",
            "random"
          ]
        }
      },
      {
        "entityRef": "$prophet",
        "kind": "npc",
        "subtype": "hero",
        "status": "alive",
        "prominence": "marginal",
        "culture": {
          "inherit": "$magic"
        },
        "description": {
          "template": "The enigmatic prophet of a mystical cult near {locationName}",
          "replacements": {
            "locationName": "$target.name"
          }
        },
        "tags": {
          "mystical": true
        },
        "placement": {
          "anchor": {
            "type": "entity",
            "ref": "$mentor",
            "stickToRegion": true
          },
          "regionPolicy": {
            "allowEmergent": true
          },
          "steps": [
            "anchor_region",
            "seed_region",
            "sparse",
            "random"
          ]
        }
      }
    ],
    "relationships": [
      {
        "kind": "taught_by",
        "src": "$prophet",
        "dst": "$mentor",
        "strength": 1
      },
      {
        "kind": "originated_in",
        "src": "$cult",
        "dst": "$target",
        "strength": 1
      },
      {
        "kind": "leader_of",
        "src": "$prophet",
        "dst": "$cult",
        "strength": 0.9
      },
      {
        "kind": "resident_of",
        "src": "$prophet",
        "dst": "$target",
        "strength": 0.85
      },
      {
        "kind": "member_of",
        "src": "$cultist",
        "dst": "$cult",
        "strength": 0.75,
        "condition": {
          "type": "entity_exists",
          "entity": "$cultist"
        }
      },
      {
        "kind": "resident_of",
        "src": "$cultist",
        "dst": "$target",
        "strength": 0.7,
        "condition": {
          "type": "entity_exists",
          "entity": "$cultist"
        }
      },
      {
        "kind": "related_to",
        "src": "$cult",
        "dst": "$magic",
        "strength": 0.8,
        "condition": {
          "type": "entity_exists",
          "entity": "$magic"
        }
      },
      {
        "kind": "practitioner_of",
        "src": "$prophet",
        "dst": "$magic",
        "strength": 0.85,
        "condition": {
          "type": "entity_exists",
          "entity": "$magic"
        }
      },
      {
        "kind": "practitioner_of",
        "src": "$cultist",
        "dst": "$magic",
        "strength": 0.4
      },
      {
        "kind": "taught_by",
        "src": "$cultist",
        "dst": "$prophet",
        "strength": 0.8
      }
    ],
    "stateUpdates": [
      {
        "type": "modify_pressure",
        "pressureId": "magical_stability",
        "delta": -10
      },
      {
        "type": "modify_pressure",
        "pressureId": "security",
        "delta": -10
      },
      {
        "type": "archive_relationship",
        "entity": "$cultist",
        "relationshipKind": "resident_of",
        "direction": "both"
      }
    ],
    "variables": {
      "$magic": {
        "select": {
          "from": "graph",
          "kind": "abilities",
          "subtypes": [
            "magic"
          ],
          "pickStrategy": "first"
        },
        "required": true
      },
      "$cultist": {
        "select": {
          "from": "graph",
          "kind": "npc",
          "subtypes": [
            "merchant",
            "outlaw",
            "hero"
          ],
          "pickStrategy": "random"
        },
        "required": false
      },
      "$mentor": {
        "select": {
          "from": "graph",
          "kind": "npc",
          "pickStrategy": "random",
          "subtypes": [
            "hero"
          ],
          "statusFilter": "alive"
        },
        "required": false
      }
    },
    "enabled": true
  },
  {
    "id": "colony_founding",
    "name": "Colony Foundation",
    "applicability": [
      {
        "type": "pressure_any_above",
        "pressureIds": [
          "resource_availibility",
          "magical_stability",
          "security",
          "harmony"
        ],
        "threshold": 0
      }
    ],
    "selection": {
      "strategy": "by_kind",
      "kind": "location",
      "subtypes": [
        "colony"
      ],
      "pickStrategy": "random",
      "filters": [
        {
          "type": "has_tag",
          "tag": "thriving"
        }
      ]
    },
    "creation": [
      {
        "entityRef": "$colony",
        "kind": "location",
        "subtype": "colony",
        "status": "thriving",
        "prominence": "marginal",
        "culture": {
          "inherit": "$target"
        },
        "description": {
          "template": "New colony established on {icebergName} in the reaches",
          "replacements": {
            "icebergName": "$target.name"
          }
        },
        "tags": {
          "emergent": true,
          "colony": true
        },
        "placement": {
          "anchor": {
            "type": "sparse",
            "preferPeriphery": true
          },
          "spacing": {
            "minDistance": 20,
            "avoidRefs": [
              "$target"
            ]
          },
          "regionPolicy": {
            "allowEmergent": true,
            "createRegion": true
          },
          "steps": [
            "sparse",
            "random"
          ]
        }
      },
      {
        "entityRef": "$mayor",
        "kind": "npc",
        "prominence": "recognized",
        "status": "alive",
        "subtype": "mayor",
        "culture": {
          "inherit": "$target"
        },
        "placement": {
          "anchor": {
            "type": "culture",
            "id": "$target"
          },
          "spacing": {
            "minDistance": 1
          },
          "regionPolicy": {
            "allowEmergent": true
          },
          "steps": [
            "seed_region"
          ]
        },
        "tags": {
          "leader": true,
          "influential": true
        }
      }
    ],
    "relationships": [
      {
        "kind": "trades_with",
        "src": "$colony",
        "dst": "$target",
        "strength": 1,
        "bidirectional": true
      },
      {
        "kind": "allied_with",
        "src": "$colony",
        "dst": "$target",
        "strength": 1,
        "bidirectional": true
      },
      {
        "kind": "leader_of",
        "src": "$mayor",
        "dst": "$colony",
        "strength": 0.8
      },
      {
        "kind": "resident_of",
        "src": "$mayor",
        "dst": "$colony",
        "strength": 0.8
      }
    ],
    "stateUpdates": [
      {
        "type": "remove_tag",
        "entity": "$colony",
        "tag": "thriving"
      }
    ],
    "variables": {},
    "enabled": true
  },
  {
    "id": "location_discovery",
    "name": " Location Discovery",
    "applicability": [],
    "selection": {
      "strategy": "by_kind",
      "kind": "npc",
      "subtypePreferences": [
        "hero",
        "outlaw",
        "merchant",
        "mayor"
      ],
      "statusFilter": "alive",
      "pickStrategy": "random"
    },
    "creation": [
      {
        "entityRef": "$location",
        "kind": "location",
        "subtype": "resource_node",
        "status": "unspoiled",
        "prominence": "recognized",
        "culture": {
          "inherit": "$target"
        },
        "tags": {
          "discovered": true,
          "emergent": true
        },
        "placement": {
          "anchor": {
            "type": "entity",
            "ref": "$nearbyLocation",
            "stickToRegion": true
          },
          "regionPolicy": {
            "allowEmergent": true,
            "preferSparse": true
          },
          "steps": [
            "seed_region",
            "sparse",
            "random"
          ]
        }
      }
    ],
    "relationships": [
      {
        "kind": "discovered_by",
        "src": "$location",
        "dst": "$target",
        "strength": 1
      },
      {
        "kind": "explorer_of",
        "src": "$target",
        "dst": "$location",
        "strength": 0.8
      },
      {
        "kind": "discovered_by",
        "src": "$location",
        "dst": "$target",
        "strength": 0.8
      },
      {
        "kind": "adjacent_to",
        "src": "$location",
        "dst": "$nearbyLocation",
        "bidirectional": true,
        "strength": 0.6,
        "condition": {
          "type": "entity_exists",
          "entity": "$nearbyLocation"
        }
      }
    ],
    "stateUpdates": [
      {
        "type": "modify_pressure",
        "pressureId": "resource_availibility",
        "delta": 10
      }
    ],
    "variables": {
      "$nearbyLocation": {
        "select": {
          "kind": "location",
          "pickStrategy": "random",
          "from": "graph",
          "filters": [
            {
              "type": "matches_culture",
              "with": "$target"
            }
          ]
        },
        "required": true
      }
    },
    "enabled": true,
    "variants": {
      "selection": "first_match",
      "options": [
        {
          "name": "Anomaly Discovery",
          "when": {
            "type": "pressure_compare",
            "pressureA": "magical_stability",
            "pressureB": "resource_availibility"
          },
          "apply": {
            "stateUpdates": [
              {
                "type": "modify_pressure",
                "pressureId": "magical_stability",
                "delta": -30
              }
            ],
            "subtype": {
              "$location": "anomaly"
            }
          }
        },
        {
          "name": "Strategic Location",
          "when": {
            "type": "pressure_compare",
            "pressureA": "resource_availibility",
            "pressureB": "security"
          },
          "apply": {
            "subtype": {
              "$location": "point_of_interest"
            },
            "tags": {
              "$location": {
                "conflict": true
              }
            },
            "stateUpdates": [
              {
                "type": "modify_pressure",
                "pressureId": "security",
                "delta": 5
              }
            ]
          }
        }
      ]
    }
  },
  {
    "id": "krill_bloom_migration",
    "name": "Krill Bloom Discovery",
    "applicability": [
      {
        "type": "pressure",
        "pressureId": "harmony",
        "min": 40,
        "max": 100
      }
    ],
    "selection": {
      "strategy": "by_kind",
      "kind": "location",
      "subtypes": [
        "colony"
      ],
      "pickStrategy": "random",
      "filters": [
        {
          "type": "graph_path",
          "assert": {
            "check": "not_exists",
            "path": [
              {
                "via": "originated_in",
                "direction": "any",
                "targetKind": "faction",
                "targetSubtype": "company"
              }
            ]
          }
        }
      ]
    },
    "creation": [
      {
        "entityRef": "$bloom",
        "kind": "location",
        "subtype": "resource_node",
        "status": "thriving",
        "prominence": "recognized",
        "culture": {
          "inherit": "$target"
        },
        "description": "Massive bioluminescent krill swarms dance in these waters, drawing merchants and hunters from across the berg.",
        "tags": {
          "resource": true
        },
        "placement": {
          "anchor": {
            "type": "entity",
            "ref": "$target",
            "stickToRegion": true
          },
          "steps": [
            "anchor_region",
            "seed_region",
            "sparse",
            "random"
          ]
        }
      },
      {
        "entityRef": "$merchant",
        "kind": "npc",
        "subtype": "merchant",
        "status": "alive",
        "prominence": "marginal",
        "culture": {
          "inherit": "$target"
        },
        "description": "An enterprising merchant who discovered the krill blooms and now leads expeditions to harvest them.",
        "tags": {
          "emergent": true,
          "trade": true,
          "resource": true
        },
        "placement": {
          "anchor": {
            "type": "culture",
            "id": "$target"
          },
          "steps": [
            "anchor_region",
            "seed_region",
            "sparse",
            "random"
          ]
        }
      },
      {
        "entityRef": "$company",
        "kind": "faction",
        "prominence": "marginal",
        "status": "active",
        "subtype": "company",
        "culture": {
          "inherit": "$target"
        },
        "placement": {
          "anchor": {
            "type": "culture",
            "id": "$target"
          },
          "spacing": {
            "minDistance": 5
          },
          "regionPolicy": {
            "allowEmergent": true
          }
        }
      }
    ],
    "relationships": [
      {
        "kind": "originated_in",
        "src": "$company",
        "dst": "$target",
        "strength": 0.8
      },
      {
        "kind": "member_of",
        "src": "$merchant",
        "dst": "$company",
        "strength": 0.8
      },
      {
        "kind": "leader_of",
        "src": "$merchant",
        "dst": "$company",
        "strength": 0.8
      },
      {
        "kind": "controls",
        "src": "$company",
        "dst": "$bloom",
        "strength": 0.8
      },
      {
        "kind": "adjacent_to",
        "src": "$bloom",
        "dst": "$target",
        "strength": 0.8,
        "bidirectional": true
      }
    ],
    "stateUpdates": [
      {
        "type": "modify_pressure",
        "pressureId": "resource_availibility",
        "delta": 10
      },
      {
        "type": "modify_pressure",
        "pressureId": "harmony",
        "delta": -25
      }
    ],
    "variables": {},
    "enabled": true
  },
  {
    "id": "war_outbreak",
    "name": "War Outbreak",
    "applicability": [],
    "selection": {
      "strategy": "by_kind",
      "kind": "faction",
      "filters": [
        {
          "type": "has_tag",
          "tag": "conflict"
        }
      ],
      "pickStrategy": "random"
    },
    "creation": [
      {
        "entityRef": "$war",
        "kind": "occurrence",
        "subtype": "war",
        "status": "active",
        "prominence": "renowned",
        "culture": {
          "inherit": "$target"
        },
        "description": {
          "template": "A devastating war has erupted involving {factionName} and their rivals",
          "replacements": {
            "factionName": "$target.name"
          }
        },
        "tags": {
          "conflict": true
        },
        "placement": {
          "anchor": {
            "type": "culture",
            "id": "$target"
          },
          "regionPolicy": {
            "allowEmergent": true
          },
          "steps": [
            "seed_region",
            "sparse",
            "random"
          ]
        }
      }
    ],
    "relationships": [
      {
        "kind": "participant_in",
        "src": "$war",
        "dst": "$target",
        "strength": 1
      },
      {
        "kind": "participant_in",
        "src": "$target",
        "dst": "$war",
        "strength": 0.9
      },
      {
        "kind": "participant_in",
        "src": "$enemy",
        "dst": "$war",
        "strength": 0.9,
        "condition": {
          "type": "entity_exists",
          "entity": "$enemy"
        }
      }
    ],
    "stateUpdates": [
      {
        "type": "set_tag",
        "entity": "$target",
        "tag": "conflict",
        "value": true
      },
      {
        "type": "modify_pressure",
        "pressureId": "harmony",
        "delta": -15
      },
      {
        "type": "modify_pressure",
        "pressureId": "security",
        "delta": -10
      }
    ],
    "variables": {
      "$enemy": {
        "select": {
          "pickStrategy": "random",
          "kind": "faction",
          "from": "graph"
        }
      }
    },
    "enabled": false
  },
  {
    "id": "succession_crisis",
    "name": "Succession Crisis",
    "applicability": [],
    "selection": {
      "strategy": "by_kind",
      "kind": "faction",
      "filters": [
        {
          "type": "has_tag",
          "tag": "power_vacuum"
        }
      ],
      "pickStrategy": "random"
    },
    "creation": [
      {
        "entityRef": "$crisis",
        "kind": "occurrence",
        "subtype": "succession_crisis",
        "status": "active",
        "prominence": "recognized",
        "culture": {
          "inherit": "$target"
        },
        "description": {
          "template": "A bitter succession crisis has erupted in {factionName} following the death of their leader",
          "replacements": {
            "factionName": "$target.name"
          }
        },
        "tags": {
          "political": true,
          "conflict": true
        },
        "placement": {
          "anchor": {
            "type": "culture",
            "id": "$target"
          },
          "regionPolicy": {
            "allowEmergent": true
          },
          "steps": [
            "seed_region",
            "sparse",
            "random"
          ]
        }
      }
    ],
    "relationships": [
      {
        "kind": "participant_in",
        "src": "$crisis",
        "dst": "$target",
        "strength": 1
      },
      {
        "kind": "participant_in",
        "src": "$crisis",
        "dst": "$target",
        "strength": 0.9
      }
    ],
    "stateUpdates": [
      {
        "type": "remove_tag",
        "entity": "$target",
        "tag": "power_vacuum"
      },
      {
        "type": "change_status",
        "entity": "$target",
        "newStatus": "waning"
      },
      {
        "type": "modify_pressure",
        "pressureId": "security",
        "delta": -20
      },
      {
        "type": "modify_pressure",
        "pressureId": "harmony",
        "delta": -10
      }
    ],
    "variables": {},
    "enabled": false
  },
  {
    "id": "legend_crystallization",
    "name": "Legend Crystallization",
    "applicability": [
      {
        "type": "entity_count",
        "kind": "npc",
        "max": 10,
        "subtype": "hero"
      }
    ],
    "selection": {
      "strategy": "by_kind",
      "kind": "npc",
      "filters": [
        {
          "type": "has_tag",
          "tag": "legendary"
        }
      ],
      "pickStrategy": "random"
    },
    "creation": [
      {
        "entityRef": "$memorial",
        "kind": "rules",
        "subtype": "memorial",
        "status": "enacted",
        "prominence": "recognized",
        "culture": {
          "inherit": "$target"
        },
        "description": {
          "template": "A sacred tradition honoring the memory of {heroName}, whose deeds have passed into legend",
          "replacements": {
            "heroName": "$target.name"
          }
        },
        "tags": {
          "cultural": true
        },
        "placement": {
          "anchor": {
            "type": "culture",
            "id": "$target"
          },
          "regionPolicy": {
            "allowEmergent": true
          },
          "steps": [
            "seed_region",
            "sparse",
            "random"
          ]
        }
      }
    ],
    "relationships": [
      {
        "kind": "commemorates",
        "src": "$memorial",
        "dst": "$target",
        "strength": 1
      },
      {
        "kind": "commemorates",
        "src": "$memorial",
        "dst": "$target",
        "strength": 1
      },
      {
        "kind": "originated_in",
        "src": "$memorial",
        "dst": "$location",
        "strength": 0.8,
        "condition": {
          "type": "entity_exists",
          "entity": "$location"
        }
      },
      {
        "kind": "commemorates",
        "src": "$location",
        "dst": "$target",
        "strength": 0.7,
        "condition": {
          "type": "entity_exists",
          "entity": "$location"
        }
      }
    ],
    "stateUpdates": [
      {
        "type": "set_tag",
        "entity": "$target",
        "tag": "legendary",
        "value": true
      },
      {
        "type": "change_status",
        "entity": "$target",
        "newStatus": "fictional"
      }
    ],
    "variables": {
      "$location": {
        "select": {
          "pickStrategy": "first",
          "kind": "location",
          "from": {
            "relatedTo": "$target",
            "relationship": "resident_of",
            "direction": "both"
          }
        }
      }
    },
    "enabled": false
  },
  {
    "id": "crisis_legislation",
    "name": "Crisis Law",
    "applicability": [
      {
        "type": "pressure",
        "pressureId": "security",
        "min": -100,
        "max": -80
      }
    ],
    "selection": {
      "strategy": "by_kind",
      "kind": "location",
      "subtypes": [
        "colony"
      ],
      "pickStrategy": "random"
    },
    "creation": [
      {
        "entityRef": "$rule",
        "kind": "rules",
        "subtype": "law",
        "status": "enacted",
        "prominence": "recognized",
        "culture": {
          "inherit": "$target"
        },
        "description": {
          "template": "Emergency measure enacted in {colonyName}",
          "replacements": {
            "colonyName": "$target.name"
          }
        },
        "tags": {
          "crisis": true
        },
        "placement": {
          "anchor": {
            "type": "culture",
            "id": "$target"
          },
          "regionPolicy": {
            "allowEmergent": true
          },
          "steps": [
            "seed_region",
            "sparse",
            "random"
          ]
        }
      }
    ],
    "relationships": [
      {
        "kind": "originated_in",
        "src": "$rule",
        "dst": "$target",
        "strength": 1
      },
      {
        "kind": "derived_from",
        "src": "$rule",
        "dst": "$existingRule",
        "strength": 0.7,
        "condition": {
          "type": "random_chance",
          "chance": 0.4
        }
      },
      {
        "kind": "contained_by",
        "src": "$mainThreat",
        "dst": "$rule",
        "strength": 0.8
      }
    ],
    "stateUpdates": [
      {
        "type": "modify_pressure",
        "pressureId": "security",
        "delta": 40
      }
    ],
    "variables": {
      "$existingRule": {
        "select": {
          "from": {
            "relatedTo": "$target",
            "relationship": "originated_in",
            "direction": "dst"
          },
          "notStatus": "repealed",
          "pickStrategy": "random"
        }
      },
      "$mainThreat": {
        "select": {
          "from": "graph",
          "kind": "npc",
          "pickStrategy": "random",
          "subtypes": [
            "orca"
          ],
          "filters": [
            {
              "type": "graph_path",
              "assert": {
                "check": "not_exists",
                "path": [
                  {
                    "via": "contained_by",
                    "direction": "any",
                    "targetKind": "rules",
                    "targetSubtype": "law"
                  }
                ]
              }
            }
          ]
        },
        "required": true
      }
    },
    "enabled": true
  },
  {
    "id": "great_festival",
    "name": "Great Festival",
    "applicability": [],
    "selection": {
      "strategy": "by_kind",
      "kind": "location",
      "subtypes": [
        "colony"
      ],
      "pickStrategy": "random",
      "filters": [
        {
          "type": "graph_path",
          "assert": {
            "check": "count_max",
            "path": [
              {
                "via": "celebrated_by",
                "direction": "any",
                "targetKind": "rules",
                "targetSubtype": "any"
              }
            ],
            "count": 2
          }
        }
      ]
    },
    "creation": [
      {
        "entityRef": "$festival",
        "kind": "rules",
        "subtype": "social",
        "status": "enacted",
        "prominence": "recognized",
        "culture": {
          "inherit": "$target"
        },
        "description": {
          "template": "A great festival celebrating prosperity and unity, held in {colonyName}",
          "replacements": {
            "colonyName": "$target.name"
          }
        },
        "tags": {
          "cultural": true
        },
        "placement": {
          "anchor": {
            "type": "culture",
            "id": "$target"
          },
          "regionPolicy": {
            "allowEmergent": true
          },
          "steps": [
            "seed_region",
            "sparse",
            "random"
          ]
        }
      }
    ],
    "relationships": [
      {
        "kind": "originated_in",
        "src": "$festival",
        "dst": "$target",
        "strength": 1
      },
      {
        "kind": "celebrated_by",
        "src": "$festival",
        "dst": "$faction1",
        "strength": 0.7,
        "condition": {
          "type": "entity_exists",
          "entity": "$faction1"
        }
      },
      {
        "kind": "celebrated_by",
        "src": "$festival",
        "dst": "$faction2",
        "strength": 0.7,
        "condition": {
          "type": "entity_exists",
          "entity": "$faction2"
        }
      },
      {
        "kind": "allied_with",
        "src": "$faction1",
        "dst": "$faction2",
        "strength": 0.5,
        "condition": {
          "type": "entity_exists",
          "entity": "$faction2"
        },
        "bidirectional": true
      }
    ],
    "stateUpdates": [
      {
        "type": "modify_pressure",
        "pressureId": "harmony",
        "delta": 25
      }
    ],
    "variables": {
      "$faction1": {
        "select": {
          "from": "graph",
          "kind": "faction",
          "pickStrategy": "random",
          "filters": [
            {
              "type": "has_tag",
              "tag": "mystical"
            }
          ]
        },
        "required": true
      },
      "$faction2": {
        "select": {
          "from": "graph",
          "kind": "faction",
          "filters": [
            {
              "type": "exclude",
              "entities": [
                "$faction1"
              ]
            }
          ],
          "pickStrategy": "random"
        },
        "required": true
      }
    },
    "enabled": true
  },
  {
    "id": "tech_breakthrough",
    "name": "Technological Breakthrough",
    "applicability": [],
    "selection": {
      "strategy": "by_kind",
      "kind": "faction",
      "pickStrategy": "random"
    },
    "creation": [
      {
        "entityRef": "$tech",
        "kind": "abilities",
        "subtype": "technology",
        "status": "active",
        "prominence": "recognized",
        "culture": {
          "inherit": "$target"
        },
        "description": {
          "template": "A technological breakthrough developed by {factionName} at {locationName}",
          "replacements": {
            "factionName": "$target.name",
            "locationName": "$location.name"
          }
        },
        "tags": {
          "technology": true,
          "innovation": true
        },
        "placement": {
          "anchor": {
            "type": "entity",
            "ref": "$parentTech",
            "stickToRegion": true
          },
          "regionPolicy": {
            "allowEmergent": true,
            "preferSparse": true
          },
          "steps": [
            "anchor_region",
            "seed_region",
            "sparse",
            "random"
          ]
        }
      }
    ],
    "relationships": [
      {
        "kind": "derived_from",
        "src": "$tech",
        "dst": "$parentTech",
        "strength": 1
      },
      {
        "kind": "practitioner_of",
        "src": "$target",
        "dst": "$tech",
        "strength": 0.9,
        "catalyzedBy": "$leader"
      },
      {
        "kind": "originated_in",
        "src": "$tech",
        "dst": "$location",
        "strength": 0.7
      }
    ],
    "stateUpdates": [
      {
        "type": "modify_pressure",
        "pressureId": "magical_stability",
        "delta": -5
      }
    ],
    "variables": {
      "$location": {
        "select": {
          "from": {
            "relatedTo": "$target",
            "relationship": "originated_in",
            "direction": "src"
          },
          "pickStrategy": "random"
        },
        "required": true
      },
      "$parentTech": {
        "select": {
          "from": "graph",
          "kind": "abilities",
          "pickStrategy": "random",
          "subtypes": [
            "technology"
          ]
        }
      }
    },
    "enabled": true
  },
  {
    "id": "orca_combat_technique",
    "name": "Orca Combat Technique",
    "applicability": [],
    "selection": {
      "strategy": "by_kind",
      "kind": "npc",
      "subtypes": [
        "orca"
      ],
      "filters": [
        {
          "type": "graph_path",
          "assert": {
            "check": "count_max",
            "count": 1,
            "path": [
              {
                "via": "practitioner_of",
                "direction": "out",
                "targetKind": "abilities",
                "targetSubtype": "any"
              }
            ]
          }
        }
      ],
      "pickStrategy": "random"
    },
    "creation": [
      {
        "entityRef": "$technique",
        "kind": "abilities",
        "subtype": "combat",
        "status": "active",
        "prominence": "marginal",
        "culture": {
          "fixed": "orca"
        },
        "description": {
          "template": "A devastating combat technique used by orca raiders, witnessed when {orcaName} attacked",
          "replacements": {
            "orcaName": "$target.name"
          }
        },
        "tags": {
          "conflict": true,
          "orca": true,
          "hostile": true,
          "external": true
        },
        "placement": {
          "anchor": {
            "type": "entity",
            "ref": "$parentTechnique",
            "stickToRegion": true
          },
          "steps": [
            "anchor_region",
            "seed_region",
            "sparse",
            "random"
          ]
        }
      }
    ],
    "relationships": [
      {
        "kind": "derived_from",
        "src": "$technique",
        "dst": "$parentTechnique",
        "strength": 1
      },
      {
        "kind": "practitioner_of",
        "src": "$target",
        "dst": "$technique",
        "strength": 0.9
      },
      {
        "kind": "practitioner_of",
        "src": "$otherOrca",
        "dst": "$technique",
        "strength": 0.8,
        "condition": {
          "type": "random_chance",
          "chance": 0.6
        }
      }
    ],
    "stateUpdates": [],
    "variables": {
      "$otherOrca": {
        "select": {
          "from": "graph",
          "kind": "npc",
          "subtypes": [
            "orca"
          ],
          "filters": [
            {
              "type": "exclude",
              "entities": [
                "$target"
              ]
            }
          ],
          "pickStrategy": "random"
        }
      },
      "$parentTechnique": {
        "select": {
          "from": "graph",
          "kind": "abilities",
          "pickStrategy": "random",
          "subtypes": [
            "combat"
          ]
        }
      }
    },
    "enabled": true
  },
  {
    "id": "magic_discovery",
    "name": "Magical Discovery",
    "applicability": [
      {
        "type": "pressure",
        "pressureId": "magical_stability",
        "min": -50,
        "max": 50
      }
    ],
    "selection": {
      "strategy": "by_kind",
      "kind": "npc",
      "filters": [
        {
          "type": "graph_path",
          "assert": {
            "check": "count_max",
            "count": 2,
            "path": [
              {
                "via": "discovered_by",
                "direction": "out",
                "targetKind": "abilities",
                "targetSubtype": "magic"
              }
            ]
          }
        }
      ],
      "pickStrategy": "random"
    },
    "creation": [
      {
        "entityRef": "$magic",
        "kind": "abilities",
        "subtype": "magic",
        "status": "emergent",
        "prominence": "recognized",
        "culture": {
          "inherit": "$target"
        },
        "description": {
          "template": "Mystical ability discovered by {heroName}",
          "replacements": {
            "heroName": "$target.name"
          }
        },
        "tags": {
          "mystical": true
        },
        "placement": {
          "anchor": {
            "type": "entity",
            "ref": "$parentMagic",
            "stickToRegion": true
          },
          "regionPolicy": {
            "preferSparse": true,
            "allowEmergent": true
          },
          "steps": [
            "anchor_region",
            "seed_region",
            "sparse",
            "random"
          ]
        }
      }
    ],
    "relationships": [
      {
        "kind": "derived_from",
        "src": "$magic",
        "dst": "$parentMagic",
        "strength": 1
      },
      {
        "kind": "discovered_by",
        "src": "$magic",
        "dst": "$target",
        "strength": 1
      },
      {
        "kind": "manifests_at",
        "src": "$magic",
        "dst": "$anomaly",
        "strength": 0.8,
        "condition": {
          "type": "entity_exists",
          "entity": "$anomaly"
        }
      }
    ],
    "stateUpdates": [
      {
        "type": "modify_pressure",
        "pressureId": "magical_stability",
        "delta": 10
      }
    ],
    "variables": {
      "$anomaly": {
        "select": {
          "from": "graph",
          "kind": "location",
          "subtypes": [
            "anomaly"
          ],
          "pickStrategy": "random"
        }
      },
      "$parentMagic": {
        "select": {
          "from": "graph",
          "kind": "abilities",
          "pickStrategy": "random",
          "subtypes": [
            "magic"
          ],
          "statusFilter": "discovered"
        }
      }
    },
    "enabled": true
  },
  {
    "id": "ideology_emergence",
    "name": "Ideological Movement",
    "applicability": [],
    "selection": {
      "strategy": "by_kind",
      "kind": "npc",
      "subtypePreferences": [
        "hero"
      ],
      "statusFilter": "alive",
      "pickStrategy": "random",
      "minProminence": "renowned"
    },
    "creation": [
      {
        "entityRef": "$ideology",
        "kind": "rules",
        "subtype": "ideology",
        "status": "proposed",
        "prominence": "marginal",
        "culture": {
          "inherit": "$target"
        },
        "description": {
          "template": "An ideology championed by {championName}. This belief is spreading through whispered conversations and passionate debates.",
          "replacements": {
            "championName": "$target.name"
          }
        },
        "tags": {
          "political": true,
          "cultural": true
        },
        "placement": {
          "anchor": {
            "type": "entity",
            "ref": "$existingIdeology",
            "stickToRegion": true
          },
          "regionPolicy": {
            "allowEmergent": true,
            "preferSparse": true
          },
          "steps": [
            "anchor_region",
            "seed_region",
            "sparse",
            "random"
          ]
        }
      }
    ],
    "relationships": [
      {
        "kind": "believer_of",
        "src": "$target",
        "dst": "$ideology",
        "strength": 1
      },
      {
        "kind": "originated_in",
        "src": "$ideology",
        "dst": "$championLocation",
        "strength": 0.8,
        "condition": {
          "type": "entity_exists",
          "entity": "$championLocation"
        }
      },
      {
        "kind": "believer_of",
        "src": "$factionMember1",
        "dst": "$ideology",
        "strength": 0.6,
        "condition": {
          "type": "entity_exists",
          "entity": "$factionMember1"
        }
      },
      {
        "kind": "related_to",
        "src": "$ideology",
        "dst": "$existingIdeology",
        "strength": 0.5,
        "condition": {
          "type": "entity_exists",
          "entity": "$existingIdeology"
        }
      },
      {
        "kind": "believer_of",
        "src": "$championFaction",
        "dst": "$ideology",
        "strength": 0.8
      }
    ],
    "stateUpdates": [],
    "variables": {
      "$championLocation": {
        "select": {
          "from": {
            "relatedTo": "$target",
            "relationship": "resident_of",
            "direction": "src"
          },
          "pickStrategy": "first",
          "kind": "location"
        },
        "required": true
      },
      "$championFaction": {
        "select": {
          "from": {
            "relatedTo": "$target",
            "relationship": "member_of",
            "direction": "src"
          },
          "pickStrategy": "first",
          "kind": "faction"
        },
        "required": true
      },
      "$factionMember1": {
        "select": {
          "from": {
            "relatedTo": "$championFaction",
            "relationship": "member_of",
            "direction": "dst"
          },
          "filters": [
            {
              "type": "exclude",
              "entities": [
                "$target"
              ]
            }
          ],
          "pickStrategy": "random"
        },
        "required": true
      },
      "$existingIdeology": {
        "select": {
          "from": "graph",
          "kind": "rules",
          "pickStrategy": "random",
          "subtypes": [
            "ideology"
          ]
        }
      }
    },
    "enabled": true
  },
  {
    "id": "thermal_colony_decline",
    "name": "Colony Thermal Decline",
    "applicability": [],
    "selection": {
      "strategy": "by_kind",
      "kind": "location",
      "subtypes": [
        "colony"
      ],
      "statusFilter": "thriving",
      "filters": [
        {
          "type": "has_tag",
          "tag": "influential"
        }
      ],
      "pickStrategy": "random"
    },
    "creation": [],
    "relationships": [],
    "stateUpdates": [
      {
        "type": "change_status",
        "entity": "$target",
        "newStatus": "waning"
      },
      {
        "type": "set_tag",
        "entity": "$target",
        "tag": "stressed",
        "value": true
      },
      {
        "type": "remove_tag",
        "entity": "$target",
        "tag": "thriving"
      }
    ],
    "enabled": false
  },
  {
    "id": "thermal_colony_recovery",
    "name": "Colony Thermal Recovery",
    "applicability": [],
    "selection": {
      "strategy": "by_kind",
      "kind": "location",
      "subtypes": [
        "colony"
      ],
      "statusFilter": "waning",
      "filters": [
        {
          "type": "has_tag",
          "tag": "safe"
        }
      ],
      "pickStrategy": "random"
    },
    "creation": [],
    "relationships": [],
    "stateUpdates": [
      {
        "type": "change_status",
        "entity": "$target",
        "newStatus": "thriving"
      },
      {
        "type": "set_tag",
        "entity": "$target",
        "tag": "thriving",
        "value": true
      },
      {
        "type": "remove_tag",
        "entity": "$target",
        "tag": "stressed"
      }
    ],
    "enabled": false
  },
  {
    "id": "thermal_migration",
    "name": "Thermal Migration",
    "applicability": [],
    "selection": {
      "strategy": "by_kind",
      "kind": "location",
      "filters": [
        {
          "type": "has_any_tag",
          "tags": [
            "fire",
            "ice"
          ]
        }
      ],
      "pickStrategy": "random"
    },
    "variables": {
      "$migrant": {
        "select": {
          "from": {
            "relatedTo": "$target",
            "relationship": "resident_of",
            "direction": "dst"
          },
          "kind": "npc",
          "statusFilter": "alive",
          "pickStrategy": "random"
        }
      },
      "$refuge": {
        "select": {
          "kind": "location",
          "filters": [
            {
              "type": "has_tag",
              "tag": "safe"
            },
            {
              "type": "exclude",
              "entities": [
                "$target"
              ]
            }
          ],
          "pickStrategy": "random"
        }
      }
    },
    "creation": [],
    "relationships": [
      {
        "kind": "resident_of",
        "src": "$migrant",
        "dst": "$refuge",
        "strength": 0.7,
        "condition": {
          "type": "random_chance",
          "chance": 0.5
        }
      }
    ],
    "stateUpdates": [
      {
        "type": "set_tag",
        "entity": "$migrant",
        "tag": "emergent",
        "value": true
      }
    ],
    "enabled": false
  },
  {
    "id": "ice_memory_thaw",
    "name": "Ice Memory Thaw",
    "applicability": [],
    "selection": {
      "strategy": "by_kind",
      "kind": "location",
      "filters": [
        {
          "type": "has_tag",
          "tag": "hidden"
        }
      ],
      "pickStrategy": "random"
    },
    "variables": {
      "$frozen_ability": {
        "select": {
          "kind": "abilities",
          "statusFilter": "active",
          "filters": [
            {
              "type": "lacks_relationship",
              "kind": "manifests_at",
              "with": "$target"
            }
          ],
          "pickStrategy": "random"
        }
      }
    },
    "creation": [],
    "relationships": [
      {
        "kind": "manifests_at",
        "src": "$frozen_ability",
        "dst": "$target",
        "strength": 0.6,
        "condition": {
          "type": "random_chance",
          "chance": 0.1
        }
      }
    ],
    "stateUpdates": [
      {
        "type": "set_tag",
        "entity": "$target",
        "tag": "discovered",
        "value": true
      },
      {
        "type": "remove_tag",
        "entity": "$target",
        "tag": "hidden"
      }
    ],
    "enabled": false
  },
  {
    "id": "economic_colony_decline",
    "name": "Colony Economic Decline",
    "applicability": [],
    "selection": {
      "strategy": "by_kind",
      "kind": "location",
      "subtypes": [
        "colony"
      ],
      "statusFilter": "thriving",
      "filters": [
        {
          "type": "has_tag",
          "tag": "dangerous"
        }
      ],
      "pickStrategy": "random"
    },
    "creation": [],
    "relationships": [],
    "stateUpdates": [
      {
        "type": "change_status",
        "entity": "$target",
        "newStatus": "waning"
      },
      {
        "type": "set_tag",
        "entity": "$target",
        "tag": "stressed",
        "value": true
      },
      {
        "type": "remove_tag",
        "entity": "$target",
        "tag": "thriving"
      }
    ],
    "enabled": false
  },
  {
    "id": "economic_colony_recovery",
    "name": "Colony Economic Recovery",
    "applicability": [],
    "selection": {
      "strategy": "by_kind",
      "kind": "location",
      "subtypes": [
        "colony"
      ],
      "statusFilter": "waning",
      "filters": [
        {
          "type": "has_any_tag",
          "tags": [
            "trade",
            "resource"
          ]
        }
      ],
      "pickStrategy": "random"
    },
    "creation": [],
    "relationships": [],
    "stateUpdates": [
      {
        "type": "change_status",
        "entity": "$target",
        "newStatus": "thriving"
      },
      {
        "type": "set_tag",
        "entity": "$target",
        "tag": "thriving",
        "value": true
      },
      {
        "type": "remove_tag",
        "entity": "$target",
        "tag": "stressed"
      }
    ],
    "enabled": false
  },
  {
    "id": "wild_magic_discover",
    "name": "Wild Magical Discovery",
    "applicability": [
      {
        "type": "pressure",
        "pressureId": "magical_stability",
        "min": -100,
        "max": -50
      },
      {
        "type": "entity_count",
        "kind": "abilities",
        "subtype": "magic",
        "max": 15
      }
    ],
    "selection": {
      "strategy": "by_kind",
      "kind": "location",
      "subtypes": [
        "anomaly"
      ],
      "pickStrategy": "random",
      "filters": [
        {
          "type": "graph_path",
          "assert": {
            "check": "count_max",
            "path": [
              {
                "via": "manifests_at",
                "direction": "any",
                "targetKind": "abilities",
                "targetSubtype": "any"
              }
            ],
            "count": 2
          }
        }
      ]
    },
    "creation": [
      {
        "entityRef": "$magic",
        "kind": "abilities",
        "subtype": "magic",
        "status": "secret",
        "prominence": "recognized",
        "culture": {
          "inherit": "$target"
        },
        "description": {
          "template": "Mystical ability discovered by {heroName}",
          "replacements": {
            "heroName": "$target.name"
          }
        },
        "tags": {
          "mystical": true,
          "wild": true
        },
        "placement": {
          "anchor": {
            "type": "sparse",
            "preferPeriphery": true
          },
          "spacing": {},
          "regionPolicy": {
            "allowEmergent": true,
            "createRegion": true
          },
          "steps": [
            "sparse",
            "random"
          ]
        }
      }
    ],
    "relationships": [
      {
        "kind": "manifests_at",
        "src": "$magic",
        "dst": "$target",
        "strength": 0.8
      },
      {
        "kind": "practitioner_of",
        "src": "$discoverer",
        "dst": "$magic",
        "strength": 0.8,
        "bidirectional": false
      }
    ],
    "stateUpdates": [
      {
        "type": "modify_pressure",
        "pressureId": "magical_stability",
        "delta": 15
      }
    ],
    "variables": {
      "$discoverer": {
        "select": {
          "from": "graph",
          "kind": "npc",
          "pickStrategy": "random",
          "subtypes": [
            "hero",
            "merchant"
          ]
        },
        "required": true
      }
    },
    "enabled": true
  }
]
