[
  {
    "systemType": "thresholdTrigger",
    "config": {
      "description": "Abilities without practitioners gradually lose prominence",
      "clusterMode": "individual",
      "throttleChance": 0.2,
      "selection": {
        "strategy": "by_kind",
        "kind": "ability",
        "statuses": [
          "active",
          "discovered",
          "emergent"
        ]
      },
      "conditions": [
        {
          "type": "relationship_count",
          "relationshipKind": "practitioner_of",
          "direction": "dst",
          "max": 0
        },
        {
          "type": "time_elapsed",
          "minTicks": 25,
          "since": "created"
        },
        {
          "type": "random_chance",
          "chance": 0.35
        }
      ],
      "actions": [
        {
          "type": "adjust_prominence",
          "entity": "$self",
          "delta": -0.15
        }
      ],
      "id": "ability_fade",
      "name": "Ability Fade"
    },
    "enabled": true
  },
  {
    "systemType": "thresholdTrigger",
    "config": {
      "description": "When an allied faction is at war, allies consider joining the fight to honor their pact",
      "variables": {
        "$ally": {
          "required": true,
          "select": {
            "from": {
              "relatedTo": "$self",
              "relationshipKind": "allied_with",
              "direction": "both"
            },
            "kind": "faction",
            "pickStrategy": "random",
            "filters": [
              {
                "type": "graph_path",
                "assert": {
                  "check": "exists",
                  "path": [
                    {
                      "via": "participant_in",
                      "direction": "out",
                      "targetKind": "occurrence",
                      "targetSubtype": "war",
                      "targetStatus": "active"
                    }
                  ]
                }
              }
            ]
          }
        },
        "$war": {
          "required": true,
          "select": {
            "from": {
              "relatedTo": "$ally",
              "relationshipKind": "participant_in",
              "direction": "out"
            },
            "kind": "occurrence",
            "subtypes": [
              "war"
            ],
            "pickStrategy": "random",
            "status": "active"
          }
        }
      },
      "clusterMode": "individual",
      "throttleChance": 0.4,
      "selection": {
        "strategy": "by_kind",
        "kind": "faction",
        "status": "active"
      },
      "conditions": [
        {
          "type": "relationship_exists",
          "relationshipKind": "allied_with",
          "direction": "both"
        },
        {
          "type": "graph_path",
          "assert": {
            "check": "not_exists",
            "path": [
              {
                "via": "participant_in",
                "direction": "out",
                "targetKind": "occurrence",
                "targetSubtype": "war",
                "targetStatus": "active"
              }
            ]
          }
        },
        {
          "type": "graph_path",
          "assert": {
            "check": "exists",
            "path": [
              {
                "via": "allied_with",
                "direction": "any",
                "targetKind": "faction",
                "targetSubtype": "any"
              },
              {
                "via": "participant_in",
                "direction": "out",
                "targetKind": "occurrence",
                "targetSubtype": "war",
                "targetStatus": "active"
              }
            ]
          }
        },
        {
          "type": "random_chance",
          "chance": 0.25
        }
      ],
      "actions": [
        {
          "type": "create_relationship",
          "kind": "participant_in",
          "src": "$self",
          "dst": "$war",
          "strength": 0.7
        },
        {
          "type": "set_tag",
          "entity": "$self",
          "tag": "honor_bound",
          "value": true
        },
        {
          "type": "set_tag",
          "entity": "$self",
          "tag": "conflict",
          "value": true
        },
        {
          "type": "adjust_prominence",
          "entity": "$self",
          "delta": 0.25
        }
      ],
      "pressureChanges": {
        "harmony": -3
      },
      "id": "alliance_defense_call",
      "name": "Alliance Defense Call"
    },
    "enabled": true
  },
  {
    "systemType": "thresholdTrigger",
    "config": {
      "description": "Oath breakers eventually lose their alliances as trust erodes completely",
      "variables": {
        "$former_ally": {
          "required": true,
          "select": {
            "from": {
              "relatedTo": "$self",
              "relationshipKind": "allied_with",
              "direction": "both"
            },
            "kind": "faction",
            "pickStrategy": "random"
          }
        }
      },
      "clusterMode": "individual",
      "throttleChance": 0.4,
      "selection": {
        "strategy": "by_kind",
        "kind": "faction",
        "status": "active"
      },
      "conditions": [
        {
          "type": "tag_exists",
          "tag": "oath_breaker"
        },
        {
          "type": "relationship_exists",
          "relationshipKind": "allied_with",
          "direction": "both"
        },
        {
          "type": "time_elapsed",
          "minTicks": 3,
          "since": "created"
        },
        {
          "type": "random_chance",
          "chance": 0.4
        }
      ],
      "actions": [
        {
          "type": "archive_relationship",
          "entity": "$self",
          "relationshipKind": "allied_with",
          "with": "$former_ally"
        },
        {
          "type": "create_relationship",
          "kind": "enemy_of",
          "src": "$self",
          "dst": "$former_ally",
          "strength": 0.6,
          "bidirectional": true
        },
        {
          "type": "set_tag",
          "entity": "$self",
          "tag": "former_ally",
          "value": true
        },
        {
          "type": "set_tag",
          "entity": "$former_ally",
          "tag": "former_ally",
          "value": true
        },
        {
          "type": "remove_tag",
          "entity": "$self",
          "tag": "honor_bound"
        }
      ],
      "pressureChanges": {
        "harmony": -5
      },
      "id": "alliance_dissolution",
      "name": "Alliance Dissolution"
    },
    "enabled": true
  },
  {
    "systemType": "connectionEvolution",
    "config": {
      "description": "Factions practicing the same abilities may form alliances",
      "metric": {
        "type": "shared_relationship",
        "sharedRelationshipKind": "practitioner_of",
        "sharedDirection": "src"
      },
      "pairExcludeRelationships": [
        "enemy_of",
        "betrayed_by"
      ],
      "pairComponentSizeLimit": {
        "relationshipKinds": [
          "allied_with"
        ],
        "max": 6
      },
      "throttleChance": 0.15,
      "selection": {
        "strategy": "by_kind",
        "kind": "faction"
      },
      "rules": [
        {
          "condition": {
            "operator": ">=",
            "threshold": 1
          },
          "probability": 0.3,
          "betweenMatching": true,
          "action": {
            "type": "create_relationship",
            "kind": "allied_with",
            "src": "$member",
            "dst": "$member2",
            "strength": 0.5,
            "bidirectional": true
          }
        }
      ],
      "pressureChanges": {
        "harmony": 5
      },
      "id": "alliance_formation",
      "name": "Alliance Formation"
    },
    "enabled": true
  },
  {
    "systemType": "thresholdTrigger",
    "config": {
      "description": "When multiple adjacent anomalies resonate without NPC interference, one surges to an active state capable of crystallizing power.",
      "clusterMode": "individual",
      "throttleChance": 0.4,
      "selection": {
        "strategy": "by_kind",
        "kind": "location",
        "filters": [
          {
            "type": "has_tag",
            "tag": "anomaly"
          },
          {
            "type": "has_tag",
            "tag": "mystical"
          },
          {
            "type": "lacks_tag",
            "tag": "active"
          },
          {
            "type": "lacks_tag",
            "tag": "depleted"
          }
        ]
      },
      "conditions": [
        {
          "type": "graph_path",
          "assert": {
            "check": "count_min",
            "path": [
              {
                "via": [
                  "adjacent_to",
                  "contained_by",
                  "contains"
                ],
                "direction": "any",
                "targetKind": "location",
                "targetSubtype": "any",
                "filters": [
                  {
                    "type": "has_tag",
                    "tag": "anomaly"
                  }
                ]
              }
            ],
            "count": 1
          }
        },
        {
          "type": "graph_path",
          "assert": {
            "check": "count_max",
            "path": [
              {
                "via": [
                  "adjacent_to",
                  "contained_by",
                  "contains"
                ],
                "direction": "any",
                "targetKind": "location",
                "targetSubtype": "any"
              },
              {
                "via": "resident_of",
                "direction": "in",
                "targetKind": "npc",
                "targetSubtype": "any"
              }
            ],
            "count": 0
          }
        },
        {
          "type": "random_chance",
          "chance": 0.2
        }
      ],
      "actions": [
        {
          "type": "set_tag",
          "entity": "$self",
          "tag": "active",
          "value": true
        },
        {
          "type": "adjust_prominence",
          "entity": "$self",
          "delta": 0.3
        }
      ],
      "pressureChanges": {
        "magical_stability": -5
      },
      "id": "anomaly_activation",
      "name": "Anomaly Surges"
    },
    "enabled": true
  },
  {
    "systemType": "connectionEvolution",
    "config": {
      "description": "Anomalous locations gain mystical qualities over time. NPCs residing nearby dampen this effect through their stabilizing presence.",
      "metric": {
        "type": "neighbor_kind_count",
        "kind": "npc",
        "via": [
          "adjacent_to",
          "contained_by",
          "contains"
        ],
        "viaDirection": "both",
        "then": "resident_of",
        "thenDirection": "dst"
      },
      "throttleChance": 0.3,
      "selection": {
        "strategy": "by_kind",
        "kind": "location",
        "filters": [
          {
            "type": "has_tag",
            "tag": "anomaly"
          },
          {
            "type": "lacks_tag",
            "tag": "mystical"
          }
        ]
      },
      "rules": [
        {
          "condition": {
            "operator": "<=",
            "threshold": 0
          },
          "probability": 0.5,
          "action": {
            "type": "set_tag",
            "entity": "$self",
            "tag": "mystical",
            "value": true
          }
        },
        {
          "condition": {
            "operator": ">=",
            "threshold": 1
          },
          "probability": 0.25,
          "action": {
            "type": "set_tag",
            "entity": "$self",
            "tag": "mystical",
            "value": true
          }
        }
      ],
      "pressureChanges": {
        "magical_stability": -2
      },
      "id": "anomaly_mystical_gain",
      "name": "Anomaly Stirs"
    },
    "enabled": true
  },
  {
    "systemType": "thresholdTrigger",
    "config": {
      "description": "Heroes who own weapons are tagged as armed, enabling them to hunt orcas",
      "clusterMode": "individual",
      "throttleChance": 0.1,
      "selection": {
        "strategy": "by_kind",
        "kind": "npc",
        "subtypes": [
          "hero"
        ],
        "status": "alive",
        "filters": [
          {
            "type": "lacks_tag",
            "tag": "armed"
          }
        ]
      },
      "conditions": [
        {
          "type": "graph_path",
          "assert": {
            "check": "exists",
            "path": [
              {
                "via": "owned_by",
                "direction": "in",
                "targetKind": "artifact",
                "targetSubtype": "weapon"
              }
            ]
          }
        }
      ],
      "actions": [
        {
          "type": "set_tag",
          "entity": "$self",
          "tag": "armed",
          "value": true
        },
        {
          "type": "adjust_prominence",
          "entity": "$self",
          "delta": 0.3
        }
      ],
      "id": "armed_hero_detector",
      "name": "Armed Hero Detection"
    },
    "enabled": true
  },
  {
    "systemType": "graphContagion",
    "config": {
      "description": "Cursed or corrupted artifacts affect their owners",
      "contagion": {
        "type": "tag",
        "tag": "corrupted"
      },
      "transmission": {
        "baseRate": 0.15,
        "contactMultiplier": 0.1,
        "maxProbability": 0.5
      },
      "infectionAction": {
        "type": "set_tag",
        "entity": "$target",
        "tag": "corrupted",
        "value": true
      },
      "throttleChance": 0.5,
      "cooldown": 10,
      "selection": {
        "strategy": "by_kind",
        "kind": "artifact",
        "filters": [
          {
            "type": "has_tag",
            "tag": "corrupted"
          }
        ]
      },
      "vectors": [
        {
          "relationshipKind": "owned_by",
          "direction": "src",
          "minStrength": 0.3
        }
      ],
      "id": "artifact_corruption_spread",
      "name": "Artifact Corruption"
    },
    "enabled": true
  },
  {
    "systemType": "thresholdTrigger",
    "config": {
      "description": "Over time, artifacts may become damaged",
      "clusterMode": "individual",
      "throttleChance": 0.6,
      "selection": {
        "strategy": "by_kind",
        "kind": "artifact",
        "status": "intact"
      },
      "conditions": [
        {
          "type": "time_elapsed",
          "minTicks": 40
        },
        {
          "type": "random_chance",
          "chance": 0.1
        }
      ],
      "actions": [
        {
          "type": "change_status",
          "entity": "$self",
          "newStatus": "damaged"
        }
      ],
      "id": "artifact_degradation",
      "name": "Artifact Degradation"
    },
    "enabled": true
  },
  {
    "systemType": "thresholdTrigger",
    "config": {
      "description": "Damaged artifacts may be destroyed over time",
      "clusterMode": "individual",
      "throttleChance": 0.7,
      "selection": {
        "strategy": "by_kind",
        "kind": "artifact",
        "status": "damaged"
      },
      "conditions": [
        {
          "type": "time_elapsed",
          "minTicks": 20
        },
        {
          "type": "random_chance",
          "chance": 0.15
        }
      ],
      "actions": [
        {
          "type": "change_status",
          "entity": "$self",
          "newStatus": "destroyed"
        }
      ],
      "id": "artifact_destruction",
      "name": "Artifact Destruction"
    },
    "enabled": true
  },
  {
    "systemType": "graphContagion",
    "config": {
      "description": "Models ideological spread through social networks using SIR epidemic model",
      "contagion": {
        "type": "relationship",
        "relationshipKind": "believer_of"
      },
      "transmission": {
        "baseRate": 0.25,
        "contactMultiplier": 0.1,
        "maxProbability": 0.95
      },
      "infectionAction": {
        "type": "create_relationship",
        "kind": "believer_of",
        "src": "$self",
        "dst": "$contagion_source",
        "strength": 0.5
      },
      "recovery": {
        "baseRate": 0.02,
        "recoveryBonusTraits": [
          {
            "tag": "organized",
            "bonus": 0.12
          },
          {
            "tag": "leader",
            "bonus": 0.12
          }
        ]
      },
      "multiSource": {
        "immunityTagPrefix": "immune",
        "lowAdoptionThreshold": 0.05,
        "lowAdoptionStatus": "contested",
        "sourceSelection": {
          "strategy": "by_kind",
          "kind": "rule",
          "status": "proposed"
        }
      },
      "selection": {
        "strategy": "by_kind",
        "kind": "faction"
      },
      "vectors": [
        {
          "relationshipKind": "believer_of",
          "direction": "both",
          "minStrength": 0.3
        },
        {
          "relationshipKind": "allied_with",
          "direction": "both",
          "minStrength": 0.3
        },
        {
          "relationshipKind": "trades_with",
          "direction": "both",
          "minStrength": 0.3
        },
        {
          "relationshipKind": "at_war_with",
          "direction": "both",
          "minStrength": 0.3
        },
        {
          "relationshipKind": "splinter_of",
          "direction": "both",
          "minStrength": 0.3
        }
      ],
      "susceptibilityModifiers": [
        {
          "tag": "follower",
          "modifier": 0.3
        },
        {
          "tag": "mystical",
          "modifier": 0.2
        },
        {
          "tag": "organized",
          "modifier": -0.2
        },
        {
          "tag": "leader",
          "modifier": -0.2
        }
      ],
      "phaseTransitions": [
        {
          "toStatus": "enacted",
          "adoptionThreshold": 0.2,
          "descriptionSuffix": "This belief has spread widely and is now established tradition.",
          "selection": {
            "strategy": "by_kind",
            "kind": "rule",
            "status": "proposed"
          }
        }
      ],
      "id": "belief_contagion",
      "name": "Ideological Spread"
    },
    "enabled": true
  },
  {
    "systemType": "thresholdTrigger",
    "config": {
      "description": "Cleansed locations without nearby sanctified neighbors lose their protection as the wards weaken",
      "clusterMode": "individual",
      "throttleChance": 0.3,
      "selection": {
        "strategy": "by_kind",
        "kind": "location",
        "filters": [
          {
            "type": "has_tag",
            "tag": "cleansed"
          }
        ]
      },
      "conditions": [
        {
          "type": "graph_path",
          "assert": {
            "check": "count_max",
            "path": [
              {
                "via": "adjacent_to",
                "direction": "any",
                "targetKind": "location",
                "targetSubtype": "any",
                "filters": [
                  {
                    "type": "has_tag",
                    "tag": "cleansed"
                  }
                ]
              }
            ],
            "count": 0
          }
        }
      ],
      "actions": [
        {
          "type": "remove_tag",
          "entity": "$self",
          "tag": "cleansed"
        },
        {
          "type": "modify_pressure",
          "pressureId": "magical_stability",
          "delta": -2
        }
      ],
      "id": "cleansed_isolation_decay",
      "name": "Sacred Ground Fades"
    },
    "enabled": true
  },
  {
    "systemType": "clusterFormation",
    "config": {
      "description": "Clusters combat abilities into unified fighting styles. Only top practitioners by prominence become 'masters' with direct links to the meta-ability.",
      "runAtEpochEnd": true,
      "clustering": {
        "minSize": 5,
        "maxSize": 8,
        "minimumScore": 5,
        "criteria": [
          {
            "type": "shared_relationship",
            "weight": 5,
            "relationshipKind": "practitioner_of",
            "direction": "dst"
          },
          {
            "type": "same_culture",
            "weight": 4
          },
          {
            "type": "shared_tags",
            "weight": 2,
            "threshold": 0.3
          },
          {
            "type": "temporal_proximity",
            "weight": 1.5,
            "threshold": 50
          }
        ]
      },
      "metaEntity": {
        "kind": "ability",
        "subtypeFromMajority": true,
        "status": "active",
        "prominenceFromSize": {
          "marginal": 3,
          "recognized": 4,
          "renowned": 6,
          "mythic": 9
        },
        "additionalTags": [
          "combat-style"
        ],
        "descriptionTemplate": "A unified combat tradition encompassing {names}. Mastered by warriors who practice {count} techniques in harmony."
      },
      "masterSelection": {
        "pickStrategy": "weighted",
        "maxResults": 2,
        "filters": [
          {
            "type": "matches_culture",
            "with": "$meta"
          }
        ]
      },
      "memberUpdates": [
        {
          "type": "change_status",
          "entity": "$member",
          "newStatus": "subsumed"
        }
      ],
      "postProcess": {
        "pressureChanges": {
          "security": 2
        }
      },
      "selection": {
        "strategy": "by_kind",
        "kind": "ability",
        "subtypes": [
          "combat"
        ],
        "filters": [
          {
            "type": "lacks_tag",
            "tag": "meta-entity"
          }
        ]
      },
      "id": "combat_technique_formation",
      "name": "Combat Technique Formation"
    },
    "enabled": true
  },
  {
    "systemType": "graphContagion",
    "config": {
      "description": "Spreads conflicts through alliance networks - allies of enemies become enemies (but not between allies)",
      "contagion": {
        "type": "relationship",
        "relationshipKind": "at_war_with"
      },
      "transmission": {
        "baseRate": 0.25,
        "contactMultiplier": 0.1,
        "maxProbability": 0.7
      },
      "infectionAction": {
        "type": "create_relationship",
        "kind": "at_war_with",
        "src": "$self",
        "dst": "$source",
        "strength": 0.4,
        "bidirectional": true
      },
      "excludeRelationships": [
        "allied_with"
      ],
      "throttleChance": 0.1,
      "cooldown": 4,
      "selection": {
        "strategy": "by_kind",
        "kind": "faction"
      },
      "vectors": [
        {
          "relationshipKind": "allied_with",
          "direction": "both",
          "minStrength": 0.3
        },
        {
          "relationshipKind": "splinter_of",
          "direction": "both",
          "minStrength": 0.3
        }
      ],
      "pressureChanges": {
        "harmony": -3
      },
      "id": "conflict_contagion",
      "name": "Conflict Spread"
    },
    "enabled": false,
    "_disabled_reason": "at_war_with eliminated. War participation determined by participant_in to war occurrence."
  },
  {
    "systemType": "thresholdTrigger",
    "config": {
      "description": "When a faction's control over a location weakens below threshold, they lose control entirely",
      "variables": {
        "$weak_territory": {
          "required": true,
          "select": {
            "from": {
              "relatedTo": "$self",
              "relationshipKind": "controls",
              "direction": "src"
            },
            "kind": "location",
            "pickStrategy": "random"
          }
        }
      },
      "clusterMode": "individual",
      "throttleChance": 0.5,
      "selection": {
        "strategy": "by_kind",
        "kind": "faction",
        "status": "active"
      },
      "conditions": [
        {
          "type": "relationship_count",
          "relationshipKind": "controls",
          "direction": "src",
          "min": 1
        },
        {
          "type": "random_chance",
          "chance": 0.25
        }
      ],
      "actions": [
        {
          "type": "archive_relationship",
          "entity": "$self",
          "relationshipKind": "controls",
          "with": "$weak_territory"
        },
        {
          "type": "set_tag",
          "entity": "$weak_territory",
          "tag": "contested",
          "value": true
        },
        {
          "type": "set_tag",
          "entity": "$weak_territory",
          "tag": "crisis",
          "value": true
        },
        {
          "type": "adjust_prominence",
          "entity": "$self",
          "delta": -0.25
        }
      ],
      "pressureChanges": {
        "security": -3
      },
      "id": "control_collapse",
      "name": "Control Collapse"
    },
    "enabled": true
  },
  {
    "systemType": "thresholdTrigger",
    "config": {
      "description": "Severely corrupted locations trigger a crisis that kills inhabitants and spreads fear",
      "clusterMode": "individual",
      "throttleChance": 0.15,
      "selection": {
        "strategy": "by_kind",
        "kind": "location",
        "filters": [
          {
            "type": "has_tag",
            "tag": "corrupted"
          },
          {
            "type": "lacks_tag",
            "tag": "crisis"
          }
        ]
      },
      "conditions": [
        {
          "type": "tag_exists",
          "tag": "corrupted"
        },
        {
          "type": "graph_path",
          "assert": {
            "check": "count_min",
            "path": [
              {
                "via": "occupies",
                "direction": "in",
                "targetKind": "npc",
                "targetSubtype": "any",
                "targetStatus": "alive"
              }
            ],
            "count": 2
          }
        }
      ],
      "actions": [
        {
          "type": "set_tag",
          "entity": "$self",
          "tag": "crisis",
          "value": true
        },
        {
          "type": "modify_pressure",
          "pressureId": "security",
          "delta": -10
        },
        {
          "type": "modify_pressure",
          "pressureId": "magical_stability",
          "delta": -5
        }
      ],
      "id": "corruption_crisis",
      "name": "Corruption Crisis"
    },
    "enabled": true
  },
  {
    "systemType": "thresholdTrigger",
    "config": {
      "description": "NPCs residing in corrupted locations are harmed by the corruption - first corrupted, then killed",
      "variables": {
        "$home": {
          "required": true,
          "select": {
            "from": {
              "relatedTo": "$self",
              "relationshipKind": "resident_of",
              "direction": "src"
            },
            "kind": "location",
            "filters": [
              {
                "type": "has_tag",
                "tag": "corrupted"
              }
            ]
          }
        }
      },
      "clusterMode": "individual",
      "throttleChance": 0.5,
      "selection": {
        "strategy": "by_kind",
        "kind": "npc",
        "status": "alive"
      },
      "conditions": [
        {
          "type": "graph_path",
          "assert": {
            "check": "exists",
            "path": [
              {
                "via": "resident_of",
                "direction": "out",
                "targetKind": "location",
                "targetSubtype": "any"
              }
            ]
          }
        },
        {
          "type": "random_chance",
          "chance": 0.08
        }
      ],
      "actions": [
        {
          "type": "conditional",
          "condition": {
            "type": "tag_exists",
            "tag": "cursed"
          },
          "thenActions": [
            {
              "type": "change_status",
              "entity": "$self",
              "newStatus": "historical"
            }
          ],
          "elseActions": [
            {
              "type": "conditional",
              "condition": {
                "type": "tag_exists",
                "tag": "corrupted"
              },
              "thenActions": [
                {
                  "type": "set_tag",
                  "entity": "$self",
                  "tag": "cursed",
                  "value": true
                },
                {
                  "type": "archive_all_relationships",
                  "entity": "$self",
                  "relationshipKind": "owned_by",
                  "direction": "dst"
                }
              ],
              "elseActions": [
                {
                  "type": "set_tag",
                  "entity": "$self",
                  "tag": "corrupted",
                  "value": true
                }
              ]
            }
          ]
        }
      ],
      "pressureChanges": {
        "magical_stability": -2
      },
      "id": "corruption_harm",
      "name": "Corruption Harm"
    },
    "enabled": true
  },
  {
    "systemType": "tagDiffusion",
    "config": {
      "description": "Connected colonies become more similar (trade, friendly), isolated colonies diverge (secretive, hidden)",
      "connectionKind": "adjacent_to",
      "connectionDirection": "both",
      "convergence": {
        "tags": [
          "trade",
          "friendly",
          "central",
          "organized",
          "resource",
          "thriving"
        ],
        "minConnections": 1,
        "probability": 0.3,
        "maxSharedTags": 2
      },
      "divergence": {
        "tags": [
          "hidden",
          "secretive",
          "mystical"
        ],
        "maxConnections": 0,
        "probability": 0.3
      },
      "maxTags": 10,
      "divergencePressure": {
        "pressureName": "harmony",
        "minDivergent": 2,
        "delta": -10
      },
      "selection": {
        "strategy": "by_kind",
        "kind": "location",
        "subtypes": [
          "colony"
        ]
      },
      "id": "cultural_drift",
      "name": "Cultural Evolution"
    },
    "enabled": true
  },
  {
    "systemType": "thresholdTrigger",
    "config": {
      "description": "Depleted anomalies slowly recover their potential over time.",
      "clusterMode": "individual",
      "throttleChance": 0.5,
      "selection": {
        "strategy": "by_kind",
        "kind": "location",
        "filters": [
          {
            "type": "has_tag",
            "tag": "depleted"
          }
        ]
      },
      "conditions": [
        {
          "type": "time_elapsed",
          "minTicks": 8,
          "since": "updated"
        },
        {
          "type": "random_chance",
          "chance": 0.25
        }
      ],
      "actions": [
        {
          "type": "remove_tag",
          "entity": "$self",
          "tag": "depleted"
        }
      ],
      "id": "depleted_recovery",
      "name": "Anomaly Recovers"
    },
    "enabled": true
  },
  {
    "systemType": "thresholdTrigger",
    "config": {
      "description": "Factions with strong belief relationships are marked as devout",
      "clusterMode": "individual",
      "throttleChance": 0.2,
      "selection": {
        "strategy": "by_kind",
        "kind": "faction",
        "status": "active"
      },
      "conditions": [
        {
          "type": "relationship_count",
          "relationshipKind": "believer_of",
          "direction": "src",
          "min": 1
        },
        {
          "type": "lacks_tag",
          "tag": "devout"
        }
      ],
      "actions": [
        {
          "type": "set_tag",
          "entity": "$self",
          "tag": "devout",
          "value": true
        },
        {
          "type": "adjust_prominence",
          "entity": "$self",
          "delta": 0.25
        }
      ],
      "id": "devout_believer_detector",
      "name": "Devout Believer Detection"
    },
    "enabled": true
  },
  {
    "systemType": "thresholdTrigger",
    "config": {
      "description": "If factions become enemies while allied, the alliance is broken",
      "clusterMode": "individual",
      "selection": {
        "strategy": "by_kind",
        "kind": "faction"
      },
      "conditions": [
        {
          "type": "relationship_exists",
          "relationshipKind": "allied_with",
          "direction": "both"
        },
        {
          "type": "relationship_exists",
          "relationshipKind": "enemy_of",
          "direction": "both"
        }
      ],
      "actions": [
        {
          "type": "for_each_related",
          "relationship": "enemy_of",
          "direction": "both",
          "actions": [
            {
              "type": "archive_relationship",
              "entity": "$self",
              "relationshipKind": "allied_with",
              "with": "$related"
            },
            {
              "type": "set_tag",
              "entity": "$self",
              "tag": "former_ally",
              "value": true
            },
            {
              "type": "set_tag",
              "entity": "$related",
              "tag": "former_ally",
              "value": true
            }
          ]
        }
      ],
      "pressureChanges": {
        "harmony": -3
      },
      "id": "enemy_alliance_breaker",
      "name": "Enemy Alliance Breaker"
    },
    "enabled": true
  },
  {
    "systemType": "connectionEvolution",
    "config": {
      "description": "Factions with no shared ideological practice develop enmity (worldview incompatibility)",
      "metric": {
        "type": "shared_relationship",
        "sharedRelationshipKind": "practitioner_of",
        "sharedDirection": "src"
      },
      "pairExcludeRelationships": [
        "enemy_of",
        "allied_with"
      ],
      "throttleChance": 0.1,
      "selection": {
        "strategy": "by_kind",
        "kind": "faction",
        "filters": [
          {
            "type": "lacks_tag",
            "tag": "post_war_cooldown"
          }
        ]
      },
      "rules": [
        {
          "condition": {
            "operator": "==",
            "threshold": 0
          },
          "probability": 0.08,
          "betweenMatching": true,
          "action": {
            "type": "create_relationship",
            "kind": "enemy_of",
            "src": "$self",
            "dst": "$partner",
            "strength": 0.5,
            "bidirectional": true
          }
        }
      ],
      "pressureChanges": {
        "harmony": -2
      },
      "id": "enmity_from_ideology",
      "name": "Ideological Divergence"
    },
    "enabled": true
  },
  {
    "systemType": "eraSpawner",
    "config": {
      "description": "Creates era entities at simulation start. Establishes the timeline structure with supersedes relationships between consecutive eras.",
      "ticksPerEra": 25,
      "id": "era_spawner",
      "name": "Era Initialization"
    },
    "enabled": true
  },
  {
    "systemType": "eraTransition",
    "config": {
      "description": "Handles transitions between eras based on world state and per-era exitConditions. Updates era status from future → current → historical.",
      "prominenceSnapshot": {
        "enabled": false,
        "minProminence": "renowned"
      },
      "id": "era_transition",
      "name": "Era Progression"
    },
    "enabled": true
  },
  {
    "systemType": "thresholdTrigger",
    "config": {
      "description": "Devout factions are more likely to declare war on factions with apostate or different beliefs",
      "variables": {
        "$heretic": {
          "required": true,
          "select": {
            "from": "graph",
            "kind": "faction",
            "pickStrategy": "random",
            "filters": [
              {
                "type": "has_tag",
                "tag": "apostate"
              },
              {
                "type": "lacks_relationship",
                "kind": "at_war_with",
                "with": "$self"
              },
              {
                "type": "lacks_relationship",
                "kind": "allied_with",
                "with": "$self"
              }
            ]
          }
        }
      },
      "clusterMode": "individual",
      "throttleChance": 0.5,
      "selection": {
        "strategy": "by_kind",
        "kind": "faction",
        "status": "active"
      },
      "conditions": [
        {
          "type": "tag_exists",
          "tag": "devout"
        },
        {
          "type": "relationship_count",
          "relationshipKind": "at_war_with",
          "direction": "both",
          "max": 0
        },
        {
          "type": "random_chance",
          "chance": 0.12
        }
      ],
      "actions": [
        {
          "type": "create_relationship",
          "kind": "at_war_with",
          "src": "$self",
          "dst": "$heretic",
          "strength": 0.7,
          "bidirectional": true
        },
        {
          "type": "set_tag",
          "entity": "$self",
          "tag": "conflict",
          "value": true
        },
        {
          "type": "set_tag",
          "entity": "$self",
          "tag": "religious_war",
          "value": true
        }
      ],
      "pressureChanges": {
        "harmony": -1
      },
      "id": "heresy_war_trigger",
      "name": "Heresy War"
    },
    "enabled": true
  },
  {
    "systemType": "thresholdTrigger",
    "config": {
      "description": "Heroes caught in wars occasionally fall, their weapons becoming legendary",
      "clusterMode": "individual",
      "throttleChance": 0.3,
      "selection": {
        "strategy": "by_kind",
        "kind": "npc",
        "subtypes": [
          "hero"
        ],
        "status": "alive"
      },
      "conditions": [
        {
          "type": "or",
          "conditions": [
            {
              "type": "graph_path",
              "assert": {
                "check": "exists",
                "path": [
                  {
                    "via": "member_of",
                    "direction": "out",
                    "targetKind": "faction",
                    "targetSubtype": "any"
                  },
                  {
                    "via": "participant_in",
                    "direction": "out",
                    "targetKind": "occurrence",
                    "targetSubtype": "war",
                    "targetStatus": "active"
                  }
                ]
              }
            },
            {
              "type": "graph_path",
              "assert": {
                "check": "exists",
                "path": [
                  {
                    "via": "leader_of",
                    "direction": "out",
                    "targetKind": "faction",
                    "targetSubtype": "any"
                  },
                  {
                    "via": "participant_in",
                    "direction": "out",
                    "targetKind": "occurrence",
                    "targetSubtype": "war",
                    "targetStatus": "active"
                  }
                ]
              }
            }
          ]
        },
        {
          "type": "random_chance",
          "chance": 0.04
        }
      ],
      "actions": [
        {
          "type": "change_status",
          "entity": "$self",
          "newStatus": "historical"
        },
        {
          "type": "for_each_related",
          "relationship": "owned_by",
          "direction": "in",
          "actions": [
            {
              "type": "set_tag",
              "entity": "$related",
              "tag": "legendary",
              "value": true
            },
            {
              "type": "set_tag",
              "entity": "$related",
              "tag": "hero_relic",
              "value": true
            },
            {
              "type": "adjust_prominence",
              "entity": "$related",
              "delta": 0.4
            }
          ],
          "targetKind": "artifact"
        }
      ],
      "id": "heroic_sacrifice",
      "name": "Heroic Sacrifice"
    },
    "enabled": true
  },
  {
    "systemType": "thresholdTrigger",
    "config": {
      "description": "The ice witnesses deeds at significant locations, annotating those present with echoes",
      "throttleChance": 0.3,
      "selection": {
        "strategy": "by_kind",
        "kind": "npc",
        "subtypes": [
          "hero",
          "merchant",
          "outlaw",
          "mayor",
          "orca"
        ],
        "status": "alive"
      },
      "conditions": [
        {
          "type": "graph_path",
          "assert": {
            "check": "exists",
            "path": [
              {
                "via": "resident_of",
                "direction": "out",
                "targetKind": "location",
                "targetSubtype": "any"
              }
            ]
          }
        },
        {
          "type": "prominence",
          "max": "marginal"
        }
      ],
      "actions": [
        {
          "type": "set_tag",
          "entity": "$self",
          "tag": "ice_witnessed",
          "value": true
        },
        {
          "type": "adjust_prominence",
          "entity": "$self",
          "delta": 0.2
        }
      ],
      "id": "ice_memory_witness",
      "name": "The Ice Remembers"
    },
    "enabled": true
  },
  {
    "systemType": "clusterFormation",
    "config": {
      "description": "Clusters rules into unified legal codes with governance factions",
      "runAtEpochEnd": true,
      "clustering": {
        "minSize": 5,
        "minimumScore": 5,
        "criteria": [
          {
            "type": "same_culture",
            "weight": 5
          },
          {
            "type": "temporal_proximity",
            "weight": 2,
            "threshold": 40
          }
        ]
      },
      "metaEntity": {
        "kind": "rule",
        "subtypeFromMajority": true,
        "status": "enacted",
        "prominenceFromSize": {
          "marginal": 4,
          "recognized": 5,
          "renowned": 7,
          "mythic": 10
        },
        "descriptionTemplate": "A unified legal system encompassing {names}. Codified from {count} related rules.",
        "additionalTags": []
      },
      "postProcess": {
        "createGovernanceFaction": true,
        "governanceFactionSubtype": "political",
        "governanceRelationship": "related_to",
        "pressureChanges": {
          "security": 5
        }
      },
      "selection": {
        "strategy": "by_kind",
        "kind": "rule",
        "subtypes": [
          "law"
        ]
      },
      "id": "legal_code_formation",
      "name": "Legal Code Formation"
    },
    "enabled": true
  },
  {
    "systemType": "clusterFormation",
    "config": {
      "description": "Clusters magic abilities into unified schools. Only top practitioners by prominence become 'masters' with direct links to the meta-ability.",
      "runAtEpochEnd": true,
      "clustering": {
        "minSize": 5,
        "maxSize": 8,
        "minimumScore": 5,
        "criteria": [
          {
            "type": "shared_relationship",
            "weight": 5,
            "relationshipKind": "practitioner_of",
            "direction": "dst"
          },
          {
            "type": "same_culture",
            "weight": 4
          },
          {
            "type": "shared_tags",
            "weight": 2,
            "threshold": 0.3
          },
          {
            "type": "temporal_proximity",
            "weight": 1.5,
            "threshold": 50
          }
        ]
      },
      "metaEntity": {
        "kind": "ability",
        "subtypeFromMajority": true,
        "status": "active",
        "prominenceFromSize": {
          "marginal": 3,
          "recognized": 4,
          "renowned": 6,
          "mythic": 9
        },
        "descriptionTemplate": "A unified tradition encompassing {names}. Formed from {count} related abilities practiced by multiple penguins.",
        "additionalTags": []
      },
      "masterSelection": {
        "pickStrategy": "weighted",
        "maxResults": 2,
        "filters": [
          {
            "type": "matches_culture",
            "with": "$meta"
          }
        ]
      },
      "memberUpdates": [
        {
          "type": "change_status",
          "entity": "$member",
          "newStatus": "subsumed"
        }
      ],
      "postProcess": {
        "pressureChanges": {
          "security": 2
        }
      },
      "selection": {
        "strategy": "by_kind",
        "kind": "ability",
        "subtypes": [
          "magic"
        ],
        "filters": [
          {
            "type": "lacks_tag",
            "tag": "meta-entity"
          }
        ]
      },
      "id": "magic_school_formation",
      "name": "Magic School Formation"
    },
    "enabled": true
  },
  {
    "systemType": "connectionEvolution",
    "config": {
      "description": "Trade-connected factions controlling thriving colonies gain influence",
      "metric": {
        "type": "connection_count",
        "relationshipKinds": [
          "controls"
        ],
        "direction": "src"
      },
      "throttleChance": 0.15,
      "selection": {
        "strategy": "by_kind",
        "kind": "faction",
        "subtypes": [
          "company"
        ]
      },
      "rules": [
        {
          "condition": {
            "operator": ">=",
            "threshold": 1
          },
          "probability": 0.7,
          "action": {
            "type": "adjust_prominence",
            "entity": "$self",
            "delta": 0.2
          }
        },
        {
          "condition": {
            "operator": "<=",
            "threshold": 0
          },
          "probability": 0.8,
          "action": {
            "type": "adjust_prominence",
            "entity": "$self",
            "delta": -0.15
          }
        }
      ],
      "id": "merchant_prosperity",
      "name": "Trade Network Growth"
    },
    "enabled": true
  },
  {
    "systemType": "connectionEvolution",
    "config": {
      "description": "Mystical qualities fade from locations over time. NPCs residing nearby dampen this effect, stabilizing the mystical energy.",
      "metric": {
        "type": "neighbor_kind_count",
        "kind": "npc",
        "via": [
          "adjacent_to",
          "contained_by",
          "contains"
        ],
        "viaDirection": "both",
        "then": "resident_of",
        "thenDirection": "dst"
      },
      "throttleChance": 0.3,
      "selection": {
        "strategy": "by_kind",
        "kind": "location",
        "filters": [
          {
            "type": "has_tag",
            "tag": "mystical"
          }
        ]
      },
      "rules": [
        {
          "condition": {
            "operator": "<=",
            "threshold": 0
          },
          "probability": 0.2,
          "action": {
            "type": "remove_tag",
            "entity": "$self",
            "tag": "mystical"
          }
        },
        {
          "condition": {
            "operator": ">=",
            "threshold": 1
          },
          "probability": 0.04,
          "action": {
            "type": "remove_tag",
            "entity": "$self",
            "tag": "mystical"
          }
        }
      ],
      "id": "mystical_decay",
      "name": "Mystical Fades"
    },
    "enabled": true
  },
  {
    "systemType": "thresholdTrigger",
    "config": {
      "description": "Oath breakers suffer ongoing reputation damage and weakened alliances",
      "clusterMode": "individual",
      "throttleChance": 0.4,
      "selection": {
        "strategy": "by_kind",
        "kind": "faction",
        "status": "active"
      },
      "conditions": [
        {
          "type": "tag_exists",
          "tag": "oath_breaker"
        },
        {
          "type": "time_elapsed",
          "minTicks": 5
        },
        {
          "type": "random_chance",
          "chance": 0.2
        }
      ],
      "actions": [
        {
          "type": "adjust_prominence",
          "entity": "$self",
          "delta": -0.15
        },
        {
          "type": "for_each_related",
          "relationship": "allied_with",
          "direction": "both",
          "actions": [
            {
              "type": "adjust_relationship_strength",
              "kind": "allied_with",
              "src": "$self",
              "dst": "$related",
              "delta": -0.15
            }
          ],
          "targetKind": "faction"
        }
      ],
      "id": "oath_breaker_consequences",
      "name": "Oath Breaker Consequences"
    },
    "enabled": true
  },
  {
    "systemType": "thresholdTrigger",
    "config": {
      "description": "Allied factions that don't join wars are marked as oath breakers and lose reputation",
      "clusterMode": "individual",
      "throttleChance": 0.5,
      "selection": {
        "strategy": "by_kind",
        "kind": "faction",
        "status": "active"
      },
      "conditions": [
        {
          "type": "relationship_exists",
          "relationshipKind": "allied_with",
          "direction": "both"
        },
        {
          "type": "lacks_tag",
          "tag": "honor_bound"
        },
        {
          "type": "lacks_tag",
          "tag": "oath_breaker"
        },
        {
          "type": "graph_path",
          "assert": {
            "check": "exists",
            "path": [
              {
                "via": "allied_with",
                "direction": "any",
                "targetKind": "faction",
                "targetSubtype": "any"
              },
              {
                "via": "participant_in",
                "direction": "out",
                "targetKind": "occurrence",
                "targetSubtype": "war",
                "targetStatus": "active"
              }
            ]
          }
        },
        {
          "type": "time_elapsed",
          "minTicks": 10
        },
        {
          "type": "random_chance",
          "chance": 0.15
        }
      ],
      "actions": [
        {
          "type": "set_tag",
          "entity": "$self",
          "tag": "oath_breaker",
          "value": true
        },
        {
          "type": "adjust_prominence",
          "entity": "$self",
          "delta": -0.25
        }
      ],
      "pressureChanges": {
        "harmony": -2
      },
      "id": "oath_breaker_detector",
      "name": "Oath Breaker Detection"
    },
    "enabled": true
  },
  {
    "systemType": "thresholdTrigger",
    "config": {
      "description": "Active events settle into history over time",
      "clusterMode": "individual",
      "throttleChance": 0.6,
      "selection": {
        "strategy": "by_kind",
        "kind": "occurrence",
        "status": "active",
        "excludeSubtypes": [
          "war"
        ]
      },
      "conditions": [
        {
          "type": "time_elapsed",
          "minTicks": 6,
          "since": "created"
        }
      ],
      "actions": [
        {
          "type": "change_status",
          "entity": "$self",
          "newStatus": "historical"
        }
      ],
      "pressureChanges": {
        "harmony": 2
      },
      "id": "occurrence_resolution",
      "name": "Occurrence Resolution"
    },
    "enabled": true
  },
  {
    "systemType": "thresholdTrigger",
    "config": {
      "description": "Aging NPCs occasionally pass away, their artifacts inherited or lost",
      "variables": {
        "$faction": {
          "select": {
            "from": {
              "relatedTo": "$self",
              "relationshipKind": "member_of",
              "direction": "src"
            },
            "kind": "faction",
            "pickStrategy": "random"
          }
        }
      },
      "clusterMode": "individual",
      "throttleChance": 0.25,
      "selection": {
        "strategy": "by_kind",
        "kind": "npc",
        "status": "alive"
      },
      "conditions": [
        {
          "type": "time_elapsed",
          "minTicks": 80,
          "since": "created"
        },
        {
          "type": "random_chance",
          "chance": 0.02
        }
      ],
      "actions": [
        {
          "type": "change_status",
          "entity": "$self",
          "newStatus": "historical"
        },
        {
          "type": "for_each_related",
          "relationship": "owned_by",
          "direction": "in",
          "actions": [
            {
              "type": "conditional",
              "condition": {
                "type": "random_chance",
                "chance": 0.6
              },
              "thenActions": [
                {
                  "type": "change_status",
                  "entity": "$related",
                  "newStatus": "lost"
                },
                {
                  "type": "archive_relationship",
                  "entity": "$related",
                  "relationshipKind": "owned_by",
                  "with": "$self"
                }
              ],
              "elseActions": [
                {
                  "type": "transfer_relationship",
                  "entity": "$related",
                  "relationshipKind": "owned_by",
                  "from": "$self",
                  "to": "$faction",
                  "condition": {
                    "type": "entity_exists",
                    "entity": "$faction"
                  }
                }
              ]
            }
          ],
          "targetKind": "artifact"
        }
      ],
      "id": "old_age_mortality",
      "name": "Old Age Mortality"
    },
    "enabled": true
  },
  {
    "systemType": "thresholdTrigger",
    "config": {
      "description": "Factions without active wars shed conflict and cooldown tags",
      "clusterMode": "individual",
      "throttleChance": 0.5,
      "selection": {
        "strategy": "by_kind",
        "kind": "faction",
        "filters": [
          {
            "type": "has_any_tag",
            "tags": [
              "conflict",
              "hostile",
              "post_war_cooldown"
            ]
          }
        ]
      },
      "conditions": [
        {
          "type": "graph_path",
          "assert": {
            "check": "not_exists",
            "path": [
              {
                "via": "participant_in",
                "direction": "out",
                "targetKind": "occurrence",
                "targetSubtype": "war",
                "targetStatus": "active"
              }
            ]
          }
        }
      ],
      "actions": [
        {
          "type": "remove_tag",
          "entity": "$self",
          "tag": "conflict"
        },
        {
          "type": "remove_tag",
          "entity": "$self",
          "tag": "hostile"
        },
        {
          "type": "remove_tag",
          "entity": "$self",
          "tag": "post_war_cooldown"
        }
      ],
      "pressureChanges": {
        "harmony": 3,
        "security": 2
      },
      "id": "post_war_recovery",
      "name": "Post-War Recovery"
    },
    "enabled": true
  },
  {
    "systemType": "thresholdTrigger",
    "config": {
      "description": "Detects factions with historical (deceased) leaders and marks them in crisis",
      "clusterMode": "individual",
      "throttleChance": 0.35,
      "selection": {
        "strategy": "by_kind",
        "kind": "faction",
        "filters": [
          {
            "type": "lacks_tag",
            "tag": "power_vacuum"
          }
        ]
      },
      "conditions": [
        {
          "type": "or",
          "conditions": [
            {
              "type": "relationship_exists",
              "relationshipKind": "leader_of",
              "direction": "dst",
              "targetKind": "npc",
              "targetStatus": "historical"
            },
            {
              "type": "relationship_count",
              "relationshipKind": "leader_of",
              "direction": "dst",
              "max": 0
            }
          ]
        }
      ],
      "actions": [
        {
          "type": "set_tag",
          "entity": "$self",
          "tag": "power_vacuum",
          "value": true
        },
        {
          "type": "set_tag",
          "entity": "$self",
          "tag": "crisis",
          "value": true
        },
        {
          "type": "set_tag",
          "entity": "$self",
          "tag": "political",
          "value": true
        }
      ],
      "pressureChanges": {
        "harmony": -1,
        "security": -8
      },
      "id": "power_vacuum_detector",
      "name": "Leadership Crisis"
    },
    "enabled": true
  },
  {
    "systemType": "connectionEvolution",
    "config": {
      "description": "All entities fade over time; connections slow the decay (inactivity leads to being forgotten)",
      "metric": {
        "type": "connection_count",
        "direction": "both",
        "minStrength": 0.2
      },
      "throttleChance": 0.08,
      "selection": {
        "strategy": "by_kind",
        "kind": "any"
      },
      "rules": [
        {
          "condition": {
            "operator": "<=",
            "threshold": 2
          },
          "probability": 0.9,
          "action": {
            "type": "adjust_prominence",
            "entity": "$self",
            "delta": -0.25
          }
        },
        {
          "condition": {
            "operator": ">=",
            "threshold": 3
          },
          "probability": 0.75,
          "action": {
            "type": "adjust_prominence",
            "entity": "$self",
            "delta": -0.15
          }
        }
      ],
      "id": "prominence_evolution",
      "name": "Prominence Evolution"
    },
    "enabled": true
  },
  {
    "systemType": "connectionEvolution",
    "config": {
      "description": "Weak homeostatic pressure. Connected to legends? Slight rise. Connected to the forgotten? Slight fade.",
      "metric": {
        "type": "neighbor_prominence",
        "direction": "both",
        "minStrength": 0.2
      },
      "throttleChance": 0.25,
      "selection": {
        "strategy": "by_kind",
        "kind": "any"
      },
      "rules": [
        {
          "condition": {
            "operator": ">=",
            "threshold": 3
          },
          "probability": 0.4,
          "action": {
            "type": "adjust_prominence",
            "entity": "$self",
            "delta": 0.08
          }
        },
        {
          "condition": {
            "operator": "<=",
            "threshold": 2
          },
          "probability": 0.4,
          "action": {
            "type": "adjust_prominence",
            "entity": "$self",
            "delta": -0.06
          }
        }
      ],
      "id": "reflected_glory",
      "name": "Reflected Glory"
    },
    "enabled": true
  },
  {
    "systemType": "relationshipMaintenance",
    "config": {
      "description": "Handles decay, reinforcement, and culling of relationships. Maintains relationship health over time.",
      "maintenanceFrequency": 5,
      "cullThreshold": 0.15,
      "gracePeriod": 20,
      "reinforcementBonus": 0.02,
      "maxStrength": 1,
      "id": "relationship_maintenance",
      "name": "Relationship Maintenance"
    },
    "enabled": true
  },
  {
    "systemType": "planeDiffusion",
    "config": {
      "description": "Prosperity spreads from resource-rich and trade locations",
      "sources": {
        "tagFilter": "resource",
        "defaultStrength": 80
      },
      "sinks": {
        "tagFilter": "conflict",
        "defaultStrength": 25
      },
      "diffusion": {
        "rate": 0.3,
        "decayRate": 0,
        "sourceRadius": 3,
        "falloffType": "none",
        "iterationsPerTick": 30
      },
      "valueTag": "sys_resource_value",
      "selection": {
        "strategy": "by_kind",
        "kind": "location"
      },
      "outputTags": [
        {
          "tag": "thriving",
          "minValue": 15,
          "maxValue": 100
        },
        {
          "tag": "stressed",
          "minValue": -100,
          "maxValue": 40
        }
      ],
      "id": "resource_diffusion",
      "name": "Resource & Trade Flow"
    },
    "enabled": true
  },
  {
    "systemType": "planeDiffusion",
    "config": {
      "description": "Heat spreads from anomaly sources, making locations dangerous or safe",
      "sources": {
        "tagFilter": "anomaly",
        "defaultStrength": 60
      },
      "sinks": {
        "tagFilter": "central",
        "defaultStrength": 12
      },
      "diffusion": {
        "rate": 0.2,
        "decayRate": 0,
        "sourceRadius": 3,
        "falloffType": "none",
        "iterationsPerTick": 30
      },
      "valueTag": "temperature",
      "selection": {
        "strategy": "by_kind",
        "kind": "location"
      },
      "outputTags": [
        {
          "tag": "safe",
          "maxValue": 0.15
        },
        {
          "tag": "dangerous",
          "minValue": 0.25
        }
      ],
      "id": "thermal_diffusion",
      "name": "Thermal Diffusion"
    },
    "enabled": true
  },
  {
    "systemType": "connectionEvolution",
    "config": {
      "description": "Factions with trade connections can form alliances early in the simulation",
      "metric": {
        "type": "shared_relationship",
        "sharedRelationshipKind": "trades_with",
        "sharedDirection": "src",
        "via": {
          "relationshipKind": "controls",
          "direction": "src",
          "intermediateKind": "location"
        }
      },
      "pairExcludeRelationships": [
        "enemy_of",
        "betrayed_by",
        "allied_with"
      ],
      "pairComponentSizeLimit": {
        "relationshipKinds": [
          "allied_with"
        ],
        "max": 6
      },
      "throttleChance": 0.15,
      "selection": {
        "strategy": "by_kind",
        "kind": "faction"
      },
      "rules": [
        {
          "condition": {
            "operator": ">=",
            "threshold": 1
          },
          "probability": 0.25,
          "betweenMatching": true,
          "action": {
            "type": "create_relationship",
            "kind": "allied_with",
            "src": "$self",
            "dst": "$partner",
            "strength": 0.4,
            "bidirectional": true
          }
        }
      ],
      "pressureChanges": {
        "harmony": 3
      },
      "id": "trade_alliance_formation",
      "name": "Trade Alliance Formation"
    },
    "enabled": true
  },
  {
    "systemType": "thresholdTrigger",
    "config": {
      "description": "Heroes who lose their weapons are no longer armed",
      "clusterMode": "individual",
      "throttleChance": 0.1,
      "selection": {
        "strategy": "by_kind",
        "kind": "npc",
        "subtypes": [
          "hero"
        ],
        "status": "alive",
        "filters": [
          {
            "type": "has_tag",
            "tag": "armed"
          }
        ]
      },
      "conditions": [
        {
          "type": "graph_path",
          "assert": {
            "check": "not_exists",
            "path": [
              {
                "via": "owned_by",
                "direction": "in",
                "targetKind": "artifact",
                "targetSubtype": "weapon"
              }
            ]
          }
        }
      ],
      "actions": [
        {
          "type": "remove_tag",
          "entity": "$self",
          "tag": "armed"
        }
      ],
      "id": "unarmed_hero_detector",
      "name": "Unarmed Hero Detection"
    },
    "enabled": true
  },
  {
    "systemType": "universalCatalyst",
    "config": {
      "description": "Enables agents (NPCs, factions) to perform domain-defined actions. Manages action selection and success/failure.",
      "actionAttemptRate": 0.18,
      "pressureMultiplier": 1.1,
      "prominenceUpChanceOnSuccess": 1,
      "prominenceDownChanceOnFailure": 1,
      "id": "universal_catalyst",
      "name": "Agent Actions"
    },
    "enabled": true
  },
  {
    "systemType": "thresholdTrigger",
    "config": {
      "description": "NPCs serving factions at war can fall in battle, their artifacts looted or lost",
      "variables": {
        "$enemy_faction": {
          "select": {
            "kind": "faction",
            "pickStrategy": "random",
            "from": {
              "path": [
                {
                  "from": "$self",
                  "via": "member_of",
                  "direction": "src"
                },
                {
                  "via": "at_war_with",
                  "direction": "both"
                }
              ]
            }
          }
        }
      },
      "clusterMode": "individual",
      "throttleChance": 0.5,
      "selection": {
        "strategy": "by_kind",
        "kind": "npc",
        "status": "alive",
        "excludeSubtypes": [
          "hero",
          "mayor"
        ]
      },
      "conditions": [
        {
          "type": "graph_path",
          "assert": {
            "check": "exists",
            "path": [
              {
                "via": "member_of",
                "direction": "out",
                "targetKind": "faction",
                "targetSubtype": "any"
              },
              {
                "via": "participant_in",
                "direction": "out",
                "targetKind": "occurrence",
                "targetSubtype": "war",
                "targetStatus": "active"
              }
            ]
          }
        },
        {
          "type": "random_chance",
          "chance": 0.08
        }
      ],
      "actions": [
        {
          "type": "change_status",
          "entity": "$self",
          "newStatus": "historical"
        },
        {
          "type": "for_each_related",
          "relationship": "owned_by",
          "direction": "in",
          "actions": [
            {
              "type": "conditional",
              "condition": {
                "type": "random_chance",
                "chance": 0.5
              },
              "thenActions": [
                {
                  "type": "transfer_relationship",
                  "entity": "$related",
                  "relationshipKind": "owned_by",
                  "from": "$self",
                  "to": "$enemy_faction",
                  "condition": {
                    "type": "entity_exists",
                    "entity": "$enemy_faction"
                  }
                },
                {
                  "type": "set_tag",
                  "entity": "$related",
                  "tag": "war_trophy",
                  "value": true
                }
              ],
              "elseActions": [
                {
                  "type": "change_status",
                  "entity": "$related",
                  "newStatus": "lost"
                },
                {
                  "type": "archive_relationship",
                  "entity": "$related",
                  "relationshipKind": "owned_by",
                  "with": "$self"
                }
              ]
            }
          ],
          "targetKind": "artifact"
        }
      ],
      "id": "war_casualties",
      "name": "War Casualties"
    },
    "enabled": true
  },
  {
    "systemType": "thresholdTrigger",
    "config": {
      "description": "Long-running wars become weary and ready to resolve",
      "clusterMode": "individual",
      "throttleChance": 0.5,
      "selection": {
        "strategy": "by_kind",
        "kind": "occurrence",
        "subtypes": [
          "war"
        ],
        "status": "active",
        "filters": [
          {
            "type": "lacks_tag",
            "tag": "war_weary"
          }
        ]
      },
      "conditions": [
        {
          "type": "time_elapsed",
          "minTicks": 5,
          "since": "created"
        }
      ],
      "actions": [
        {
          "type": "set_tag",
          "entity": "$self",
          "tag": "war_weary",
          "value": true
        }
      ],
      "id": "war_fatigue_detector",
      "name": "War Fatigue"
    },
    "enabled": true
  },
  {
    "systemType": "thresholdTrigger",
    "config": {
      "description": "Archives stale war ties when no active war occurrence remains and cleans up war-related state",
      "clusterMode": "individual",
      "throttleChance": 0.4,
      "selection": {
        "strategy": "by_kind",
        "kind": "faction"
      },
      "conditions": [
        {
          "type": "relationship_count",
          "relationshipKind": "at_war_with",
          "direction": "both",
          "min": 1
        },
        {
          "type": "graph_path",
          "assert": {
            "check": "not_exists",
            "path": [
              {
                "via": "participant_in",
                "direction": "out",
                "targetKind": "occurrence",
                "targetSubtype": "war",
                "targetStatus": "active"
              }
            ]
          }
        }
      ],
      "actions": [
        {
          "type": "archive_all_relationships",
          "entity": "$self",
          "relationshipKind": "at_war_with",
          "direction": "both"
        },
        {
          "type": "remove_tag",
          "entity": "$self",
          "tag": "conflict"
        },
        {
          "type": "remove_tag",
          "entity": "$self",
          "tag": "honor_bound"
        }
      ],
      "pressureChanges": {
        "harmony": 4
      },
      "id": "war_tie_cleanup",
      "name": "War Tie Cleanup"
    },
    "enabled": false,
    "_disabled_reason": "at_war_with eliminated. No orphaned relationships to clean up."
  }
]
